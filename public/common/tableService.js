app.factory("tableService",["easyHttp",function(e){var t={};return t.config={pageSizeList:["10","20","50","100"],pageSize:10,pageSizeShow:!0,getPage:"",isVisiblePage:"",firstShow:!0,lastShow:!0,totalPage:0,totalResult:0,currentResult:0,currentPage:1},t.table=function(e,o,a){return!a.data.length&&e.pagination&&e.pagination.currentPage>1?(--o.urlParams.pageIndex,o.urlParams.pageIndex||(e.pagination.currentPage=1,o.urlParams.pageIndex=1),t.getTable(e.restURL,o,function(a){0===a.errorCode&&t.table(e,o,a)})):(e.selectFlag=!1,e.tableBody=t.addCheckbox(a.data,e.selectFlag),e.selectNumber=t.selectNumberCount(a.data).select,e.restData=o.urlParams||{},e.seatData=o.seatParams||{},e.pagination={},e.pagination=t.config,e.pagination=t.pagination(e.pagination,a.pagination),e.restData.pageIndex=e.pagination.currentPage,e.pagination.getPage=e.pagination.currentPage,e.restData.pageSize=e.pagination.pageSize,"function"==typeof e.callback&&e.callback()),e},t.getTable=function(t,o,a){return e.get(t,o,a)},t.addCheckbox=function(e,t){for(var o=e.length?e.length:0,a=0;a<o;a++)e[a].checkboxId=a+1,e[a].checkbox=t;return e},t.selectAll=function(e){for(var t=e.length?e.length:0,o=0;o<t;o++)void 0===e[o].enableCheckbox?e[o].checkbox=!0:e[o].checkbox=e[o].enableCheckbox;return e},t.cancelAll=function(e){for(var t=e.length?e.length:0,o=0;o<t;o++)e[o].checkbox=!1;return e},t.selectOne=function(e,t){for(var o=e.length?e.length:0,a=0;a<o;a++)e[a].checkboxId===t&&(e[a].checkbox=!e[a].checkbox);return e},t.selectNumberCount=function(e){for(var t=e.length?e.length:0,o=0,a=0,n=0;n<t;n++)e[n].checkbox?++o:++a;return{select:o,noselect:a,count:t}},t.getSelectTable=function(e){for(var t=e.length?e.length:0,o=[],a=0;a<t;a++)e[a].checkbox&&o.push(e[a]);return o},t.pagination=function(e,t){var o={};o=e;var a=t.currentPage,n=t.pageSize,l=t.totalPage,i=t.totalResult,r=!1;o.isVisiblePage=0!=i,o.totalPage=l,o.totalResult=i,o.pageSize=n,o.currentPage=a;var c=l;if(o.pageLists=[],o.lastDisabled=o.nextsDisabled=!1,o.firstDisabled=o.previousDisabled=!1,1==a?o.firstDisabled=o.previousDisabled=!0:a==l&&(o.lastDisabled=o.nextsDisabled=!0),l<=5){o.firstShow=o.lastShow=!1,1===l&&(o.previousDisabled=o.nextsDisabled=!0);for(var s=1;s<=c;s++)r=!1,a==s&&(r=!0),o.pageLists.push({index:s,ellipsis:!1,isActive:r})}else{o.firstShow=o.lastShow=!1;var p=0;(a<=2||a>=l-1)&&(p=3);for(var s=1;s<=c;s++)r=!1,a==s&&(r=!0),p?1!=s&&2!=s&&3!=s&&s!=a&&s!=l&&s!=l-1||(s==p?o.pageLists.push({index:"",ellipsis:!0,isActive:r}):o.pageLists.push({index:s,ellipsis:!1,isActive:r})):1!=s&&2!=s&&s!=a&&s!=l&&s!=l-1||(2==s||s==l-1?o.pageLists.push({index:"",ellipsis:!0,isActive:r}):o.pageLists.push({index:s,ellipsis:!1,isActive:r}))}return o},t.delTableListById=function(e,o,a,n){var l=t.getSelectTable(e.tableBody);if(!l.length)return $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_table_delTips"),type:"errer",manualClose:!0}),!1;var i=[];angular.forEach(l,function(e){i.push(e.id)}),$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:o},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){a(i,function(e){0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),$(document).promptBox("closePrompt"),n()):($(document).promptBox("closePrompt"),$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0}))})}}]})},t.delTableListByUid=function(e,o,a,n){if(0!=e.selectNumber&&0!=$(".table-box tbody tr").length){var l=[],i=t.getSelectTable(e.tableBody);if(!i.length)return accountView.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_table_delTips"),type:"errer",manualClose:!0}),!1;angular.forEach(i,function(e){l.push(e.uid)}),$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:o},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){a(l,function(e){0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),$(document).promptBox("closePrompt"),n()):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})}}]})}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_table_delTips"),type:"errer",manualClose:!0})},t.delTableListBylistId=function(e,o,a,n){if(0!=e.selectNumber&&0!=$(".table-box tbody tr").length){var l=[],i=t.getSelectTable(e.tableBody);if(!i.length)return accountView.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_table_delTips"),type:"errer",manualClose:!0}),!1;angular.forEach(i,function(e){l.push(e.listId)}),$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:o},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){a(l,function(e){0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),$(document).promptBox("closePrompt"),n()):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})}}]})}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_table_delTips"),type:"errer",manualClose:!0})},t}]);