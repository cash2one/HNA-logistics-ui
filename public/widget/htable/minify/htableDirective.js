!function(t,e){!function(t){function e(e,a,l){var n=this;n.$elm=t(e),n.$lockLeftElm=t(e).find(".lock-left"),n.$lockTopElm=t(e).find(".lock-top"),n.$contentElm=t(e).find(".table-content-box"),n.data=a,n.opts=t.extend({},i,l),n.init()}var i={};e.prototype={init:function(){var t=this;t.render(t.data),t.handle()},render:function(t){var e=this,i="",a=t.left,l=t.right,n=a.length,d=l.length;if(n){i+='<div class="m-lock-left">',i+='<table class="table-corner" cellspacing="0" cellpadding="0" border="0">',i+="<thead><tr>";for(var r=0,c=a[0].length;r<c;r++)-1!=a[0][r].indexOf("/")?i+='<th style="position: relative;"><div class="u-backslash"><span class="u-backslash-left">'+a[0][r].split("/")[0]+'<i class="i-unit">(千克)</i></span><span class="u-backslash-right">'+a[0][r].split("/")[1]+"</span></div></th>":i+="<th>"+a[0][r]+"</th>";i+="</tr></thead>",i+="</table>",i+='<div class="lock-left">',i+='<table class="table-left" cellspacing="0" cellpadding="0" border="0">',i+="<thead><tr>";for(var r=0;r<c;r++)i+="<th>"+a[0][r]+"</th>";i+="</tr></thead>",i+="<tbody>";for(var o=0,r=1;r<n;r++){i+="<tr>";for(var s=0;s<c;s++)i+=1==s?'<td><a data-indexnum="'+o+++'" class="u-price-edit" href="javascript:;">'+a[r][s]+"</a></td>":"<td>"+a[r][s]+"</td>";i+="</tr>"}i+="</tbody>",i+="</table>",i+="</div>",i+="</div>"}if(d){i+='<div class="m-lock-right">',i+='<div class="lock-top">',i+='<table class="table-top" cellspacing="0" cellpadding="0" border="0">',i+="<thead><tr>";for(var r=0,c=l[0].length;r<c;r++)i+='<th data-uid="">'+l[0][r]+"</th>";i+="</tr></thead>",i+="</table>",i+="</div>",i+='<div class="table-content-box">',i+='<table class="table-content" cellspacing="0" cellpadding="0" border="0">',i+="<thead><tr>";for(var r=0;r<c;r++)i+="<th>"+l[0][r]+"</th>";i+="</tr></thead>",i+="<tbody>";for(var o=0,r=1;r<d;r++){i+="<tr>";for(var s=0;s<c;s++)i+='<td><div class="u-cell"><input data-indexnum="'+o+++'" readonly="readonly" type="text" class="u-edit-input" maxlength="10" /><a class="u-edit-btn" href="javascript:;">…</a>'+l[r][s]+"</div></td>";i+="</tr>"}i+="</tbody>",i+="</table>",i+="</div>",i+="</div>"}e.$elm.html(i)},handle:function(){var e=this;e.layout(),e.$elm.find(".table-content-box").scroll(function(){e.$elm.find(".lock-top").scrollLeft(t(this).scrollLeft()),e.$elm.find(".lock-left").scrollTop(t(this).scrollTop())}),t(window).resize(function(){e.layout()})},layout:function(){var t=this,e=t.$elm.width(),i=(t.$elm.height(),t.$elm.find(".m-lock-left").width());t.$elm.find(".m-lock-right").width(Math.floor(e-i-.5))},isScroll:function(){var t=this,e={horizontal:!1,vertical:!1},i=t.$elm.find(".table-content-box").width(),a=t.$elm.find(".table-content-box").height(),l=t.$elm.find(".table-content").width(),n=t.$elm.find(".table-content").height();return e.horizontal=l>i,e.vertical=n>=a,e.horizontal&&(e.vertical=n+17>=a),e},editCell:function(e,i){var a=this,l=a.$elm.find(".u-cell");l.each(function(){t(this).addClass("u-edit-box"),t(this).children(".u-edit-input").removeAttr("readonly").removeAttr("data-tootips")}),l.click(function(){t(this).hasClass("u-edit-box")&&(a.$elm.find(".u-edit-box.active").removeClass("active"),t(this).addClass("active"))}),l.children(".u-edit-input").blur(function(){var e=t.trim(t(this).val()),a=/^(\d{1}|[1-9][0-9]*)$|^(0{1}|[1-9][0-9]*)\.\d{1,3}$/;e&&!a.test(e)?(t(this).parent(".u-cell").addClass("u-edit-error"),t(this).data("price","")):(t(this).parent(".u-cell").removeClass("u-edit-error"),t(this).data("price",t.trim(t(this).val())));var l=parseInt(t(this).parent().parent("td").index())+1;i("cell",{price:t(this).data("price"),idx:l},t(this).data("indexnum"))}),l.children(".u-edit-btn").click(function(){var i=t(this).parent().children(".u-edit-input").data()||{},l=t(this).parent().parent("td").parent("tr").index(),n=t(this).parent().parent("td").index(),d=a.$elm.find(".table-top tr").find("th").eq(n).text(),r=a.$elm.find(".table-left tbody").find("tr").eq(l).children("td").eq(2).text();i.latitude=r,i.longitude=d,"function"==typeof e&&e(i)})},editRow:function(e){var i=this,a=i.$elm.find(".u-price-edit");a.each(function(){t(this).removeAttr("data-tootips")}),a.click(function(){var a=t(this).data();i.$elm.find(".u-price-edit.active").removeClass("active"),t(this).addClass("active");var l=t(this).parent("td").parent("tr").index(),n=i.$elm.find(".table-left tbody").find("tr").eq(l).children("td").eq(2).text();a.latitude=n,"function"==typeof e&&e(a)})},cancelEditCell:function(){var e=this;e.$elm.find(".u-cell").each(function(){t(this).removeClass("u-edit-box")}),e.$elm.find(".u-edit-input").each(function(){t(this).attr("readonly","readonly")})},setCellData:function(t,e){var i=this;i.$elm.find(".u-edit-box.active").children(".u-edit-input").val(t.price).data(t);try{e("cell",t,i.$elm.find(".u-edit-box.active").children(".u-edit-input").data("indexnum"))}catch(t){}},setRowData:function(e,i){var a=this,l=a.$elm.find(".u-price-edit.active"),n=l.parent("td").parent("tr").index();a.$elm.find(".table-content tbody").find("tr").eq(n).find(".u-edit-input").each(function(){var a=t(this).data(),l=t.extend({},a,e);try{i("cell",l,t(this).data("indexnum"))}catch(t){}t(this).data(l)}),l.html(e.calcName).data(e);try{i("row",e,l.data("indexnum"))}catch(t){}}},t.fn.htable=function(t,i){return new e(this,t,i)}}(t.jQuery)}(window);