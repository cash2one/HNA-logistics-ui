function Select(e){e||(e={}),this.DEFAULT_COUNT=11,e.defaultCount&&e.defaultCount>0&&(this.DEFAULT_COUNT=e.defaultCount),this.limitSearchLength=e.limitSearchLength||30,this.url=e.url,this.data=e.data,this.allData=this.data,this.cacheData=this.data,this.offset=e.offset||4,this.maxHeight=e.maxHeight||240,this.minHeight=e.minHeight||34,this.height=e.height,this.isCreateNewSelect=e.isCreateNewSelect||!1,this.inputElement=$("#"+e.id),this.parentElement=e.parentContainer,this.isCache=e.isCache,this.state=!1,this.defaultCount=this.DEFAULT_COUNT,this.showTextField=e.showTextField||"name",this.attrTextField=e.attrTextField,this.attrTextModel=e.attrTextModel,this.attrTextId=e.attrTextId,this.selectListBoxEle=null,this.selectContainerEle=null,this.isSearch=e.isSearch,this.noResultText=e.noResultText||"无搜索结果",this.direction=e.direction,this.searchDefaultText=e.searchDefaultText,this.searchBoxEle=null,this.isUsePinyin=e.isUsePinyin,this.multipleSign=e.multipleSign,this.onBeforeShow=e.onBeforeShow,this.isNotUseFilter=e.isNotUseFilter,this.onSearchValueChange=e.onSearchValueChange,this.closeLocalSearch=e.closeLocalSearch||!1,this.isSaveInputVal=e.isSaveInputVal||!0,this.searchPlaceHoder=e.searchPlaceHoder||"请输入搜索条件",this.isPageLoaddingOpen=!1,this.pagination=e.pagination||!1,this.paginationScrollDirection="down",this.currentPage=1,this.isCanPaginationScroll=!0,this.isShowSelectWhenHidden=!0,void 0!==e.isReadOnly&&!e.isReadOnly||this.multipleSign||this.inputElement.attr("readonly","readonly"),this.isSearch?this.defaultText=void 0===e.defaultText?"全部":e.defaultText:this.defaultText=void 0===e.defaultText?"请选择":e.defaultText}function selectFactory(e){return Select.sharePool[e.id]&&!e.isCreateNewSelect?(Select.sharePool[e.id].state?Select.sharePool[e.id].state=!1:Select.sharePool[e.id].state=!0,Select.sharePool[e.id]):(Select.sharePool[e.id]=new Select(e),Select.sharePool[e.id].state=!0,Select.sharePool[e.id].build(),Select.sharePool[e.id])}easySpa.use(["public/lib/pinyin.js","public/lib/pinyin-util.js"]);var isShowNoResult=!0;String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)};var isShowConditionSearchText=!1;Select.prototype={isInputClick:!1,getView:function(){var e={};return e.getCursorPosition=function(e){var t=$(e);if($.trim(t.val())){t=t[0];var i=0;if(document.selection){var l=document.selection.createRange();l.moveStart("character",-t.value.length),i=l.text.length}else(t.selectionStart||"0"==t.selectionStart)&&(i=t.selectionStart);return i}},e.setCursorPosition=function(e,t){var i=$(e);if(i=i[0],i.setSelectionRange)i.setSelectionRange(t,t);else if(i.createTextRange){var l=i.createTextRange();l.collapse(!0),l.moveEnd("character",t),l.moveStart("character",t),l.select()}},e},setDefaultCount:function(e){this.pagination?this.defaultCount=10:1==e?(this.defaultCount=e+1,this.DEFAULT_COUNT=e+1):(this.defaultCount=e,this.DEFAULT_COUNT=e)},clearActiveCls:function(){this.selectListBoxEle&&$("li",this.selectListBoxEle).removeClass("active")},moveScrollUp:function(e){var t=this;setTimeout(function(){t.selectContainerEle.scrollTop(t.selectContainerEle[0].scrollTop-e.outerHeight())},100)},moveScrollDown:function(e){var t=this;setTimeout(function(){t.selectContainerEle.scrollTop(t.selectContainerEle[0].scrollTop+e.outerHeight())},100)},moveSelectedUp:function(){if(!(this.isSearch&&$(".no-result",this.selectListBoxEle).length>0)){for(var e=!1,t=$("li",this.selectListBoxEle),i=0;i<t.length;i++){if($(t[i]).hasClass("active")&&0!=i){$(t[i]).removeClass("active"),$(t[i-1]).addClass("active"),e=!0;break}$(t[i]).hasClass("active")&&(e=!0)}e||$(t[0]).addClass("active"),this.moveScrollUp($("li.active",this.selectListBoxEle))}},moveSelectedDown:function(){if(!(this.isSearch&&$(".no-result",this.selectListBoxEle).length>0)){for(var e=!1,t=$("li",this.selectListBoxEle),i=0;i<t.length;i++){if($(t[i]).hasClass("active")&&i!=t.length-1){$(t[i]).removeClass("active"),$(t[i+1]).addClass("active"),e=!0;break}$(t[i]).hasClass("active")&&(e=!0)}e||$(t[0]).addClass("active"),this.moveScrollDown($("li.active",this.selectListBoxEle))}},isExistInVal:function(e){var t=this.inputElement.val();e.indexOf("(")>-1&&(e=e.substring(0,e.indexOf("(")));for(var i=t.split("，").length>0?t.split("，"):t.split(","),l=!1,s=0;s<i.length;s++)if(i[s].indexOf("(")>-1&&(i[s]=i[s].substring(0,i[s].indexOf("("))),i[s]==e){l=!0;break}return!!l},setData:function(e){this.pagination&&!this.isShowSelectWhenHidden||(this.isPageLoaddingOpen=!1,this.isSaveInputVal||this.inputElement.val(""),this.allData=e,e.data&&!e.data.length&&$(".loading").remove(),this.isInputClick&&(this.clearSelectList(),this.refresh(),this.isInputClick=!1))},clearSelectList:function(){this.selectListBoxEle.html("")},getSigleDataByName:function(e){if(!this.allData)return{};for(var t=this.allData.data,i=0;i<t.length;i++)if(e==t[i][this.showTextField])return t[i];return{}},setVal:function(e,t){var i=this.inputElement.val(),l=$(".active",this.selectListBoxEle);if(e)this.multipleSign&&!this.isExistInVal(e)?($.trim(i)&&$.trim(i).lastIndexOf("，")>-1&&$.trim(i).lastIndexOf("，")==$.trim(i).length-1||!$.trim(i)?this.inputElement.val(i+e):this.inputElement.val(i+this.multipleSign+e),this.inputElement.currentVal=this.inputElement.val()):this.multipleSign||this.inputElement.val(e);else if("noSearch"!=t){var s=l.html();(s.indexOf(this.noResultText)>-1||s.indexOf("loading")>-1)&&(s=this.inputElement.val()),this.multipleSign&&!this.isExistInVal(s)?($.trim(i)&&$.trim(i).lastIndexOf("，")>-1&&$.trim(i).lastIndexOf("，")==$.trim(i).length-1||!$.trim(i)?this.inputElement.val(i+s):this.inputElement.val(i+this.multipleSign+s),this.inputElement.currentVal=this.inputElement.val()):this.multipleSign||this.inputElement.val(s)}e=this.inputElement.val(),this.multipleSign&&","==this.multipleSign&&(e=e.replaceAll(",","，"),this.inputElement.val(e)),this.defaultText&&e.indexOf(this.defaultText)>-1&&(this.inputElement.val(""),e="");for(var n in this.attrTextField)this.attrTextId(l.attr(n),e);this.attrTextModel&&this.attrTextModel(e,this.data,this.getSigleDataByName(e),this),this.hide()},getSearchCurrentList:function(){var e=this;if(!$.trim(this.searchBoxEle.val()))return[];for(var t=[],i=this.allData.data,l=0;l<i.length;l++){var s=!1,n=i[l][this.showTextField].toLowerCase();if(e.isNotUseFilter)t.push(i[l]);else if(this.closeLocalSearch)t.push(i[l]);else if(n.indexOf($.trim(this.searchBoxEle.val()).toLowerCase())>-1&&(t.push(i[l]),s=!0),!s&&this.isUsePinyin){var a=pinyinUtil.getPinyin(i[l][this.showTextField]);a=a.replace(/\s+/g,""),a.indexOf($.trim(this.searchBoxEle.val()))>-1&&t.push(i[l])}}return t},refresh:function(){var e=this;e.allData&&!e.allData.data||(e.build(),e.updateData(e.allData))},open:function(){var e=this;e.searchBoxEle.val(""),e.inputElement.focus(),e.isInputClick=!0,e.onSearchValueChange&&$(".search-condition-box",e.selectContainerEle).trigger("keyup"),e.allData&&!e.allData.data||setTimeout(function(){e.setDefaultCount(e.DEFAULT_COUNT),e.build(),e.updateData(e.allData)},100)},destroy:function(){var e=this.inputElement.attr("id");Select.sharePool[e]&&($(Select.sharePool[e].selectContainerEle).remove(),delete Select.sharePool[e])},showUpLoadding:function(){this.paginationScrollDirection="up",$("li:eq(0)",this.selectListBoxEle).css("border-top","none"),this.selectListBoxEle.addClass("top-cls"),$("<div class='loading reset'><img src='../public/img/loading.gif' /></div>").insertBefore(this.selectListBoxEle),this.selectContainerEle.scrollTop(1)},showDownLoadding:function(){this.paginationScrollDirection="down",$("<div class='loading bottom-cls'><img src='../public/img/loading.gif' /></div>").insertAfter(this.selectListBoxEle),this.selectContainerEle.scrollTop(this.selectContainerEle.scrollTop()+34)},bindEvent:function(){var e=this,t=!1;this.selectListBoxEle.delegate("li","click",function(){t=!1,e.selectContainerEle.removeClass("select-list-hide"),e.setVal()}),this.selectContainerEle.on("scroll",function(){setTimeout(function(){e.isCanPaginationScroll=!0},100)}),this.selectContainerEle.on("scroll",function(){var i=$(".search-condition-container",e.selectContainerEle),l=e.selectContainerEle.scrollTop();e.state=!0,t=!0,e.selectContainerEle.addClass("select-list-hide"),i.css("top",l+"px"),0==l?i.css("border-bottom","1px solid #ddd"):i.css("border-bottom","none")}),this.selectContainerEle.on("scroll",function(){e.isCanPaginationScroll&&(e.isCanPaginationScroll=!1,e.pagination&&setTimeout(function(){e.isCanPaginationScroll=!0;var t=e.selectContainerEle.scrollTop(),i=e.selectContainerEle[0];if(0==t)1!=e.currentPage&&(e.isPageLoaddingOpen||(e.isInputClick=!0,e.isPageLoaddingOpen=!0,e.showUpLoadding(),e.currentPage--,e.isShowSelectWhenHidden=!0,setTimeout(function(){e.currentPage||(e.currentPage=1),e.onSearchValueChange(e,e.searchBoxEle.val(),e.currentPage)},1500)));else if(t+e.selectContainerEle.height()>=i.scrollHeight){var l=0;if(e.allData&&e.allData.data&&e.allData.data.length>0){for(var s=0;s<e.allData.data.length;s++)$.trim(e.allData.data[s][e.showTextField])&&l++;!e.isPageLoaddingOpen&&e.allData.pagination&&e.currentPage<e.allData.pagination.totalPage&&(e.isInputClick=!0,e.isPageLoaddingOpen=!0,e.showDownLoadding(),e.currentPage++,e.isShowSelectWhenHidden=!0,setTimeout(function(){e.currentPage||(e.currentPage=1),e.onSearchValueChange(e,e.searchBoxEle.val(),e.currentPage)},1500))}}},200))}),this.selectListBoxEle.on("blur",function(){e.state=!1,t=!1,e.selectContainerEle.removeClass("select-list-hide")}),this.inputElement.on("click",function(){e.isShowSelectWhenHidden=!0,e.currentPage=1,e.open()}),this.inputElement.next().hasClass("icon-drop-down")&&this.inputElement.next().on("click",function(){e.open(),e.inputElement.focus()}),$(".search-condition-box",e.selectContainerEle).on("focus",function(){e.state=!0,t=!0,e.selectContainerEle.addClass("select-list-hide")}),$(".search-condition-box",e.selectContainerEle).on("blur",function(){e.state=!1,t=!1,setTimeout(function(){e.selectContainerEle.removeClass("select-list-hide")},500)}),this.inputElement.on("focus",function(){e.inputElement.currentVal=e.inputElement.val()}),this.inputElement.on("keyup",function(t){if(13!=t.keyCode)if(e.multipleSign&&8!=t.keyCode)e.inputElement.val(e.inputElement.currentVal);else if(e.multipleSign){var i=e.getView(),l=i.getCursorPosition(e.inputElement);if(e.inputElement.currentVal.indexOf("，")>-1)var s=e.inputElement.currentVal.split("，");else var s=e.inputElement.currentVal.split(",");for(var n=0,a=0,o=0;o<s.length;o++)if(n+=s[o].length+1,a=n-s[o].length-1,l>=a&&l<=n){s.splice(o,1),e.inputElement.currentVal=s.join("，"),e.inputElement.val(e.inputElement.currentVal),e.attrTextModel(e.inputElement.currentVal,e.data,e.getSigleDataByName(e.inputElement.currentVal),e),setTimeout(function(){i.setCursorPosition(e.inputElement,a)},100);break}}});var i=0;$(".search-condition-box",e.selectContainerEle).on("keyup",function(t){e.isShowSelectWhenHidden=!0,i=setTimeout(function(){if(e.currentPage=1,e.searchBoxEle.val().length>e.limitSearchLength&&e.searchBoxEle.val(e.searchBoxEle.val().substring(0,e.limitSearchLength)),e.onSearchValueChange&&(e.isInputClick=!0,e.onSearchValueChange(e,$.trim(e.searchBoxEle.val()))),e.closeLocalSearch)return void(e.isInputClick=!0);if(8==t.keyCode&&!$.trim(e.searchBoxEle.val()))return e.setDefaultCount(e.DEFAULT_COUNT),e.build(),void e.updateData(e.allData);if(38!=t.keyCode&&40!=t.keyCode&&13!=t.keyCode&&e.allData)if($.trim(e.searchBoxEle.val())){var i=e.getSearchCurrentList();e.setDefaultCount(i.length),e.updateData({data:i})}else e.setDefaultCount(e.DEFAULT_COUNT),e.build(),e.updateData(e.allData)},100)}),this.selectListBoxEle.delegate("li","mouseenter",function(){e.isSearch&&$(".no-result",e.selectListBoxEle).length>0||($("li",e.selectListBoxEle).removeClass("active"),$(this).addClass("active"))}),this.inputElement.on("blur",function(i){t&&(e.selectContainerEle.removeClass("select-list-hide"),t=!1),e.isSearch,setTimeout(function(){e.hide()},500)}),$(window).resize(function(){e.selectContainerEle.width(e.inputElement.outerWidth()-2),e.selectContainerEle.offset({left:e.inputElement.offset().left,top:e.selectContainerEle.offset().top})}),$(document).on("keydown",function(i){if(38==i.keyCode)return!1;if(40==i.keyCode)return!1;if(13==i.keyCode){var l=e.selectContainerEle.css("display");if(!l||"none"==l)return;if(e.isSearch&&$(".no-result",e.selectListBoxEle).length>0)return;if(t||e.state){var s=$("li",e.selectListBoxEle);if(s.hasClass("active"))e.setVal();else{var n=$(s[0]).html();n.indexOf(this.noResultText)>-1||n.indexOf("loading")>-1?e.setVal():e.setVal(n)}e.selectContainerEle.removeClass("select-list-hide"),t=!1}return!1}})},loadHtml:function(){return Select.html?Select.html:(Select.html=$.ajax({url:"public/widget/select/select.html",type:"GET",dataType:"html",async:!1}).responseText,Select.html)},getData:function(e){this.data?e(this.data):$.ajax({url:this.url,type:"GET",datatype:"json",success:function(t){e(t)},error:function(t){e({})}})},setDefaultActive:function(){var e=this,t=this.inputElement.val(),i=$("li",this.selectListBoxEle),l=!1;if(""!=$.trim(t)){for(var s=0;s<i.length;s++)if($(i[s]).html()==t){$(i[s]).addClass("active"),l=!0,setTimeout(function(){e.selectContainerEle.scrollTop($(i[s]).outerHeight()*s)},10);break}l||$(i[0]).addClass("active")}else $(i[0]).addClass("active")},hide:function(){this.selectContainerEle.css("display","none"),this.isShowSelectWhenHidden=!1,this.state=!1,this.isInputClick=!1},display:function(){this.selectContainerEle.css("display","block"),this.state=!0},showNoResult:function(e){$("li",this.selectContainerEle).html(e)},show:function(e,t){var i=this,l=!1;if(this.isInputClick=!1,i.isCanPaginationScroll=!1,this.isPageLoaddingOpen=!1,$(".top-cls").removeClass("top-cls"),$(".loading").remove(),this.onBeforeShow&&this.onBeforeShow(this),e.data){var s=!0;i.selectContainerEle.outerWidth(this.inputElement.outerWidth());var n=this.inputElement.offset(),a=n.left,o=n.top;this.isHasListBoxEle||(this.inputElement.parent().append(i.selectContainerEle),this.isHasListBoxEle=!0),i.selectContainerEle.css({"min-height":this.minHeight+"px","max-height":this.maxHeight+"px"}),this.height&&i.selectContainerEle.css({height:this.height+"px"});var r=e.data;if(this.isSearch){if(this.searchBoxEle.attr("placeholder",this.searchPlaceHoder),0==r.length){s=!1;var h={};""!=$.trim(this.searchBoxEle.val())?(h[this.showTextField]="<span style='color:#e7e7e7'>loading...</span>",isShowNoResult&&(isShowNoResult=!1,setTimeout(function(){1==$("li",i.selectContainerEle).length&&"loading..."==$.trim($("li span:eq(0)",i.selectContainerEle).html())&&i.showNoResult("<div style='color:red;text-align:left' class='no-result'>"+i.noResultText+"</div>"),isShowNoResult=!0},2e3))):(h[this.showTextField]="",this.hide()),r.push(h)}else if(this.defaultText&&r&&r[0]&&r[0][this.showTextField]!=this.defaultText&&!$.trim(this.searchBoxEle.val())){var h={};h[this.showTextField]=this.defaultText,r.unshift(h)}}else if(this.defaultText&&r&&r[0]&&r[0][this.showTextField]!=this.defaultText){var h={};h[this.showTextField]=this.defaultText,r.unshift(h)}if(this.pagination&&(this.defaultCount||(this.defaultCount=10),r.length<this.defaultCount)){l=!0,i.paginationScrollDirection="up";for(var c=r.length;c<this.defaultCount;c++)r[c]={},r[c].none=!0,r[c][this.showTextField]=""}for(var c=0;c<r.length;c++){var u;u=r[c].none?$("<div class='no-border'></div>"):$("<li></li>"),u.html(r[c][this.showTextField]);for(var d in this.attrTextField)u.attr(d,r[c][this.attrTextField[d]]);if(t.append(u),this.defaultCount&&c+1>this.defaultCount)break}var f=$(window).scrollTop()+$(window).height(),p=o+this.inputElement.outerHeight()+i.selectContainerEle.outerHeight();"up"==this.direction?i.selectContainerEle.offset({left:a,top:o-i.selectContainerEle.outerHeight()}):p-f<-this.offset?i.selectContainerEle.offset({left:a,top:o+this.inputElement.height()}):i.selectContainerEle.offset({left:a,top:o-i.selectContainerEle.outerHeight()}),this.state=!0,s&&i.setDefaultActive(),i.isSearch&&(isShowConditionSearchText||(isShowConditionSearchText=!0,$(".search-condition-container",i.selectContainerEle).removeClass("select-hidden"),$(".search-condition-container",i.selectContainerEle).css({width:i.selectListBoxEle.width()+"px",top:"0"}),$(".search-condition-box",i.selectContainerEle).css({width:i.selectListBoxEle.width()+"px"}),i.selectListBoxEle.css("margin-top","30px"),isShowConditionSearchText=!1)),i.pagination&&setTimeout(function(){"down"==i.paginationScrollDirection?i.selectContainerEle.scrollTop(i.selectContainerEle.scrollTop()-1):l&&i.selectContainerEle.scrollTop(1)},100)}},showError:function(){this.selectContainerEle.css("display","block"),this.state=!0,this.selectListBoxEle.html(""),this.show({data:[]},this.selectListBoxEle)},build:function(){var e=this;this.getData(function(t){if(e.selectContainerEle||(e.selectContainerEle=$(e.loadHtml()),e.selectListBoxEle=$(".select-list-box",e.selectContainerEle),e.searchBoxEle=$(".search-condition-box",e.selectContainerEle),e.bindEvent()),e.inputElement.length>0){"none"==e.selectContainerEle.css("display")&&(e.selectListBoxEle.html(""),e.show(t,e.selectListBoxEle),e.state?e.selectContainerEle.css("display","block"):e.selectContainerEle.css("display","none"))}})},clearData:function(){this.allData=[],this.inputElement.val(""),this.selectListBoxEle.html("")},updateData:function(){for(var e,t,i=this,l=0;l<arguments.length;l++)"object"==typeof arguments[l]?t=arguments[l]:"string"==typeof arguments[l]&&(e=arguments[l]);e?this.url=e:this.data=t,this.getData(function(e){i.selectListBoxEle.html(""),i.show(e,i.selectListBoxEle)})}},Select.sharePool={};