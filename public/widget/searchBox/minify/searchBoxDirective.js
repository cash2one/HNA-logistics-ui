var SearchBox={};SearchBox._method={$:function(e,t){var a,o,i,n=[],r=e.substring(1);if(t=t||document,"string"==typeof e)switch(e.charAt(0)){case"#":return document.getElementById(r);case".":if(t.getElementsByClassName)return t.getElementsByClassName(r);for(a=SearchBox._method.$("*",t),o=a.length,i=0;i<o;i++)a[i].className.indexOf(r)>-1&&n.push(a[i]);return n;default:return t.getElementsByTagName(e)}},on:function(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent("on"+t,a)},getEvent:function(e){return e||window.event},getTarget:function(e){return e.target||e.srcElement},getPosition:function(e){var t=document.documentElement.scrollLeft||document.body.scrollLeft,a=document.documentElement.scrollTop||document.body.scrollTop,o=e.getBoundingClientRect();return{top:o.top+a,right:o.right+t,bottom:o.bottom+a,left:o.left+t}},addClass:function(e,t){t&&(t.className=SearchBox._method.hasClass(e,t)?t.className:t.className+" "+e)},removeClass:function(e,t){var a=new RegExp("(^|\\s+)"+e+"(\\s+|$)","g");SearchBox._method.hasClass(e,t)&&(t.className=a.test(t.className)?t.className.replace(a,""):t.className)},hasClass:function(e,t){return!(!t||!t.className)&&t.className.indexOf(e)>-1},stopPropagation:function(e){e=e||window.event,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},trim:function(e){return e.replace(/^\s+|\s+$/g,"")}},SearchBox.init=function(){this.initialize.apply(this,arguments)},SearchBox.init.prototype={constructor:SearchBox.init,initialize:function(e){this.destroy();var t=e.inputId,a=e.navItem;this.tip=e.tip||"",this.defaultText=e.defaultText,this.multipleSign=e.multipleSign,this.multipleData=[],SearchBox.toggleTab=e.toggleTab,SearchBox.onSearchValueChange=e.onSearchValueChange,SearchBox.attrTextModel=e.attrTextModel,SearchBox.contentList=e.contentList,SearchBox.searchData=e.searchData,this.currentPage=1,this.searchValue=[],this.input=SearchBox._method.$("#"+t),this.createNavbar(a),this.inputEvent()},scrollEvent:function(){var e=this;$(this.rootDiv).find(".item-box").scroll(function(){0==$(this).scrollTop()?e.currentPage>1&&($(".loading-bottom").remove(),$(this).prepend("<div class='loading loading-top'><img src='../public/img/loading.gif'/></div>"),e.currentPage--,SearchBox.contentList=SearchBox.toggleTab(e.currentPage,e.index),e.createItemBox(!0)):$(this).scrollTop()+$(this).outerHeight()>=$(this)[0].scrollHeight&&e.currentPage<e.pagination.totalPage&&($(".loading-top").remove(),$(this).append("<div class='loading loading-bottom'><img src='../public/img/loading.gif'/></div>"),e.currentPage++,SearchBox.contentList=SearchBox.toggleTab(e.currentPage,e.index),e.createItemBox(!0),$(this).scrollTop(10))})},scrollSearchEvent:function(){var e=this;$(this.rootDiv).find(".mCustomScrollbar").scroll(function(){var t=SearchBox._method.trim(e.searchInputValue);0==$(this).scrollTop()?e.currentPage>1&&($(".loading-bottom").remove(),$(this).prepend("<div class='loading loading-top'><img src='../public/img/loading.gif'/></div>"),e.currentPage--,SearchBox.searchData=SearchBox.onSearchValueChange(t,e.currentPage),e.searchValue=SearchBox.searchData.data,e.searchPagination=SearchBox.searchData.pagination,e.createUl()):$(this).scrollTop()+$(this).outerHeight()>=$(this)[0].scrollHeight&&e.currentPage<e.searchPagination.totalPage&&($(".loading-top").remove(),$(this).append("<div class='loading loading-bottom'><img src='../public/img/loading.gif'/></div>"),e.currentPage++,SearchBox.searchData=SearchBox.onSearchValueChange(t,e.currentPage),e.searchPagination=SearchBox.searchData.pagination,e.searchPagination.currentPage==e.searchPagination.totalPage&&SearchBox.searchData.data.length<10?e.searchValue=e.searchValue.concat(SearchBox.searchData.data):e.searchValue=SearchBox.searchData.data,$(this).scrollTop(10),e.createUl())})},destroy:function(){$(".search-box-wrap")&&$(".search-box-wrap").remove()},createNavbar:function(e){var t="";e&&e.length&&(t+="<ul>",t+='<li class="on">热门</li>',e.forEach(function(a,o){o==e.length-1?t+="<li>其他</li>":t+="<li>"+a+"</li>"}),t+="</ul>"),SearchBox.navItem=t},createWarp:function(e){var t=this.rootDiv=document.createElement("div");$(t).prepend("<input class='search-input-box' placeholder=' "+this.tip+" '/>");var a=this;SearchBox._method.on(this.rootDiv,"click",function(e){SearchBox._method.stopPropagation(e)}),SearchBox._method.on(document,"click",function(e){if(e=SearchBox._method.getEvent(e),SearchBox._method.getTarget(e)==a.input)return!1;a.searchBox&&SearchBox._method.addClass("hide",a.searchBox),a.searchInputBox&&(a.searchInputBox.hide(),a.searchInputBox.val("")),a.ul&&SearchBox._method.addClass("hide",a.ul)}),t.className="search-box-wrap",t.style.position="absolute",t.style.zIndex=999999;var o=this.searchBox=document.createElement("div");o.className="search-box",o.id="searchBox",o.innerHTML=SearchBox.navItem;var i=this.itemBox=document.createElement("div");i.className="item-box",o.appendChild(i),t.appendChild(o),this.createItemBox(!1),this.searchInputBox=$(".search-input-box"),this.searchInputBox.on("click",function(e){}),this.searchInputBox.on("keyup",function(e){e=e||window.event;var t=e.keyCode;SearchBox._method.addClass("hide",a.searchBox);var o=a.searchInputValue=SearchBox._method.trim(this.value);!a.ul||SearchBox._method.hasClass("hide",a.ul)||a.isEmpty||a.KeyboardEvent(e,t),SearchBox.searchData=SearchBox.onSearchValueChange(o,1),a.searchValue=SearchBox.searchData.data,a.searchPagination=SearchBox.searchData.pagination,a.createUl(),a.scrollSearchEvent()})},createItemBox:function(e){var t=SearchBox.contentList.data;this.pagination=SearchBox.contentList.pagination;var a="";$(".loading").remove(),t&&t.length&&(this.defaultText&&(a+='<a href="javascript:;" data-name='+JSON.stringify({})+">"+this.defaultText+"</a>"),e&&this.pagination.currentPage==this.pagination.totalPage&&t.length<10&&(a+=this.itemBox.innerHTML),t.forEach(function(e,t){a+='<a href="javascript:;" data-name='+JSON.stringify(e)+">"+e.name+"</a>"})),this.itemBox.innerHTML=a||"",this.input.parentNode.appendChild(this.rootDiv),this.tabChange(),this.linkEvent()},tabChange:function(){for(var e=SearchBox._method.$("li",this.searchBox),t=SearchBox._method.$("div",this.itemBox),a=this,o=0,i=e.length;o<i;o++)e[o].index=o,e[o].onclick=function(){for(var o=0;o<i;o++)SearchBox._method.removeClass("on",e[o]),SearchBox._method.addClass("hide",t[o]);a.index=this.innerHTML,SearchBox.contentList=SearchBox.toggleTab(1,this.innerHTML),a.createItemBox(!1),SearchBox._method.addClass("on",this),SearchBox._method.removeClass("hide",t[this.index])}},linkEvent:function(){for(var e=SearchBox._method.$("a",this.itemBox),t=this,a=0,o=e.length;a<o;a++)e[a].onclick=function(){var e=$(this).attr("data-name");"{}"==e?(t.input.value="",t.multipleData=[],SearchBox.attrTextModel(t.input.value,[]),SearchBox._method.addClass("hide",t.searchBox),t.searchInputBox.hide(),t.searchInputBox.val("")):t.multipleSign?t.isExistInVal(this.innerHTML)||(t.input.value?t.input.value=t.input.value+t.multipleSign+this.innerHTML:t.input.value=this.innerHTML,t.multipleData.push(JSON.parse(e)),SearchBox.attrTextModel(t.input.value,t.multipleData)):(t.input.value=this.innerHTML,SearchBox.attrTextModel(t.input.value,JSON.parse(e)),SearchBox._method.addClass("hide",t.searchBox),t.searchInputBox.hide(),t.searchInputBox.val(""))}},inputEvent:function(){var e=this;SearchBox._method.on(this.input,"click",function(t){t=t||window.event,e.selectionStart=e.input.selectionStart,e.selectionEnd=e.input.selectionEnd,e.searchBox?e.searchBox&&SearchBox._method.hasClass("hide",e.searchBox)&&(!e.ul||e.ul&&SearchBox._method.hasClass("hide",e.ul))&&(SearchBox._method.removeClass("hide",e.searchBox),e.searchInputBox.show()):e.createWarp(),e.scrollEvent()}),SearchBox._method.on(this.input,"keyup",function(t){if(t=t||window.event,39==t.keyCode||37==t.keyCode)e.selectionEnd=e.input.selectionEnd;else if(8==t.keyCode){var a=e.input.value.slice(0,e.selectionEnd),o=a.split(","),i=e.input.value.split(","),n=[];i.splice(o.length-1,1),i.forEach(function(t){e.multipleData.find(function(e){e.name&&-1!=e.name.indexOf("(")&&(e.name=e.name.split("(")[0]),e.name==t&&n.push(e)})}),e.multipleData=n,e.input.value=i.join(","),e.selectionEnd=e.input.selectionEnd,SearchBox.attrTextModel(e.input.value,e.multipleData)}})},createUl:function(){var e=this,t="",a=SearchBox._method.trim(e.searchInputValue);if($(".loading").remove(),""!==a){var o=[];e.defaultText&&0!==e.searchValue.length&&(t='<li class="cityname" data-name='+JSON.stringify({})+">"+e.defaultText+"</li>",o.push(t));for(var i=0,n=e.searchValue.length;i<n;i++)t=(o.length,'<li class="cityname" data-name='+JSON.stringify(e.searchValue[i])+">"+e.searchValue[i].name+"</li>"),o.push(t);if(this.isEmpty=!1,0==o.length&&(this.isEmpty=!0,t='<li class="empty">对不起，没有找到 "<em>'+a+'</em>"</li>',o.push(t)),this.ul)this.ul&&SearchBox._method.hasClass("hide",this.ul)&&(this.count=0,SearchBox._method.removeClass("hide",this.ul));else{var r=this.ul=document.createElement("ul");r.className="cityslide mCustomScrollbar",this.rootDiv&&this.rootDiv.appendChild(r),this.count=0}this.ul.innerHTML=o.join(""),this.liEvent()}else SearchBox._method.addClass("hide",this.ul),SearchBox._method.removeClass("hide",this.searchBox),e.searchInputBox.show(),e.searchInputBox.val("")},KeyboardEvent:function(e,t){var a=SearchBox._method.$("li",this.ul),o=a.length;switch(t){case 40:this.count++,this.count>o-1&&(this.count=0);for(var i=0;i<o;i++)SearchBox._method.removeClass("on",a[i]);SearchBox._method.addClass("on",a[this.count]);break;case 38:for(this.count--,this.count<0&&(this.count=o-1),i=0;i<o;i++)SearchBox._method.removeClass("on",a[i]);SearchBox._method.addClass("on",a[this.count])}},liEvent:function(){for(var e=this,t=SearchBox._method.$("li",this.ul),a=0,o=t.length;a<o;a++)SearchBox._method.on(t[a],"click",function(t){t=SearchBox._method.getEvent(t);var a=SearchBox._method.getTarget(t),o=$(a).attr("data-name");"{}"==o?(e.input.value="",e.multipleData=[],SearchBox.attrTextModel(e.input.value,[]),SearchBox._method.addClass("hide",e.ul),e.searchInputBox.hide(),e.searchInputBox.val("")):o&&"{}"!=o&&(e.multipleSign?e.isExistInVal(a.innerHTML)||(e.input.value?e.input.value=e.input.value+e.multipleSign+a.innerHTML:e.input.value=a.innerHTML,e.multipleData.push(JSON.parse(o)),SearchBox.attrTextModel(e.input.value,e.multipleData)):(e.input.value=a.innerHTML,SearchBox.attrTextModel(e.input.value,JSON.parse(o)),SearchBox._method.addClass("hide",e.ul),e.searchInputBox.hide(),e.searchInputBox.val("")))}),SearchBox._method.on(t[a],"mouseover",function(e){e=SearchBox._method.getEvent(e);var t=SearchBox._method.getTarget(e);SearchBox._method.addClass("on",t)}),SearchBox._method.on(t[a],"mouseout",function(e){e=SearchBox._method.getEvent(e);var t=SearchBox._method.getTarget(e);SearchBox._method.removeClass("on",t)})},isExistInVal:function(e){e&&-1!=e.indexOf("(")&&(e=e.split("(")[0]);var t=this.input.value;return!(!$.trim(t)||-1==t.indexOf(e))}};