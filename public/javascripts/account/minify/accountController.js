easySpa.require(["widget/slimscroll","widget/prompt","public/common/tableController.js"],function(){app.controller("accountCtrl",["$scope","accountService","accountView","tableService",function(e,t,o,a){function c(e){var t=e?e.length:0;$("#globalization").children("li").each(function(){$(this).children("input").next(".verification").children("span").html("");for(var o=$(this).children("input").val("").attr("data-code"),a=0;a<t;a++)e[a].language.toLowerCase()==o.toLowerCase()&&$(this).children("input").val(e[a].localName)})}e.account={id:0},e.tableAccount={tableHeader:[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("account","account_page_accountType"),Lang.getValByKey("account","account_page_code"),Lang.getValByKey("common","common_page_remarks")],tableBody:[],restURL:"logistics.getAccountTable",restData:{q:"",pageIndex:1,pageSize:10,sort:"code"},selectNumber:0,selectFlag:!1},e.getLanguage=function(){t.getLanguage(function(t){0===t.errorCode&&(e.language=t.data)})},e.getLanguage(),e.getAccountTable=function(t){t&&(e.tableAccount.restData.pageIndex=1),e.q=e.tableAccount.restData.q;var c={urlParams:e.tableAccount.restData};a.getTable(e.tableAccount.restURL,c,function(t){if(0===t.errorCode){e.tableAccount=a.table(e.tableAccount,c,t);var n=o.height("acTable");setTimeout(function(){o.slimscroll(".table-container tbody",n),$(window).resize(function(){n=o.height("acTable"),o.slimscroll(".table-container tbody",n)})},10)}})},e.getAccountTable(),e.delAccount=function(){var c=[],n=a.getSelectTable(e.tableAccount.tableBody);if(!n.length)return o.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_code_noSelected"),type:"errer",manualClose:!0}),!1;angular.forEach(n,function(e){c.push(e.id)});var r={title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("account","account_code_accountConfirm")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){t.delAccount(c,function(t){0===t.errorCode?(o.promptBox({isDelay:!0,contentDelay:t.msg,type:"success"}),o.promptBox("closePrompt"),e.$apply(e.getAccountTable())):o.promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})}}]};o.promptBox(r)};var n=$("#nest-AccountFrom .label-text");o.propmtCostEvent(n),e.addAccount=function(){e.AccountForm.$setPristine(),e.AccountForm.$setUntouched(),e.nestAccountForm=!0,$("#nest-AccountFrom").attr("style","").find(".title").text(Lang.getValByKey("account","account_page_addAccount")),e.accountName="",e.accountCode="",e.remark="",e.textareaNumber=140,$("#globalization").find(".input-text").each(function(){$(this).val(""),$(this).next(".verification").children("span").html("")}),o.loadBarEvent(n),$('button[name="prompt-save"]').addClass("save").removeClass("edit")},e.cancelAccount=function(){e.nestAccountForm=!1,e.account.id&&(e.account.id=0),$("#code-msg").removeClass("remote-invalid")},e.saveAccount=function(){if(e.accountName||e.AccountForm.accountName.$setDirty(),e.accountCode||e.AccountForm.accountCode.$setDirty(),$("#code-msg").hasClass("remote-invalid")||!e.AccountForm.$valid)return void o.displayErrorBox(n);var a=[];$("#globalization").children("li").each(function(){if($.trim($(this).children("input").val())){var e={};e.language=$(this).children("input").attr("data-code"),e.localName=$.trim($(this).children("input").val()),a.push(e)}});var c={urlParams:{name:e.accountName,code:e.accountCode,description:e.remark,i18n:a}};e.account.id?(c.seatParams={id:e.account.id},t.saveEditAccount(c,function(t){t&&0===t.errorCode?(o.promptBox({isDelay:!0,contentDelay:t.msg,type:"success"}),e.nestAccountForm=!1,e.getAccountTable(),e.account.id&&(e.account.id=0)):o.promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})):t.saveAccount(c,function(t){t&&0===t.errorCode?(o.promptBox({isDelay:!0,contentDelay:t.msg,type:"success"}),e.nestAccountForm=!1,e.getAccountTable()):o.promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})},e.checkCode=function(){var o={urlParams:{code:e.accountCode,sid:e.account.id}};e.accountCode&&t.checkCode(o,function(t){0!=t.errorCode?(e.AccountForm.accountCode.errorTips=t.msg,$("#code-msg").removeClass("ng-hide").addClass("remote-invalid")):($("#code-msg").addClass("ng-hide").removeClass("remote-invalid"),e.AccountForm.accountCode.errorTips="")})},e.editAccount=function(a){e.account.id=a,e.AccountForm.accountCode.errorTips="",$("#nest-AccountFrom").attr("style","").find(".title").text(Lang.getValByKey("account","account_page_accountDetail")),e.nestAccountForm=!0,o.loadBarEvent(n),$('button[name="prompt-save"]').addClass("save").removeClass("edit"),t.getAccountDetail(a,function(t){t&&0===t.errorCode&&(e.accountName=t.data.name,e.accountCode=t.data.code,e.remark=t.data.description,e.textareaNumber=140-(e.remark?e.remark.length:0),c(t.data.i18n))})},e.international=function(){window.location.href="#/international?q=account"},e.showTextNumber=function(){e.textareaNumber=140-e.remark.length}}])});