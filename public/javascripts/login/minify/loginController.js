easySpa.require(["public/common/des.js"],function(){app.controller("loginCtrl",["$scope","$http","loginService","loginView",function(e,o,n,l){l.showLoginTimeoutMsg(),e.langModel={},e.langModel.langLibrary=Lang.langLibrary(),e.langModel.showLangTxt=Lang.defaultTxt(),e.langModel.showLangImg=Lang.getCurrentLanguage(),e.langModel.switchLang=function(e){Lang.switchLang(e),window.location.reload()};var i=Lang.getValByKey("login","login_code_userNameTips"),r=Lang.getValByKey("login","login_code_passWordTips"),g=Lang.getValByKey("login","login_code_login"),a=Lang.getValByKey("login","login_code_backtrack");e.loginModel={username:i,password:"",passwordText:r,login:g,backtrack:a,buttonStatus:!1,slideNumber:0,usernameError:!1,passwordError:!1},e.userFocus=function(){e.loginModel.username==i&&(e.loginModel.username="",angular.element($("#username")).css("color","#5d5c5c"))},e.userBlur=function(){e.loginModel.username||(e.loginModel.username=i,angular.element($("#username")).css("color","#cad1da"))},e.passFocus=function(){e.loginModel.passwordText==r&&(angular.element($("#password-text")).css("display","none"),angular.element($("#password")).css("display","block"),$("#password").val("").focus())},e.passBlur=function(){e.loginModel.password||(e.loginModel.passwordText=r,angular.element($("#password-text")).css("display","block"),angular.element($("#password")).css("display","none"))},e.eyeClose=!0,e.eyeOpen=!1,e.show=function(){var o=angular.element($("#password"));"text"==o.attr("type")?o.attr("type","password"):o.attr("type","text"),e.eyeClose=!e.eyeClose,e.eyeOpen=!e.eyeOpen},n.setXtoken(),e.getVcode=function(){n.getCodeImage()},e.getVcode(),e.checkCode=function(){n.checkCode("logistics.checkCode",{validateCode:d.percent()},function(o){e.validateCode=d.percent(),0===o.errorCode?d.success():(e.loginModel.slideNumber++,e.loginModel.slideNumber>4?(e.loginModel.slideNumber=0,angular.element($("#big-img")).css({"background-image":"url(public/img/vcode-loading.png"}).delay(1e3).queue(function(){e.getVcode(),$(this).dequeue()}),d.refresh()):(e.loginModel.slideNumber++,e.loginModel.slideNumber>4?(e.loginModel.slideNumber=0,angular.element($("#big-img")).css({"background-image":"url(public/img/vcode-loading.png"}).delay(1e3).queue(function(){e.getVcode(),$(this).dequeue()}),d.refresh()):(d.failure(),setTimeout(function(){e.getVcode()},1e3))))})};var d=new verCode("#m-code-box","#m-code-img",{tips:Lang.getValByKey("login","login_code_sliderTips")},e.checkCode);d.init(),e.submit=function(){if(1!=e.loginModel.buttonStatus){var o=$.trim(e.loginModel.username),r=$.trim(e.loginModel.password),a=e.validateCode?e.validateCode:0;if($("#login-callback-tips").html(""),!(o&&o!=i||r))return void(e.loginModel.usernameError=e.loginModel.passwordError=!0);if(!o||o==i)return void(e.loginModel.usernameError=!0);if(!r)return void(e.loginModel.passwordError=!0);e.loginModel.login=Lang.getValByKey("login","login_code_logining"),e.loginModel.buttonStatus=!0,n.login("logistics.login",{urlParams:{userName:o,passWord:Des.enc(r),validateCode:a}},function(o){return e.loginModel.login=g,e.loginModel.buttonStatus=!1,0===o.errorCode?(cookie.set("loginSuccess","true",1),void(window.location.href="/")):(e.getVcode(),d.reset(),e.validateCode=0,-1!==o.errorCode?110002===o.errorCode?void e.locking():(o.errorCode,void l.showErrorMsg(o)):void 0)})}},e.keyDownEvent=function(o){"username"==o?e.loginModel.usernameError=!1:"password"==o&&(e.loginModel.passwordError=!1)},e.enterEvent=function(o){13==(window.event?o.keyCode:o.which)&&e.submit()},e.loginModel.loginBox=!0,e.loginModel.forgetBox=e.loginModel.lockingBox=!1,e.locking=function(){e.loginModel.loginBox=!e.loginModel.loginBox,e.loginModel.lockingBox=!e.loginModel.lockingBox},e.forget=function(){e.loginModel.loginBox=!e.loginModel.loginBox,e.loginModel.forgetBox=!e.loginModel.forgetBox},e.backtrack=function(){e.loginModel.loginBox=!e.loginModel.loginBox,e.loginModel.forgetBox=e.loginModel.lockingBox=!1}}])});