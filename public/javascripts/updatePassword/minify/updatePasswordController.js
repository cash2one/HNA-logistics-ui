easySpa.require(["widget/prompt","public/common/des.js"],function(){app.controller("updatePasswordCtrl",["$scope","updatePasswordService","updatePasswordView",function(e,o,t){function n(){document.getElementById("strength_L").style.background="#eeeeee",document.getElementById("strength_M").style.background="#eeeeee",document.getElementById("strength_H").style.background="#eeeeee",e.passWordLevel}function s(e){for(var o=0,t=0;t<4;t++)1&e&&o++,e>>>=1;return o}function r(){return e.oldPassword||e.UpdatePW.oldPassword.$setDirty(),e.newPassword||e.UpdatePW.newPassword.$setDirty(),e.newVertifyPw||e.UpdatePW.newVertifyPw.$setDirty(),"low"!=e.passWordLevel&&"original"!=e.passWordLevel&&(e.newPassword!=e.newVertifyPw?(e.showDiffErr=!0,!1):e.newPassword===e.oldPassword?(e.showOldNewSame=!0,!1):!e.ExistNoSupWord&&!!e.UpdatePW.$valid)}function l(){"low"==e.passWordLevel?e.showPwLow=!0:e.showPwLow=!1}!function(){e.oldPassword="",e.newPassword="",e.newVertifyPw="",e.passWordLevel="original",e.currentUser="",o.getUserProfile(function(o){0==o.errorCode&&(console.log(o,"returnData"),e.currentUser=o.data.accountName)})}(),e.checkPwStrength=function(){var o=e.newPassword;console.log(o,"newPw");var t,r,l,d=0;if(e.ExistNoSupWord=!1,null==o||""==o||void 0==o)t=r=l="#eeeeee",d=0;else{console.log(o.length,"password.length");for(var a=0;a<o.length;a++){var i,w=/[!@#&()_+,.\/\\^]+/,c=/[0-9]+/,g=/[a-z]+/,u=/[A-Z]+/;if(singleWord=o.charAt(a),console.log(singleWord,"singleWord"),c.test(singleWord))i=1;else if(u.test(singleWord))i=2;else if(g.test(singleWord))i=4;else{if(!w.test(singleWord))return e.ExistNoSupWord=!0,void n();i=8}d|=i;var h=s(d)}0==h||o.length>18?(t=r=l="#eeeeee",e.passWordLevel="original"):o.length<6||h<=2?(t="#A7DFF4",r=l="#eeeeee",e.passWordLevel="low"):o.length>=6&&o.length<=9&&3==h||o.length>=6&&o.length<=7&&4==h?(t=l="#eeeeee",r="#6CC8EA ",e.passWordLevel="normal"):o.length>=10&&o.length<=18&&3==h||o.length>=8&&o.length<=18&&4==h?(l="#3BAFDA",t=r="#eeeeee",e.passWordLevel="high"):(t=r=l="#eeeeee",e.passWordLevel="original")}document.getElementById("strength_L").style.background=t,document.getElementById("strength_M").style.background=r,document.getElementById("strength_H").style.background=l},e.checkVertify=function(){e.newPassword!=e.newVertifyPw?e.showDiffErr=!0:e.showDiffErr=!1},e.checknewPW=function(){e.checkOldAndNew(),l()},e.checkOldAndNew=function(){e.newPassword===e.oldPassword?e.showOldNewSame=!0:e.showOldNewSame=!1},e.updatePw=function(){if(r()){var t={urlParams:{oldPassword:Des.enc(e.oldPassword),newPassword:Des.enc(e.newPassword)}};o.updatePassword(t,function(e){0!=e.errorCode?$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0}):($(document).promptBox({isDelay:!0,contentDelay:"密码更新成功，稍后请重新登陆！",type:"success",time:3e3}),setTimeout(function(){o.logout(function(e){if(0===e.errorCode){cookie.delete("token"),cookie.delete("loginSuccess");try{var o=window.location.protocol,t=window.location.hostname,n=window.location.port;top.location.href=o+"//"+t+":"+n+"/login.html#/login"}catch(e){window.location.reload()}}})},3e3))}),console.log("update Ok")}}}])});