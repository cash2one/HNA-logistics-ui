app.controller("ruleCtrl",["$scope","orderNumberService","orderNumberView","tableService",function(e,r,a,t){function o(){"channelNumber"===e.module?(e.serviceRuleRequired=!0,e.productTeamRuleRequired=!1):(e.serviceRuleRequired=!1,e.productTeamRuleRequired=!0),e.informWayTypeRadio=!0,e.informWayNoteRadio=!0,e.informWayMailRadio=!0,e.createWayTypeRadio=!0,e.createWayAutoRadio=!0,e.createWayHandRadio=!0,e.serviceRule="",e.serviceRuleUid="",e.productTeamRule="",e.productTeamRuleId="",e.productRule="",e.productRuleUId="",e.regexRule="",e.regexRuleInfo="",e.regexRuleInfoShow=!1,e.regexFormatRule="",e.regexRuleId="",e.numberPrefix="",e.seriesNumber="",e.seriesNumberError=!1,e.seriesNumberErrorTips="",e.regexWeiRule="",e.numberSuffix="",e.createWayType="1",e.generatorCounter=500,e.thresholdSet=200,e.warningSet="",e.informWayType="email",e.phoneNumber="",e.mailAddress="",$('input[name="phoneNumber"]').css("border-color","#BDBDBD"),e.phoneNumberError=!1,e.phoneNumberErrorTips="",$('input[name="mailAddress"]').css("border-color","#BDBDBD"),e.mailAddressError=!1,e.mailAddressErrorTips=""}function l(r){e.serviceRuleDisabled=r,e.productRuleTeamDisabled=r,e.productRuleDisabled=r,e.regexRuleDisabled=r,"waybillNumber"===e.module?e.numberPrefixDisabled=!0:e.numberPrefixDisabled=r,e.seriesNumberDisabled=r,e.regexWeiRuleDisabled=r,e.numberSuffixDisabled=r,e.generatorCounterDisabled=r,e.thresholdSetDisabled=r,e.warningSetDisabled=r,e.phoneNumberDisabled=r,e.mailAddressDisabled=r}function u(r){var a=/^1(3|5|6|7|8|9)\d{9}$/;r&&!a.test(r)?(e.phoneNumberError=!0,$('input[name="phoneNumber"]').css("border-color","#FA787E"),e.phoneNumberErrorTips=Lang.getValByKey("orderNumber","orderNumber_checkout_reminder")):(e.phoneNumberError=!1,$('input[name="phoneNumber"]').css("border-color","#BDBDBD"),e.phoneNumberErrorTips="")}function d(r){var a=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;r&&!a.test(r)?(e.mailAddressError=!0,$('input[name="mailAddress"]').css("border-color","#FA787E"),e.mailAddressErrorTips=Lang.getValByKey("orderNumber","orderNumber_checkout_reminder")):(e.mailAddressError=!1,$('input[name="mailAddress"]').css("border-color","#BDBDBD"),e.mailAddressErrorTips="")}function i(r){e.currentData=r;var a=!0;-1!==e.seriesNumber.indexOf("-")?e.seriesNumber.split("-").forEach(function(e,t){e.length-1===r.validateLength&&e.indexOf("?")===r.verifyCodeIndex||(a=!1)}):e.seriesNumber.toString().length-1===r.validateLength&&e.seriesNumber.toString().indexOf("?")===r.verifyCodeIndex||(a=!1),a?(e.seriesNumberError=!1,e.seriesNumberErrorTips=""):(e.seriesNumberError=!0,e.seriesNumberErrorTips=Lang.getValByKey("orderNumber","orderNumber_content_regexRule")+r.example)}var s,n,c;e.ruleInfo={id:""},e.ruleUseInfoId=1;var m=$("#nest-ruleInfoFrom .label-text");!function(){barClick(m)}(),"channelNumber"===e.module?(s=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("orderNumber","orderNumber_table_serviceName"),Lang.getValByKey("orderNumber","orderNumber_table_supplier"),Lang.getValByKey("orderNumber","orderNumber_table_rule"),Lang.getValByKey("orderNumber","orderNumber_add_createWay"),Lang.getValByKey("orderNumber","orderNumber_table_status")],n=["10%","19%","16%","26%","12%","12%"],c="logistics.getChannelNumberRule"):(s=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("orderNumber","orderNumber_table_productTeam"),Lang.getValByKey("orderNumber","orderNumber_add_product"),Lang.getValByKey("orderNumber","orderNumber_table_rule"),Lang.getValByKey("orderNumber","orderNumber_table_create"),Lang.getValByKey("orderNumber","orderNumber_table_status")],n=["10%","19%","18%","26%","12%","10%"],c="logistics.getWaybillNumberRule"),e.tableModel={tableHeader:s,tableHeaderSize:n,tableBody:[],restURL:c,restData:{q:"",serviceUid:"",supplierId:"",productUid:"",refParentGroupId:"",productGroupId:"",status:"1",pageIndex:1,pageSize:10,sort:""},selectNumber:0,selectFlag:!1},e.getTable=function(r){e.tableModel.restData.serviceUid=e.ruleInfoServiceUid,e.tableModel.restData.supplierId=e.ruleInfoSupplierId,e.tableModel.restData.productUid=e.ruleInfoProductUid,e.tableModel.restData.refParentGroupId=e.ruleInfoProductTeamFirstId,e.tableModel.restData.productGroupId=e.ruleInfoProductTeamLeafId,r&&(e.tableModel.restData.pageIndex=1,e.tableModel.restData.status=e.ruleUseInfoId);var a={urlParams:e.tableModel.restData};t.getTable(e.tableModel.restURL,a,function(r){if(0===r.errorCode){e.tableModel=t.table(e.tableModel,a,r);var o=$(".order-table-rule").height()-256;setTimeout(function(){$(".table-container tbody").slimscroll({height:o}),$(window).resize(function(){o=$(".order-table-rule").height()-256,$(".table-container tbody").slimscroll({height:o})})},10)}})},e.getTable(),e.resetData=function(){e.tableModel.restData.ruleInfoServiceUid="",e.tableModel.restData.supplierId="",e.tableModel.restData.ruleInfoProduct="",e.tableModel.restData.productUid="",e.tableModel.restData.refParentGroupId="",e.tableModel.restData.productGroupId="",e.ruleInfoService="",e.ruleInfoServiceUid="",e.ruleInfoSupplier="",e.ruleInfoSupplierId="",e.ruleInfoProductTeamFirst="",e.ruleInfoProductTeamFirstId="",e.ruleInfoProductTeamLeaf="",e.ruleInfoProductTeamLeafId="",e.ruleInfoProduct="",e.ruleInfoProductUid="",e.searchProductTeamLeafRules=[],f&&f.clearData(),e.tableModel.restData.status="1",e.ruleUseInfoId="1",e.ruleUseInfo=Lang.getValByKey("orderNumber","orderNumber_select_all"),e.tableModel.restData.pageIndex=1,e.getTable()},e.$watch("tableModel",function(r,a){r!==a&&(e.canStartUse=!1,e.canEndUse=!1,e.selectData=t.getSelectTable(e.tableModel.tableBody),e.selectDataLen=e.selectData.length,angular.forEach(e.selectData,function(r,a){e.selectDataLen>1&&(e.canEndUse=!0,e.canStartUse=!0),(e.selectDataLen=1)&&(3==e.selectData[0].status&&(e.canEndUse=!0),2==e.selectData[0].status&&(e.canStartUse=!0))}))},!0),e.ruleStartUse=function(){var o={},l='<span class="tipContentData">'+Lang.getValByKey("orderNumber","orderNumber_number_example")+"</span>",u=t.getSelectTable(e.tableModel.tableBody);if(!u.length)return a.promptBox({isDelay:!0,type:"errer",manualClose:!0,contentDelay:Lang.getValByKey("common","common_code_noSelected")}),!1;angular.forEach(u,function(e){o={seatParams:{id:e.id}}}),r.orderNumberSimulateUsed(o,function(t){if(0!==t.errorCode)return a.promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0});angular.forEach(t.data,function(e){l+='<span class="tipContentData">['+e+"]</span>"}),l+=Lang.getValByKey("orderNumber","orderNumber_starUse_ruleTips");var u={title:Lang.getValByKey("common","common_prompt_title"),type:"success",content:{tip:l},operation:[{type:"submit",description:Lang.getValByKey("orderNumber","orderNumber_button_startUse"),application:"",operationEvent:function(){r.orderNumberStarUsed(o,function(r){a.promptBox("closePrompt"),0===r.errorCode?(a.promptBox({isDelay:!0,contentDelay:r.msg,type:"success"}),e.getTable(),e.$apply()):a.promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})})}}]};a.promptBox(u),e.$apply()})},e.ruleEndUse=function(){var o={},l=t.getSelectTable(e.tableModel.tableBody);if(!l.length)return a.promptBox({isDelay:!0,type:"errer",manualClose:!0,contentDelay:Lang.getValByKey("common","common_code_noSelected")}),!1;angular.forEach(l,function(e){o={seatParams:{id:e.id}}});var u={title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("orderNumber","orderNumber_endUse_ruleTips")},operation:[{type:"submit",description:Lang.getValByKey("orderNumber","orderNumber_button_endUse"),application:"",operationEvent:function(){r.orderNumberEndUsed(o,function(r){a.promptBox("closePrompt"),0===r.errorCode?(a.promptBox({isDelay:!0,contentDelay:r.msg,type:"success"}),e.getTable(),e.$apply()):a.promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})})}}]};a.promptBox(u)},e.ruleAdd=function(){e.ruleInfoFrom.$setPristine(),e.ruleInfoFrom.$setUntouched(),o(),e.ruleInfo.id="",l(!1),e.regexWeiRuleShow=!1,e.nestRuleInfoFrom=!0,e.productRuleDisabled=!0,$("#nest-ruleInfoFrom").css("display","table"),e.title=Lang.getValByKey("orderNumber","orderNumber_add_rule");var r=$(".language-international input");r.each(function(e){r.eq(e).val("")}),loadBar(m),$(".input-text").removeClass("ng-dirty"),$(".errors").addClass("ng-hide"),$('button[name="prompt-save"]').addClass("save").removeClass("edit")},e.ruleEdit=function(a){e.ruleInfo.id=a,loadBar(m),o(),l(!1),e.regexWeiRuleShow=!1,e.productRuleDisabled=!0,e.nestRuleInfoFrom=!0,$("#nest-ruleInfoFrom").css("display","table"),$(".input-text").removeClass("ng-dirty"),$(".errors").addClass("ng-hide"),$('button[name="prompt-save"]').addClass("save").removeClass("edit"),e.title=Lang.getValByKey("orderNumber","orderNumber_edit_rule"),r.orderNumberGetRuleDetail({seatParams:{id:a}},function(r){if(r&&0===r.errorCode){var r=r.data;2===r.status?(e.informWayTypeRadio=!1,"sms"===r.noticeType?(e.informWayMailRadio=!1,e.informWayNoteRadio=!0):(e.informWayMailRadio=!0,e.informWayNoteRadio=!1),e.createWayTypeRadio=!1,"1"===r.createMethod.toString()?(e.createWayAutoRadio=!0,e.createWayHandRadio=!1):(e.createWayAutoRadio=!1,e.createWayHandRadio=!0),l(!0)):3===r.status&&(r.isUpdateAll?l(!1):(l(!0),e.generatorCounterDisabled=!1,e.thresholdSetDisabled=!1,e.warningSetDisabled=!1,e.phoneNumberDisabled=!1,e.mailAddressDisabled=!1)),"channelNumber"===e.module&&(e.serviceRule=r.refUidName+"("+r.refUidCode+")",e.serviceRuleUid=r.refUid),"waybillNumber"===e.module&&(e.productTeamRule=r.refName,e.productTeamRuleId=r.refId,e.productRuleUId=r.refUid,r.refUidName&&(e.productRule=r.refUidName+"("+r.refUidCode+")")),e.regexRule=r.name,e.regexFormatRule=r.format,e.regexRuleId=r.formatRule,e.numberPrefix=r.prefix,e.seriesNumber=r.serialNumber,-1!==e.seriesNumber.indexOf("?")?(e.currentData={example:r.example,validateLength:r.validateLength,verifyCodeIndex:r.verifyCodeIndex},e.regexWeiRuleShow=!0,e.regexWeiRule=r.verifyName,e.regexWeiRuleCode=r.verifyRule):(e.regexWeiRuleShow=!1,e.regexWeiRuleCode="",e.regexWeiRule=""),e.numberSuffix=r.postfix,e.createWayType=r.createMethod.toString(),"1"===e.createWayType?(e.generatorCounter=r.batchNumber,e.thresholdSet=r.generateThreshold):(e.generatorCounter=500,e.thresholdSet=200),e.warningSet=r.warnThreshold,e.informWayType=r.noticeType,"sms"===e.informWayType?e.phoneNumber=r.receiver:"email"===e.informWayType&&(e.mailAddress=r.receiver)}})},e.closeRule=function(){o(),e.ruleInfo.id="",e.regexWeiRuleShow=!1,$(".input-text").removeClass("ng-dirty"),$(".errors").addClass("ng-hide"),e.nestRuleInfoFrom=!1},e.checkSeriesNumber=function(){e.seriesNumber&&-1!==e.seriesNumber.indexOf("?")?(e.regexWeiRuleShow=!0,$.isEmptyObject(e.currentData)?(e.regexWeiRuleCode="",e.regexWeiRule="",e.seriesNumberError=!1,e.seriesNumberErrorTips=""):i(e.currentData)):(e.regexWeiRuleShow=!1,e.regexWeiRuleCode="",e.regexWeiRule="",e.seriesNumberError=!1,e.seriesNumberErrorTips="",e.currentData={})},e.checkThresholdSet=function(){e.thresholdSet&&e.generatorCounter&&parseInt(e.thresholdSet)>=parseInt(e.generatorCounter)?(e.thresholdSetError=!0,e.thresholdSetErrorTips=Lang.getValByKey("orderNumber","orderNumber_content_thresholdSet")):(e.thresholdSetError=!1,e.thresholdSetErrorTips="")},e.checkPhoneNumber=function(){if(-1!==e.phoneNumber.indexOf(";")||-1!==e.phoneNumber.indexOf("；")){var r=e.phoneNumber.replace(/[;；\/]/g,","),a=!0,t=/^1(3|5|6|7|8|9)\d{9}$/;angular.forEach(r.split(","),function(e,r){e&&!t.test(e)&&(a=!1)}),a?(e.phoneNumberError=!1,$('input[name="phoneNumber"]').css("border-color","#BDBDBD"),e.phoneNumberErrorTips=""):(e.phoneNumberError=!0,$('input[name="phoneNumber"]').css("border-color","#FA787E"),e.phoneNumberErrorTips=Lang.getValByKey("orderNumber","orderNumber_checkout_reminder"))}else u(e.phoneNumber)},e.checkMailAddress=function(){if(-1!==e.mailAddress.indexOf(";")||-1!==e.mailAddress.indexOf("；")){var r=e.mailAddress.replace(/[;；\/]/g,","),a=!0,t=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;angular.forEach(r.split(","),function(e,r){e&&!t.test(e)&&(a=!1)}),a?(e.mailAddressError=!1,$('input[name="mailAddress"]').css("border-color","#BDBDBD"),e.mailAddressErrorTips=""):(e.mailAddressError=!0,$('input[name="mailAddress"]').css("border-color","#FA787E"),e.mailAddressErrorTips=Lang.getValByKey("orderNumber","orderNumber_checkout_reminder"))}else d(e.mailAddress)},e.saveRule=function(){if(e.serviceRule||"channelNumber"!==e.module||e.ruleInfoFrom.serviceRule.$setDirty(),e.productTeamRule||"waybillNumber"!==e.module||e.ruleInfoFrom.productTeamRule.$setDirty(),e.regexRule||e.ruleInfoFrom.regexRule.$setDirty(),e.seriesNumber||e.ruleInfoFrom.seriesNumber.$setDirty(),!e.seriesNumberError&&!e.thresholdSetError){if(!e.regexWeiRule&&e.regexWeiRuleShow&&e.ruleInfoFrom.regexWeiRule.$setDirty(),e.generatorCounter||"1"!==e.createWayType||e.ruleInfoFrom.generatorCounter.$setDirty(),e.thresholdSet||"1"!==e.createWayType||e.ruleInfoFrom.thresholdSet.$setDirty(),"2"===e.createWayType&&(e.generatorCounter=500,e.thresholdSet=200),showErrorModel(m),!e.ruleInfoFrom.$valid)return void scrollToErrorView($(".switch-list"));var t,o,l,u;if("channelNumber"===e.module?(u=e.serviceRuleUid,e.numberSuffix.toUpperCase()):"waybillNumber"===e.module&&(u=e.productRuleUId,""),"sms"===e.informWayType){if(e.phoneNumberError)return;t=e.phoneNumber}else if("email"===e.informWayType){if(e.mailAddressError)return;t=e.mailAddress}"1"===e.createWayType?(o=e.generatorCounter,l=e.thresholdSet):(o="",l="");var d={urlParams:{refUid:u,formatRule:e.regexRuleId,name:e.regexRule,format:e.regexFormatRule,prefix:e.numberPrefix.toUpperCase(),serialNumber:e.seriesNumber,verifyRule:e.regexWeiRuleCode,postfix:e.numberSuffix.toUpperCase(),createMethod:e.createWayType,batchNumber:o,generateThreshold:l,warnThreshold:e.warningSet,noticeType:e.informWayType,receiver:t}};"waybillNumber"===e.module&&(d.urlParams.refId=e.productTeamRuleId),e.ruleInfo.id?(d.seatParams={id:e.ruleInfo.id},r.orderNumberRuleSaveEdit(d,function(r){r&&0===r.errorCode?(a.promptBox({isDelay:!0,contentDelay:r.msg,type:"success"}),e.closeRule(),e.getTable(),e.ruleInfo.id=""):a.promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})})):r.orderNumberRuleSave(d,function(r){r&&0===r.errorCode?(a.promptBox({isDelay:!0,contentDelay:r.msg,type:"success"}),e.closeRule(),e.getTable()):a.promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})})}};var p;e.getSearchServiceData=function(){var t={urlParams:{q:"",pageIndex:1,pageSize:10,status:3},seatParams:{serviceTypeCode:-1},isAsync:!0};e.searchServiceRules=r.getServiceShort(t),a.rebuildServiceName(e.searchServiceRules),p&&p.destroy(),p=selectFactory({data:e.searchServiceRules,id:"search-ruleService",isSearch:!0,pagination:!0,isCreateNewSelect:!0,closeLocalSearch:!0,searchPlaceHoder:Lang.getValByKey("orderNumber","orderNumber_service_placeholder"),onSearchValueChange:function(o,l,u){(l||u)&&(t={urlParams:{q:l,pageIndex:u||1,pageSize:10,status:3},seatParams:{serviceTypeCode:-1},isAsync:!0},e.searchServiceRules=r.getServiceShort(t),a.rebuildServiceName(e.searchServiceRules),o.setData(e.searchServiceRules))},attrTextModel:function(r,a,t){e.ruleInfoServiceUid=t.uid,e.ruleInfoService=t.name,e.$apply()}}),p.open()};var g;e.getSearchSupplierData=function(){var t={urlParams:{q:"",pageIndex:1,pageSize:10}};e.searchSupplierRules=r.getSupplierShort(t),a.rebuildServiceName(e.searchSupplierRules),g&&g.destroy(),g=selectFactory({data:e.searchSupplierRules,id:"search-ruleSupplier",isSearch:!0,pagination:!0,isCreateNewSelect:!0,closeLocalSearch:!0,searchPlaceHoder:Lang.getValByKey("orderNumber","orderNumber_service_placeholder"),onSearchValueChange:function(o,l,u){(l||u)&&(t={urlParams:{q:l,pageIndex:u||1,pageSize:10}},e.searchSupplierRules=r.getSupplierShort(t),a.rebuildServiceName(e.searchSupplierRules),o.setData(e.searchSupplierRules))},attrTextModel:function(r,a,t){e.ruleInfoSupplierId=t.id,e.ruleInfoSupplier=t.name,e.$apply()}}),g.open()};var b;e.getSearchProductTeamFirstData=function(){e.searchProductTeamRules=r.getProductTeamLeafRuleShort(null),b&&b.destroy(),b=selectFactory({data:e.searchProductTeamRules,id:"search-ruleProductTeam-first",isCreateNewSelect:!0,defaultText:Lang.getValByKey("orderNumber","orderNumber_select_all"),attrTextModel:function(r,a,t){$.isEmptyObject(t)&&(e.ruleInfoProductTeamFirst="",e.ruleInfoProductTeamFirstId="",e.searchProductTeamLeafRules=[],f.clearData()),e.ruleInfoProductUid="",e.ruleInfoProduct="",e.ruleInfoProductTeamFirst=t.name,e.ruleInfoProductTeamFirstId=t.id,delete e.ruleInfoProductTeamLeafId,delete e.ruleInfoProductTeamLeaf,e.$apply()}}),b.open()};var f=null;e.getSearchProductTeamLeafData=function(){e.ruleInfoProductTeamFirstId&&(e.searchProductTeamLeafRules=r.getProductTeamLeafRuleShort(e.ruleInfoProductTeamFirstId),f&&f.destroy(),f=selectFactory({data:e.searchProductTeamLeafRules,id:"search-ruleProductTeam-leaf",isCreateNewSelect:!0,defaultText:Lang.getValByKey("orderNumber","orderNumber_select_all"),attrTextModel:function(r,a,t){e.ruleInfoProductUid="",e.ruleInfoProduct="",e.ruleInfoProductTeamLeafId=t.id,e.ruleInfoProductTeamLeaf=t.name,e.$apply()}}),f.open())};var y;e.getSearchProductData=function(){var t={urlParams:{q:"",pageIndex:1,pageSize:10,status:3,includeAllAudit:!0,topGrade:e.ruleInfoProductTeamFirstId||"",secondGrade:e.ruleInfoProductTeamLeafId||""}};e.searchProductRules=r.getProductRuleShort(t),a.rebuildServiceName(e.searchProductRules),y&&y.destroy(),y=selectFactory({data:e.searchProductRules,id:"search-ruleProduct",isSearch:!0,pagination:!0,isCreateNewSelect:!0,closeLocalSearch:!0,searchPlaceHoder:Lang.getValByKey("orderNumber","orderNumber_service_placeholder"),onSearchValueChange:function(o,l,u){(l||u)&&(t={urlParams:{q:l,pageIndex:u||1,pageSize:10,status:3,includeAllAudit:!0,topGrade:e.ruleInfoProductTeamFirstId||"",secondGrade:e.ruleInfoProductTeamLeafId||""}},e.searchProductRules=r.getProductRuleShort(t),a.rebuildServiceName(e.searchProductRules),o.setData(e.searchProductRules))},attrTextModel:function(r,a,t){e.ruleInfoProductUid=t.uid,e.ruleInfoProduct=t.name,e.$apply()}}),y.open()};var h;e.getSearchRuleUseInfoData=function(){var r=[{code:1,name:Lang.getValByKey("orderNumber","orderNumber_select_all")},{code:2,name:Lang.getValByKey("orderNumber","orderNumber_select_stared")},{code:3,name:Lang.getValByKey("orderNumber","orderNumber_select_stopped")}];h&&h.destroy(),h=selectFactory({data:{data:r},id:"rule-useInfo",isCreateNewSelect:!0,defaultText:"",attrTextModel:function(r,a,t){e.ruleUseInfoId=t.code,e.ruleUseInfo=t.name,e.$apply()}}),h.open()};var N;e.getServiceRuleData=function(){var t={urlParams:{q:"",pageIndex:1,pageSize:10,status:3},seatParams:{serviceTypeCode:-1},isAsync:!0};e.addServiceRules=r.getServiceShort(t),a.rebuildServiceName(e.addServiceRules),N&&N.destroy(),N=selectFactory({data:e.addServiceRules,id:"rule-serviceRule",isSearch:!0,pagination:!0,isCreateNewSelect:!0,height:240,closeLocalSearch:!0,searchPlaceHoder:Lang.getValByKey("orderNumber","orderNumber_service_placeholder"),defaultText:Lang.getValByKey("common","common_select_tips"),onSearchValueChange:function(o,l,u){(l||u)&&(t={urlParams:{q:l,pageIndex:u||1,pageSize:10,status:3},seatParams:{serviceTypeCode:-1},isAsync:!0},e.addServiceRules=r.getServiceShort(t),a.rebuildServiceName(e.addServiceRules),o.setData(e.addServiceRules))},attrTextModel:function(r,a,t){e.serviceRuleUid=t.uid,e.serviceRule=t.name,e.$apply()}}),N.open()};var R;e.getProductTeamRuleData=function(){var a;e.addProductTeamRules=r.getProductTeamRuleShort(),a=[{code:2,prefixName:"122"},{code:3,prefixName:"132"},{code:4,prefixName:"112"},{code:5,prefixName:"192"},{code:7,prefixName:"212"},{code:8,prefixName:"222"},{code:9,prefixName:"232"},{code:12,prefixName:"332"},{code:13,prefixName:"392"},{code:17,prefixName:"592"},{code:18,prefixName:"492"},{code:19,prefixName:"692"}],R&&R.destroy(),R=selectFactory({data:e.addProductTeamRules,id:"rule-productTeamRule",isCreateNewSelect:!0,height:240,defaultCount:100,defaultText:Lang.getValByKey("orderNumber","orderNumber_select_tips"),attrTextModel:function(r,t,o){$.isEmptyObject(o)?(e.numberPrefix="",e.productRuleUId="",e.productRule="",e.productRuleDisabled=!0):e.productRuleDisabled=!1,e.productRuleUId="",e.productRule="",angular.forEach(a,function(r,a){r.code===o.id&&(e.numberPrefix=r.prefixName,e.numberPrefixDisabled=!0)}),e.productTeamRuleId=o.id,e.productTeamRule=o.name,e.topGrade=o.parentId,e.$apply()}}),R.open()};var S;e.getProductRuleData=function(){var t={urlParams:{q:"",pageIndex:1,pageSize:10,status:3,includeAllAudit:!0,topGrade:e.topGrade||"",secondGrade:e.productTeamRuleId||""}};e.addProductRules=r.getProductRuleShort(t),a.rebuildServiceName(e.addProductRules),S&&S.destroy(),S=selectFactory({data:e.addProductRules,id:"rule-productRule",isSearch:!0,pagination:!0,isCreateNewSelect:!0,height:240,closeLocalSearch:!0,searchPlaceHoder:Lang.getValByKey("orderNumber","orderNumber_service_placeholder"),defaultText:Lang.getValByKey("common","common_select_tips"),onSearchValueChange:function(o,l,u){(l||u)&&(t={urlParams:{q:l,pageIndex:u||1,pageSize:10,status:3,includeAllAudit:!0,topGrade:e.topGrade||"",secondGrade:e.productTeamRuleId||""}},e.addProductRules=r.getProductRuleShort(t),a.rebuildServiceName(e.addProductRules),o.setData(e.addProductRules))},attrTextModel:function(r,a,t){e.productRuleUId=t.uid,e.productRule=t.name,e.$apply()}}),S.open()};var x;e.getRegexRuleData=function(){x&&x.destroy(),x=selectFactory({data:[],id:"rule-regexRule",isSearch:!0,pagination:!0,isCreateNewSelect:!0,height:240,closeLocalSearch:!0,searchPlaceHoder:Lang.getValByKey("orderNumber","orderNumber_verify_placeholder"),defaultText:Lang.getValByKey("common","common_select_tips"),onSearchValueChange:function(a,t,o){var l={urlParams:{q:t||"",pageIndex:o||1,pageSize:10}};r.getRegexRule(l,function(r){0===r.errorCode&&(e.addRegexRules=r)}),a.setData(e.addRegexRules)},attrTextModel:function(r,a,t){t.name?(e.regexRuleInfo=Lang.getValByKey("orderNumber","orderNumber_title_example")+t.example,e.regexRuleInfoShow=!0):(e.regexRuleInfo="",e.regexRuleInfoShow=!1),e.regexRuleId=t.code,e.regexRule=t.name,e.regexFormatRule=t.format,e.$apply()}}),x.open()};var I;e.getRegexWeiRuleData=function(){r.getRegexWeiRule(function(r){0===r.errorCode&&(I&&I.destroy(),I=selectFactory({data:r,id:"rule-regexWeiRule",defaultText:Lang.getValByKey("orderNumber","orderNumber_select_tips"),isCreateNewSelect:!0,height:120,attrTextModel:function(r,a,t){return $.isEmptyObject(t)?(e.seriesNumberError=!1,e.seriesNumberErrorTips="",e.regexWeiRuleCode="",e.regexWeiRule="",e.currentData={},void e.$apply()):(e.regexWeiRuleCode=t.code,e.regexWeiRule=t.name,e.seriesNumber?(i(t),void e.$apply()):void e.$apply())}}),I.open())})}}]);