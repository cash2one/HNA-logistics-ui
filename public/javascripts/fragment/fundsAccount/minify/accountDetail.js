app.controller("accountDetailCtr",["$scope","fundsAccountService","fundsAccountView","tableService","eventServiceFactory",function(e,t,a,n,c){a.initCalander(),e.initData=function(t){e.thirdPayAccountId=t.thirdPayAccountId,e.accountInfo={custName:t.custName,currencyCode:t.currencyCode},e.accountBank={},e.signatureData={},e.advanced=!1,e.advancedText="高级筛选",e.tableModel={tableHeader:["交易单号","交易时间","对方账户持有人","账单号","交易金额("+t.currencyCode+")","交易类型"],tableBody:[],restURL:"logistics.getAccountRecord",restData:{q:"",beginDate:"",endDate:"",tranType:"",pageIndex:1,pageSize:10},selectNumber:0,selectFlag:!1}},e.getAccountInfo=function(){var a={seatParams:{thirdPayAccountId:e.thirdPayAccountId}};t.getAccountInfo(a,function(a){0===a.errorCode&&(e.accountInfoTotalAmount=t.dealNumber(a.data.totalAmount),e.accountInfoTotalBalance=t.dealNumber(a.data.totalBalance),e.accountInfo=$.extend({},e.accountInfo,a.data)||{})})},e.getCustomerId=function(){t.getCustomerId(function(t){0===t.errorCode?(e.hrefPay=t.data.dsptUrl,e.hrefBasic=t.data.qywyUrl):setTimeout(function(){$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})},0)})},e.getAccountBank=function(){var a={seatParams:{thirdPayAccountId:e.thirdPayAccountId}};t.getAccountBank(a,function(t){0===t.errorCode&&(e.accountBank=t.data||{})})},e.getAccountRecord=function(){var t={urlParams:e.tableModel.restData,seatParams:{custAcctId:e.accountInfo.custAcctId}};n.getTable(e.tableModel.restURL,t,function(a){0===a.errorCode&&(e.tableModel=n.table(e.tableModel,t,a))})},e.filters=function(){e.tableModel.restData.beginDate=getBeforeDate(6),e.tableModel.restData.endDate=(new Date).format("yyyy-MM-dd"),e.advanced?(e.advancedText="高级筛选",e.statusName=e.statusValue="",e.searchRecord()):e.advancedText="普通筛选",e.advanced=!e.advanced},e.searchRecord=function(){e.q=e.tableModel.restData.q,e.tableModel.restData.tranType=e.statusValue||"",e.getAccountRecord()},e.getStatus=function(){selectFactory({data:{data:[{id:"0",name:"充值"},{id:"1",name:"提现"},{id:"2",name:"付款"},{id:"3",name:"收款"}]},defaultText:"全部",id:"select-status",showTextField:"name",attrTextModel:function(t,a,n){e.statusValue=n.id||"",e.statusName=n.name||"",e.$apply()}}).open()},e.bankManager=function(t){r.dispatch("bankManagerData",{thirdPayAccountId:e.thirdPayAccountId}),e.$parent.block=t},e.getRecordDetail=function(t){e.$parent.block="businessRecord",r.dispatch("businessRecordData",{thirdPayAccountId:e.thirdPayAccountId,item:t,accountId:e.accountInfo.accountId,currency:e.accountInfo.currency,currencyCode:e.accountInfo.currencyCode})},e.getBillDetail=function(t){if(2==t.tranTypeCode)var a="pay";else{if(3!=t.tranTypeCode)return;var a="receive"}window.location.href="#/billDetail?billNo="+t.billNo+"&from=fundsAccount&module=trade&submodule="+a+"&thirdPayAccountId="+e.thirdPayAccountId+"&custName="+e.accountInfo.custName+"&currency="+e.accountInfo.currencyCode+"&customerId="+t.outCustomerId},e.withdraw=function(t){r.dispatch("withdrawApplyData",{thirdPayAccountId:e.thirdPayAccountId,accountBank:e.accountBank,accountInfo:e.accountInfo}),e.$parent.block=t},e.reCharge=function(a){t.getRechargeInfo(function(t){0===t.errorCode?(e.showRecharge=!0,e.bankCode=t.data.account,e.bankName=t.data.name,e.$apply()):$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})},e.goBack=function(){e.$parent.block="accountManager",r.dispatch("accountManagerData",{})},e.transPassword=function(t){var a=e.getTransPassSignature();a.type=t;for(var n=!1,c=[{key:"name",require:!0},{key:"orderid",require:!0},{key:"type",require:!0},{key:"p2PCode",require:!0},{key:"p2PType",require:!0},{key:"thirdCustId",require:!0},{key:"custAccId",require:!0},{key:"mobile",require:!0},{key:"orig",require:!1},{key:"returnurl",require:!1},{key:"notifyUrl",require:!0},{key:"channelType",require:!1},{key:"idType",require:!0},{key:"idNo",require:!0},{key:"accNo",require:!0},{key:"accName",require:!0}],r=0,o=c.length;r<o;r++)$("#"+c[r].key+"-pass").val(a[c[r].key]),c[r].require&&!$.trim(a[c[r].key])&&(n=!0);$("#returnurl-pass").val("https://www.baidu.com/"),n||$("#passwordForm").submit()},e.getTransPassSignature=function(){var a={seatParams:{thirdCustId:e.thirdPayAccountId}};return t.getTransPassSignature(a,function(t){e.signatureData=t.data||{}}),e.signatureData},e.init=function(t){e.initData(t),e.showRecharge=!1,e.getAccountInfo(),e.getAccountBank(),e.getAccountRecord(),e.getCustomerId()};var r=c.createEventService();r.on("accountDetailData",e.init)}]);