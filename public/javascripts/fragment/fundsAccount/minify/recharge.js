app.controller("rechargeCtr",["$scope","eventServiceFactory","fundsAccountService",function(a,t,e){a.init=function(t){a.initData(t)};var r=t.createEventService();r.on("rechargeData",a.init),a.initData=function(t){a.thirdPayAccountId=t.thirdPayAccountId,a.accountInfo=t.accountInfo||{},a.billInfo=t.billInfo,a.from=t.from,a.money="",a.availableBalance=e.digital(a.accountInfo.availableBalance),a.subbranch="",a.bankName="",a.bankNo="",a.note="",a.subbranchListData="",Select.sharePool["select-subbranch-list"]&&(Select.sharePool["select-subbranch-list"].clearData(),Select.sharePool["select-subbranch-list"].destroy()),a.rechargeForm.$setPristine(),a.rechargeForm.$setUntouched()},a.moneyChanged=function(){var t=e.digital(a.money),r=e.digital(a.accountInfo.availableBalance);t=t<=0?0:t,a.availableBalance=r+t},a.getSubbranchList=function(){if(!a.subbranchListData){var t={seatParams:{thirdPayAccountId:a.thirdPayAccountId}};e.getBankVerdCardList(t,function(t){a.subbranchListData=t.data,angular.forEach(a.subbranchListData,function(a,t){a.cardNo&&(a.reName=a.bank+"（尾号"+a.cardNo.slice(-4)+"）")})})}a.subbranchListData&&selectFactory({data:{data:a.subbranchListData},defaultText:"请选择",id:"select-subbranch-list",defaultCount:1e4,showTextField:"reName",isCreateNewSelect:!0,attrTextModel:function(t,e,r){a.subbranch=r.reName||"",a.bankName=r.bank||"",a.bankNo=r.cardNo||"",a.$apply()}}).open()},a.submitRecharge=function(){if(a.money||a.rechargeForm.money.$setDirty(),a.subbranch||a.rechargeForm.subbranch.$setDirty(),a.note||a.rechargeForm.note.$setDirty(),!a.rechargeForm.$valid)return!1;var t={urlParams:{ccyCode:a.accountInfo.currency,note:a.note,thirdCustId:a.thirdPayAccountId,tranAmount:a.money,bankNo:a.bankNo,bankName:a.bankName}};e.submitRecharge(t,function(e){if(e.thirdMsg=e.data&&e.data.rspMsg?e.data.rspMsg:e.msg,e.data)switch(e.data.status){case 0:e.data.statusValue="成功";break;case 1:e.data.statusValue="失败";break;case 2:e.data.statusValue="待确认";break;case 3:e.data.statusValue="处理中";break;default:e.data.statusValue="异常"}0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.thirdMsg,type:"success"}),a.$parent.block="rechargeResult",r.dispatch("rechargeResultData",{thirdPayAccountId:a.thirdPayAccountId,accountInfo:a.accountInfo,isSuccess:!0,rechargeData:t.urlParams,reChargeResult:e.data,from:a.from,billInfo:a.billInfo})):(a.$parent.block="rechargeResult",r.dispatch("rechargeResultData",{thirdPayAccountId:a.thirdPayAccountId,accountInfo:a.accountInfo,isSuccess:!1,rechargeData:t.urlParams,reChargeResult:e.data,from:a.from,billInfo:a.billInfo}))})},a.goBack=function(){a.$parent.block=a.from}}]);