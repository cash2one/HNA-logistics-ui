app.controller("withdrawApplyCtr",["$scope","eventServiceFactory","fundsAccountService",function(t,a,r){t.init=function(a){t.initData(a)};var o=a.createEventService();o.on("withdrawApplyData",t.init),t.initData=function(a){t.thirdPayAccountId=a.thirdPayAccountId,t.accountBank=a.accountBank,t.accountInfoTotalBalance=r.dealNumber(a.accountInfo.totalBalance),t.accountInfo=a.accountInfo||{},t.withdrawAmount="",t.note="",t.feeMoney="0.00",t.arrivedMoney="0.00",t.withdrawAmountError=!1,t.withdrawAmountErrorTips="",t.withdrawForm.$setPristine(),t.withdrawForm.$setUntouched()},t.takeAll=function(){t.withdrawAmount=r.digital(t.accountInfo.totalBalance),t.getFeeCheck()},t.checkWithdrawAmount=function(){r.digital(t.withdrawAmount)>r.digital(t.accountInfo.totalBalance)?(t.withdrawAmountError=!0,t.withdrawAmountErrorTips="提现金额不能超过可用余额!"):(t.withdrawAmountError=!1,t.withdrawAmountErrorTips="")},t.getFeeCheck=function(){var a=r.digital(t.withdrawAmount),o=r.digital(t.accountInfo.totalBalance);if(!a)return t.feeMoney="0.00",t.arrivedMoney="0.00",void(t.withdrawAmount=a.toFixed(2));if(a>o)return t.withdrawAmountError=!0,void(t.withdrawAmountErrorTips="提现金额不能超过可用余额!");t.withdrawAmountError=!1,t.withdrawAmountErrorTips="";var c={urlParams:{custAcctId:t.accountInfo.custAcctId,thirdCustId:t.accountInfo.thirdCustId,custName:t.accountInfo.custName,outAcctId:t.accountBank.cardNo,outAcctIdName:t.accountBank.bank,ccyCode:t.accountInfo.currency,tranAmount:a}};r.getFeeCheck(c,function(o){if(0===o.errorCode){var c=r.digital(o.data),n=a-c;t.feeMoney=r.dealNumber(o.data),t.arrivedMoney=r.dealNumber(n)}else $(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})},t.submitWithdraw=function(a){if(a.preventDefault(),"0.00"==t.withdrawAmount||"0"==t.withdrawAmount)return t.withdrawAmount="",!1;if(t.withdrawAmount||t.withdrawForm.withdrawAmount.$setDirty(),t.note||t.withdrawForm.note.$setDirty(),t.withdrawAmountError)return!1;if(!t.withdrawForm.$valid)return!1;var c={urlParams:{custAcctId:t.accountInfo.custAcctId,thirdCustId:t.accountInfo.thirdCustId,custName:t.accountInfo.custName,outAcctId:t.accountBank.cardNo,outAcctIdName:t.accountBank.bank,ccyCode:t.accountInfo.currency,tranAmount:t.withdrawAmount,handFee:t.feeMoney,note:t.note}};r.withdrawCallback(c,function(a){if(a.data)switch(a.data.status){case 0:a.data.statusValue="成功";break;case 1:a.data.statusValue="失败";break;case 2:a.data.statusValue="待确认";break;case 3:a.data.statusValue="处理中";break;default:a.data.statusValue="异常"}0==a.errorCode?($(document).promptBox({isDelay:!0,contentDelay:"提现成功!",type:"success"}),t.$parent.block="rechargeResult",o.dispatch("rechargeResultData",{thirdPayAccountId:t.thirdPayAccountId,accountInfo:t.accountInfo,isSuccess:!0,rechargeData:c.urlParams,reChargeResult:a.data,from:"accountDetail"})):$(document).promptBox({isDelay:!0,contentDelay:"提现失败!"+a.msg,type:"errer",manualClose:!0})})},t.withdrawResult=function(a){t.withdrawPrompt=!1},t.goBack=function(){t.$parent.block="accountDetail",o.dispatch("accountDetailData",{thirdPayAccountId:t.thirdPayAccountId,custName:t.accountInfo.custName,currencyCode:t.accountInfo.currencyCode})}}]);