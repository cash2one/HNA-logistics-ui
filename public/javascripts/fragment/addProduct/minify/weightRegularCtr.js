app.controller("weightRegularCtr",["$scope","addProductService",function(e,a){function t(){e.data.remarkVolume=e.dataOld.remarkVolume,e.data.valueMode=e.dataOld.valueMode,e.data.valueModeCode=e.dataOld.valueModeCode,e.data.volumeFactor=e.dataOld.volumeFactor}function o(){var t=a.getWeightValueMode();selectFactory({data:t,id:"type-select-input",defaultText:Lang.getValByKey("common","common_select_tips"),attrTextModel:function(a,t,o){a?(e.data.valueModeCode=o.code,e.data.valueMode=a,e.weightRegularForm.valueMode.$setPristine()):(e.data.valueMode="",e.data.valueModeCode=""),e.$apply()}})}function d(){e.data={remarkVolume:"false",volumeFactor:"",valueMode:"",valueModeCode:""},e.showVolumeDetail=!1,a.getWeightRule(e.id,function(a){var t=a.data;t.isVolume&&(e.data.remarkVolume="true",e.data.volumeFactor=t.volumeFactor,e.data.valueModeCode=t.weightValueTye,"max"==t.weightValueTye?e.data.valueMode="实重和体积重取最大":e.data.valueMode="实重和体积重取最小",e.showVolumeDetail=!0),e.dataOld=$.extend(!0,e.dataOld,e.data),e.$apply(),e.weightRegularForm.volumeFactor.$setPristine()}),i()}function i(){"true"==e.data.remarkVolume?e.isremarkVolume="是":e.isremarkVolume="否"}function l(a,t){t(a,function(a){0!=a.errorCode?$(document).promptBox({isDelay:!0,contentDelay:a.msg,type:"errer",manualClose:!0}):(d(),e.$parent.isEdit=!1,$(document).promptBox({isDelay:!0,contentDelay:a.msg,type:"success",time:3e3}))})}function u(){return e.data.volumeFactor||e.weightRegularForm.volumeFactor.$setDirty(),e.data.valueMode||e.weightRegularForm.valueMode.$setDirty(),!!e.weightRegularForm.$valid}e.$on("weightRegularEvent",function(){e.isEdit=!1,e.init(),e.$apply()}),e.editWeightInfo=function(){e.isEdit=!0,e.$parent.isEdit=!0,sessionStorage.setItem("isEdit",1),e.canEditWeight=!1},e.cancel=function(){e.isEdit=!1,e.$parent.isEdit=!1,sessionStorage.setItem("isEdit",""),e.canEditWeight=!0,t(),e.showVolumeDetail="true"==e.dataOld.remarkVolume},e.SetIsConsiderVolume=function(){"false"==e.data.remarkVolume?e.showVolumeDetail=!1:(e.showVolumeDetail=!0,e.dataOld.valueModeCode?(e.data.valueMode=e.dataOld.valueMode,e.data.valueModeCode=e.dataOld.valueModeCode):(e.data.valueMode="实重和体积重取最大",e.data.valueModeCode="max"),e.data.volumeFactor=e.dataOld.volumeFactor),e.weightRegularForm.$setPristine()},e.init=function(){o(),d(),sessionStorage.getItem("backPricePath")?e.canEditWeight=!1:e.isAudit?(e.IsDraftStatus||e.isOffline)&&(e.canEditWeight=!0):e.IsDraftStatus&&(e.canEditWeight=!0)},e.saveDraft=function(){if("true"!=e.data.remarkVolume||u()){var t={urlParams:{isVolume:"true"==e.data.remarkVolume,volumeFactor:e.data.volumeFactor,weightValueTye:e.data.valueModeCode},seatParams:{uid:e.uid}};e.isEdit=!1,sessionStorage.setItem("isEdit",""),e.canEditWeight=!0,l(t,a.addProductServiceWeight)}}}]),window.onbeforeunload=function(){sessionStorage.setItem("isEdit","")};