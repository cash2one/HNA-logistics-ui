app.controller("customerContacterCtrl",["$scope","customerService","tableService",function(t,e,a){function o(){$(".table-container tbody").slimScroll({height:$(".content-main").height()-250})}function n(){var e={urlParams:t.tableModel.restData};a.getTable(t.tableModel.restURL,e,function(n){t.q=t.tableModel.restData.q,$(".table-box").css("zoom","1.0000001"),0===n.errorCode&&(t.tableModel=a.table(t.tableModel,e,n),setTimeout(function(){o(),$(window).on("resize",o),$(".table-box").focus(),resizeTable(),t.$apply(),$(".table-box").css("zoom","1")},400))})}function r(){t.tableModel={tableHeader:[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("common","common_table_full_name"),Lang.getValByKey("common","common_thead_department"),Lang.getValByKey("common","common_thead_job"),Lang.getValByKey("common","common_thead_phone"),Lang.getValByKey("common","common_table_telephone"),Lang.getValByKey("common","common_table_responsibility"),Lang.getValByKey("common","common_table_remark")],tableBody:[],tableHeaderSize:["4%","13%","13%","13%","13%","13%","13%","13%"],restURL:"logistics.getClientContacter",restData:{q:"",sortName:"id",refCustomerId:t.customerId,isAsc:!1,pageIndex:1,pageSize:10},selectNumber:0,selectFlag:!1},n()}function i(){t.data={name:"",department:"",function:"",mobilePhone:"",phone:"",duty:"",description:"",refCustomerId:t.customerId},t.IsEdit=!1,t.textareaNumber=140,t.remark="",t.ClientContacter.$setPristine()}function d(e,a,o){a(e,function(e){0!=e.errorCode?$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0}):(t.closePrompt(),$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),o())})}function c(){return t.data.department=void 0===t.data.department?"":t.data.department.replace(/(^\s*)|(\s*$)/g,""),t.data.function=void 0===t.data.function?"":t.data.function.replace(/(^\s*)|(\s*$)/g,""),t.data.duty=void 0===t.data.duty?"":t.data.duty.replace(/(^\s*)|(\s*$)/g,""),t.data.name||t.ClientContacter.clientUser.$setDirty(),t.data.department||t.ClientContacter.department.$setDirty(),t.data.function||t.ClientContacter.function.$setDirty(),t.data.mobilePhone||t.ClientContacter.mobilePhone.$setDirty(),t.data.duty||t.ClientContacter.duty.$setDirty(),!!(t.ClientContacter.$valid&&t.data.department&&t.data.function&&t.data.duty)}t.$on("clientContacterEvent",function(e,a){r(),i(),t.resetStyle(0),t.showPrompt=!1,t.$apply()}),t.closePrompt=function(){t.showPrompt=!1,t.IsEdit=!1,i()},t.savePrompt=function(){var a=t.data;if(!c())return void scrollToErrorView($(".client-contacter-switch-list"));t.IsEdit?d(a,e.modifyClientContacter,n):d(a,e.addClientContacter,n),t.showPrompt=!1,i(),t.IsEdit=!1},t.addContactPerson=function(){t.showPrompt=!0},t.deleteContactPerson=function(){var o=Lang.getValByKey("customer","customer_prompt_deleteClientCustomer_tip");a.delTableListById(t.tableModel,o,e.deleteClientContacterList,n)},t.showTextNumber=function(){t.data&&t.data.description&&t.data.description.length&&(t.textareaNumber=140-t.data.description.length,t.data.descriptith>=140&&(t.textareaNumber=0,t.data.description=".remark-info textArea".val().substring(0,140)))},t.editClientUser=function(e){t.showPrompt=!0,t.IsEdit=!0,t.data.name=e.name,t.data.department=e.department,t.data.function=e.function,t.data.mobilePhone=e.mobilePhone,t.data.phone=e.phone,t.data.duty=e.duty,t.data.id=e.id,t.data.description=e.description,t.showTextNumber()}}]);