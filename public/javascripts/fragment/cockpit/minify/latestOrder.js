easySpa.require(["widget/select","public/common/tableController.js"],function(){app.controller("latestOrderCtrl",["$scope","$route","cockpitService","tableService",function(e,t,r,a){function o(){e.logisticsList=[],e.tradeList=[],e.saleList=[],e.purchaseList=[],"saleOrder"===t.current.params.from?(i(),e.tradeList=e.saleList,e.statesName="贸易-销售订单",e.stateCode="tradeSale",e.showLogisticsTable=!1):"purchaseOrder"===t.current.params.from?(d(),e.tradeList=e.purchaseList,e.statesName="贸易-采购订单",e.stateCode="tradePurchase",e.showLogisticsTable=!1):(s(),e.statesName="物流",e.stateCode="logistics",e.showLogisticsTable=!0)}function s(){e.tableModel={tableBody:[],restUrl:"logistics.getOrdersTable",restData:{sort:"createTime",pageIndex:1,pageSize:10,asc:!1}};var t={urlParams:e.tableModel.restData};a.getTable(e.tableModel.restUrl,t,function(r){0===r.errorCode&&(e.tableModel=a.table(e.tableModel,t,r),setTimeout(function(){e.$apply()},10))})}function i(){r.getTrdOrderList({urlParams:{sort:"createTime",orderType:"SALE",pageIndex:1,pageSize:10,asc:!1}},function(t){0===t.errorCode&&(e.saleList=t.data)})}function d(){r.getTrdOrderList({urlParams:{sort:"createTime",orderType:"PURCHASE",pageIndex:1,pageSize:10,asc:!1}},function(t){0===t.errorCode&&(e.purchaseList=t.data)})}e.$on("changeToIndicator",function(e,t){o()}),t.current.params&&(o(),function(){var t={data:[{name:"物流",code:"logistics"},{name:"贸易-销售订单",code:"tradeSale"},{name:"贸易-采购订单",code:"tradePurchase"}]};selectFactory({data:t,id:"states",defaultText:null,attrTextModel:function(t,r,a){"logistics"===a.code?(e.logisticsList.length<1&&s(),e.statesName="物流",e.stateCode="logistics",e.showLogisticsTable=!0):"tradeSale"===a.code?(e.saleList.length<1&&i(),e.statesName="贸易-销售订单",e.stateCode="tradeSale",e.showLogisticsTable=!1,e.tradeList=e.saleList):(e.purchaseList.length<1&&d(),e.statesName="贸易-采购订单",e.stateCode="tradePurchase",e.showLogisticsTable=!1,e.tradeList=e.purchaseList),e.$apply()}})}(),e.orderGoodsMsg=function(e){var t="";return t+="名称: "+e.goodsName+"\n",e.goodsNum?t+="数量: "+e.goodsNum+" "+e.goodsUnit+"\n":t+="数量: "+e.minLimit+" - "+e.maxLimit+" "+e.goodsUnit+"\n",t+="单价: "+e.goodsPrice+" "+e.goodsCurrencyType},e.jumpToLogisticsOrder=function(e,t){window.location.href="#/confirmOrder?orderNum="+e+"&orderStatus="+t+"&from=orderSearch&orderFrom=cockpit"},e.jumpToTradeOrder=function(e){var t,r=e.orderNo;"SALE"===e.orderType?(t="1"===e.orderStatusCode?"detail":"sdetail",window.location.href="#/tradeOrderSearch?orderFrom=cockpit&cockpitType=sale&cockpitPage="+t+"&orderNo="+r):(t="5"===e.orderStatusCode?"sdetail":"detail",window.location.href="#/tradeOrders?module=trade&action=purchase&orderFrom=cockpit&cockpitPage="+t+"&orderNo="+r)})}])});