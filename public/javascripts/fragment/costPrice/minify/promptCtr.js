app.controller("promptCtr",["$scope",function(e){function a(){$("#adjust-error-msg").addClass("errors"),$("#adjust-error-msg").html(Lang.getValByKey("price","price_adjust_error_tips")),$("#adjust-error-msg").removeClass("ng-hide")}function t(){$("#adjust-error-msg").removeClass("errors"),$("#adjust-error-msg").html(""),$("#adjust-error-msg").addClass("ng-hide")}var r=null,s=location.href.indexOf("costPrice")>-1?"#/priceDetail?module=costPrice&q=price":"#/priceDetail?module=salesPrice&q=price";e.$on("resetDataEvent",function(a,s){e.priceType=1,e.adjustVal="0",e.adjustType=Lang.getValByKey("price","price_change_up"),e.adjustUnit=Lang.getValByKey("price","price_percent"),e.adjustTypeId="1",e.adjustUnitId="1",e.uid=s.uid,r=s.service,t()}),e.isOk=function(){e.verifyFormat()&&(e.adjustType==Lang.getValByKey("price","price_change_down")&&e.adjustUnit==Lang.getValByKey("price","price_percent")&&e.adjustVal&&(parseFloat(e.adjustVal)<0||parseFloat(e.adjustVal)>100)?a():t())},e.verifyFormat=function(){if(e.adjustVal){return/^(\d{1}|[1-9][0-9]*)$|^(0{1}|[1-9][0-9]*)\.\d{1,3}$/.test(e.adjustVal)?(t(),!0):($("#adjust-error-msg").addClass("errors"),$("#adjust-error-msg").html("请输入数字和小数点，可精确到小数点后3位"),$("#adjust-error-msg").removeClass("ng-hide"),!1)}},e.savePrompt=function(){if(!$("#adjust-error-msg").hasClass("errors")){var a={priceType:e.priceType,adjustTypeId:e.adjustTypeId,adjustVal:e.adjustVal,adjustUnitId:e.adjustUnitId,uid:e.uid};a=encodeURIComponent(JSON.stringify(a)),location.href=s+"&data="+a}},selectFactory({data:{data:[{name:Lang.getValByKey("price","price_change_up"),id:1},{name:Lang.getValByKey("price","price_change_down"),id:2}]},id:"adjust-type",defaultText:"",attrTextModel:function(a,t,r){e.adjustType=a,e.adjustTypeId=r.id,e.$apply(),e.isOk()}}),selectFactory({data:{data:[{name:Lang.getValByKey("price","price_percent"),id:1},{name:Lang.getValByKey("price","price_money"),id:2}]},id:"adjust-unit",defaultText:"",attrTextModel:function(a,t,r){e.adjustUnit=a,e.adjustUnitId=r.id,e.$apply(),e.isOk()}})}]);