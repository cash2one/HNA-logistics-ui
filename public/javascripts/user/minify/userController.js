easySpa.require(["widget/slimscroll","widget/nestable","widget/prompt","widget/tabTabs","widget/select","public/common/tableController.js"],function(){app.controller("userCtrl",["$scope","userService","userView","tableService",function(e,t,o,a){function n(){$("#tree").nestable({iconOpen:"icon-organization-Open",iconClose:"icon-organization-Close",iconSeat:"icon-organization",isMove:!0,isOperate:!0,isRoot:!0,userCount:"",childUrl:Interface.getUrlById("logistics.treeChildUrl"),searchUrl:Interface.getUrlById("logistics.searchTreeUrl"),searchInput:$("input[name=organization]"),searchKeyNodes:function(e){r(e)},searchTip:Lang.getValByKey("user","user_tree_search"),clickNode:function(e){r(e,"clickNode")},loadFirstNode:function(e){r(e)},collapseAllNode:function(e){r(e)},treeScrollHeight:$(".tree-scroll-box")})}function r(t,o){e.undefinedShow=!1,e.userOrgId=t;var n=$('input[name="LockUser"]');n.removeClass("active").removeAttr("checked"),n.hasClass("active")?(i(),$(window).on("resize",i)):(l(),$(window).on("resize",l)),e.tableModel.restData.locked=-1,"clickNode"==o&&(e.retrievalUser(o),e.tableModel.restData.q="");var r={urlParams:e.tableModel.restData,seatParams:{uid:t}};a.getTable(e.tableModel.restURL,r,function(t){0===t.errorCode&&(e.tableModel=a.table(e.tableModel,r,t))}),e.$apply()}function i(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-300})}function l(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-270})}function s(o,a){t.getUserDetail({seatParams:{userId:o}},function(o){if(0==o.errorCode){var n=o.data;"edit"==a?(e.main=!0,e.editDetail=!0,e.editHide=!0,e.visible=!1,e.validate=!1,e.validateRequired=!1,e.closeEditDetail=!1):(e.main=!0,e.editDetail=!0,e.editHide=!0,e.visible=!1,e.validate=!0,e.validateRequired=!1,e.closeEditDetail=!1),e.id=n.id,e.fullName=n.fullName,e.code=n.code,t.getPositionsData(function(t){e.positions=t.data,e.position=!1;for(var o in t.data)n.positionCode==t.data[o].code&&(e.positionName=t.data[o].name)}),e.orgName=n.orgName,e.orgId=n.orgId,e.positionCode=n.positionCode,e.mobilephone=n.mobilephone,e.telephone=n.telephone,e.email=n.email,e.description=n.description,e.avatarPath=n.avatarPath?n.avatarPath:"/public/img/avatar2.png",e.avatarFile={},e.avatarId=n.avatarId;var r="";"m"==n.sex?(r=Lang.getValByKey("user","user_radio_man"),e.sexInfo="m"):"f"==n.sex?(r=Lang.getValByKey("user","user_radio_woman"),e.sexInfo="f"):0==n.sex&&(r=Lang.getValByKey("user","user_radio_no"),e.sexInfo="null"),e.sex=r}else $(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})}function i(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-320})}function l(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-270})}function d(o){var a={urlParams:o};t.deleteUsers(a,function(e){if(0==e.errorCode){$(document).promptBox("closePrompt");for(var t in o)$('tr[data-id="'+o[t]+'"]').remove();r($("#tree .dd3-content.active").parent().data("uid")),$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success"})}else $(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})}),e.$apply()}function m(){var o=[],a=$('.user-table tbody input[checked="checked"]');a.each(function(e){o.push(a.eq(e).val())});var i={seatParams:{targetorgid:$("#moveUser .dd3-content.active").parent().data("uid")},urlParams:o};t.moveUsers(i,function(t){if(0===t.errorCode){r(e.userOrgId||$("#tree .dd3-content.active").parent().data("uid")),n(),$(document).promptBox("closeFormPrompt"),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})}else $(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})}e.tableModel={more:!1,userWord:"",tableHeader:[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("common","common_thead_full_name"),Lang.getValByKey("common","common_thead_only_code"),Lang.getValByKey("common","common_thead_department"),Lang.getValByKey("common","common_thead_job"),Lang.getValByKey("common","common_thead_phone")],tableBody:[],restURL:"logistics.userTableUrl",restData:{q:"",locked:-1,pageIndex:1,pageSize:10},selectNumber:0,selectFlag:!1},n(),e.addUser=function(){e.isSave=!0,e.validateUserCodeError=!1,e.validateEmailError=!1,e.defaultSet="null",e.male=!1,e.female=!1,e.main=!e.main,e.positionInfo="",e.editDetail=!1,e.editHide=!1,e.validate=!0,e.validateRequired=!1,e.visible=!0,e.closeEditDetail=!1,e.fullNameInfo="",e.codeInfo="",e.orgNameInfo=$("#tree .dd3-content.active").text(),e.mobilephoneInfo="",e.telephoneInfo="",e.emailInfo="",e.descriptionInfo="",e.avatarPath="/public/img/avatar2.png",e.avatarUpdateFile={},e.avatarId="",e.textNumber=140,e.codeDisabled=!1,$('input[name="orgNameInfo"]').attr("disabled",!0),$('button[name="saveOrEdit"]').removeClass("edit").addClass("save"),e.form.$setPristine(),e.form.$setUntouched()},e.backMainContet=function(){if(e.visible)$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("common","common_back_confirm")},cancelDescription:Lang.getValByKey("common","common_back_no"),operation:[{type:"submit",application:"delete",description:Lang.getValByKey("common","common_back_yes"),operationEvent:function(){e.validate=!1,e.validateRequired=!1,e.isPristine=!1,e.main=!e.main,e.visible=!e.visible;$(".dd3-content.active").parent().data("uid");$('input[name="LockUser"]').removeClass("active").removeAttr("checked"),$("#tree").nestable("resetTreeGroup"),$(document).promptBox("closePrompt"),e.$apply()}}]});else{e.validate=!1,e.validateRequired=!1,e.isPristine=!1,e.main=!e.main,e.visible=!e.visible;$(".dd3-content.active").parent().data("uid");$('input[name="LockUser"]').removeClass("active").removeAttr("checked"),$("#tree").nestable("resetTreeGroup")}},e.moveUserGroup=function(){function t(){1==$("#userSelectGroup").length&&($("#userSelectGroup").remove(),$("#userSelectGroupBox .slimScrollDiv").length>0&&$("#userSelectGroupBox").find(".slimScrollDiv").remove(),$("#userSelectGroupBox").append('<div id="userSelectGroup"></div>')),$("#userSelectGroup").nestable({iconOpen:"icon-organization-Open",iconClose:"icon-organization-Close",iconSeat:"icon-organization",userCount:"",isMove:!0,isOperate:!0,isRoot:!0,childUrl:Interface.getUrlById("logistics.treeChildUrl"),isSearch:!1,treeScrollHeight:$("#userSelectGroupBox.user-prompt-box")})}$(document).promptBox({title:Lang.getValByKey("user","user_prompt_move_tip"),isHidden:!0,isNest:!0,loadData:function(){t()},content:{nest:$("#userSelectGroupBox")},operation:[{type:"submit",description:Lang.getValByKey("common","common_prompt_confirm"),operationEvent:function(){$("input[name=orgNameInfo]").val($("#userSelectGroup .dd3-content.active").data("orgname")),e.orgNameInfo=$("#userSelectGroup .dd3-content.active").data("orgname"),e.orgName=$("#userSelectGroup .dd3-content.active").data("orgname"),e.orgId=$("#userSelectGroup .dd3-content.active").parent().data("uid"),$(document).promptBox("closeFormPrompt"),n()}}]})},e.showCarrerList=function(){selectFactory({url:Interface.getUrlById("logistics.getPositionsData"),maxHeight:340,minHeight:34,offset:4,id:"carrer-input-text",showTextField:"name",attrTextField:{"ng-value":"code"},attrTextId:function(t){e.positionCode=t,e.$apply()},attrTextModel:function(t){e.positionInfo=t,e.$apply()}}).open()},e.getMaleSexInfo=function(){e.male="m",e.female=!1,e.defaultSet=!1,e.sexInfo="m"},e.getFemaleSexInfo=function(){e.male=!1,e.female="f",e.defaultSet=!1,e.sexInfo="f"},e.getDefaultSexInfo=function(){e.male=!1,e.female=!1,e.defaultSet="null",e.sexInfo="null"},e.saveUser=function(o){e.fullNameInfo||e.form.fullNameInfo.$setDirty(),e.codeInfo||e.form.codeInfo.$setDirty(),e.orgNameInfo||e.form.orgNameInfo.$setDirty(),e.positionInfo||e.form.positionInfo.$setDirty(),e.mobilephoneInfo||e.form.mobilephoneInfo.$setDirty(),e.telephoneInfo||e.form.telephoneInfo.$setDirty(),e.emailInfo||e.form.emailInfo.$setDirty(),void 0==e.sexInfo?e.sexInfo=0:"null"==e.sexInfo?e.sexInfo=0:e.sexInfo,1!=e.validateUserCodeError&&1!=e.validateEmailError||(e.form.$valid=!1);var n;if($(o.target).hasClass("save")){n=$("#tree .dd3-content.active").parent().data("uid");var r=$.extend({},{fullName:e.fullNameInfo},{code:e.codeInfo},{sex:e.sexInfo},{orgId:n},{positionCode:e.positionCode},{mobilephone:e.mobilephoneInfo},{telephone:e.telephoneInfo},{email:e.emailInfo},{description:e.descriptionInfo},{avatarId:e.avatarId});e.form.$valid&&function(o){var n={urlParams:o};t.userSave(n,function(o){0==o.errorCode?(t.getUserDetail({seatParams:{userId:o.data}},function(t){if(0==t.errorCode){e.validateUserCodeError=!1,e.validateEmailError=!1;var o=[],n=t.data;n.userId=n.id,n.userCode=n.code,n.positionName=e.positionInfo,o.push(n),$('input[name="LockUser"]').removeClass("active").removeAttr("checked"),e.tableModel.restData.locked=-1;var r={urlParams:e.tableModel.restData,seatParams:{uid:$("#tree .dd3-content.active").parent().data("uid")}};a.getTable(e.tableModel.restURL,r,function(t){if(0===t.errorCode){var n=t.data;for(var i in n)n[i].userId!=o[0].userId&&o.push(n[i]);t.data=o,e.tableModel=a.table(e.tableModel,r,t),e.main=!e.main,e.validate=!1,e.validateRequired=!1,e.visible=!e.visible}}),e.main=!1,$("#tree").nestable("resetTreeGroup")}else $(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})}),$(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})}(r)}else if($(o.target).hasClass("edit")){var i=e.id;n=e.orgId;var l=$.extend({},{fullName:e.fullNameInfo},{code:e.codeInfo},{sex:e.sexInfo},{orgId:n},{positionCode:e.positionCode},{mobilephone:e.mobilephoneInfo},{telephone:e.telephoneInfo},{email:e.emailInfo},{description:e.descriptionInfo},{avatarId:e.avatarId});e.form.$valid&&function(o,a){var n={seatParams:{userId:o},urlParams:a};t.editSave(n,function(o){0==o.errorCode?(t.getUserDetail({seatParams:{userId:o.data}},function(t){0==t.errorCode?(e.validateUserCodeError=!1,e.validateEmailError=!1,s(e.currentUserId,"edit")):$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})}),$(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})}(i,l)}},e.saveAndNewUser=function(){e.fullNameInfo||e.form.fullNameInfo.$setDirty(),e.codeInfo||e.form.codeInfo.$setDirty(),e.orgNameInfo||e.form.orgNameInfo.$setDirty(),e.positionInfo||e.form.positionInfo.$setDirty(),e.mobilephoneInfo||e.form.mobilephoneInfo.$setDirty(),e.telephoneInfo||e.form.telephoneInfo.$setDirty(),e.emailInfo||e.form.emailInfo.$setDirty(),void 0==e.sexInfo?e.sexInfo=0:"null"==e.sexInfo?e.sexInfo=0:e.sexInfo;var o=$.extend({},{fullName:e.fullNameInfo},{code:e.codeInfo},{sex:e.sexInfo},{orgId:e.userOrgId},{positionCode:e.positionCode},{mobilephone:e.mobilephoneInfo},{telephone:e.telephoneInfo},{email:e.emailInfo},{description:e.descriptionInfo},{avatarId:e.avatarId});1!=e.validateUserCodeError&&1!=e.validateEmailError||(e.form.$valid=!1);var a={urlParams:o};e.form.$valid&&t.userSave(a,function(o){0==o.errorCode?(t.getUserDetail({seatParams:{userId:o.data}},function(t){0==t.errorCode&&(e.validateUserCodeError=!1,e.validateEmailError=!1,e.male="m",e.female=!1,e.defaultSet=!1,e.positionInfo="",e.fullNameInfo="",e.codeInfo="",e.mobilephoneInfo="",e.telephoneInfo="",e.emailInfo="",e.descriptionInfo="",e.avatarPath="/public/img/avatar2.png",e.avatarUpdateFile={},e.avatarFile={},e.avatarId="",e.form.$setPristine(),e.form.$setUntouched())}),$(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})},e.getUserDetails=function(t){var o;o="span"==$(t.target).context.localName?$(t.target).parent().parent().parent().data("id"):$(t.target).parent().parent().data("id"),e.currentUserId=o,e.isSave=!1,s(o),e.form.$setPristine(),e.form.$setUntouched()},e.editUser=function(){e.validateUserCodeError=!1,e.validateEmailError=!1,"m"==e.sexInfo?(e.male="m",e.female=!1,e.defaultSet=!1):"f"==e.sexInfo?(e.male=!1,e.female="f",e.defaultSet=!1):"null"==e.sexInfo&&(e.male=!1,e.female=!1,e.defaultSet="null"),e.editDetail=!e.editDetail,e.visible=!e.visible,e.validate=!0,e.validateRequired=!1,e.closeEditDetail=!0,e.fullNameInfo=e.fullName,e.codeInfo=e.code,e.orgNameInfo=e.orgName,e.positionInfo=e.positionName,e.mobilephoneInfo=e.mobilephone,e.telephoneInfo=e.telephone,e.emailInfo=e.email,e.descriptionInfo=e.description,e.textNumber=140-e.descriptionInfo.length,e.codeDisabled=!0,$('button[name="saveOrEdit"]').addClass("edit").removeClass("save"),$('input[name="orgNameInfo"]').attr("disabled",!1)},e.closeEditUser=function(){var o=e.id;t.getUserDetail({seatParams:{userId:o}},function(o){if(0==o.errorCode){var a=o.data;e.editDetail=!0,e.editHide=!0,e.visible=!1,e.validate=!1,e.validateRequired=!1,e.closeEditDetail=!1,e.id=a.id,e.fullName=a.fullName,e.code=a.code,t.getPositionsData(function(t){e.positions=t.data,e.position=!1;for(var o in t.data)a.positionCode==t.data[o].positionCode&&(e.positionName=t.data[o].positionName)});"m"==a.sex?(Lang.getValByKey("user","user_radio_man"),e.sexInfo="m"):"f"==a.sex?(Lang.getValByKey("user","user_radio_woman"),e.sexInfo="f"):0==a.sex&&(Lang.getValByKey("user","user_radio_no"),e.sexInfo="null"),e.avatarPath=a.avatarPath?a.avatarPath:"/public/img/avatar2.png",e.orgName=a.orgName,e.orgId=a.orgId,e.positionCode=a.positionCode,e.mobilephone=a.mobilephone,e.telephone=a.telephone,e.email=a.email,e.description=a.description,$(".sex-radio input").removeAttr("checked"),$('input[value="'+a.sex+'"]').prop("checked",!0)}else $(document).promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})},e.seniorSeach=function(t){if($('input[name="LockUser"]').removeClass("active").attr("checked",!1),$(t.target).hasClass("active")){$(t.target).removeClass("active").text(Lang.getValByKey("common","common_page_advancedFilter")),$(".fade").animate({height:0},500),$(".white-background").animate({top:50},500),setTimeout("$('.fade').hide()",500),l(),$(window).on("resize",l),e.tableModel.restData.locked=-1;var o=$("#tree .dd3-content.active").parent().data("uid"),n={urlParams:e.tableModel.restData,seatParams:{uid:o}};a.getTable(e.tableModel.restURL,n,function(t){0===t.errorCode&&(e.tableModel=a.table(e.tableModel,n,t))}),e.isPageShow=!1}else $(t.target).addClass("active").text(Lang.getValByKey("common","common_page_ordinaryFilter")),$(".fade").show().css("height",0),$(".fade").animate({height:50},500),$(".white-background").animate({top:80},500),i(),$(window).on("resize",i),e.isPageShow=!0},e.showMore=function(){e.tableModel.more=!0},e.hideMore=function(){e.tableModel.more=!1},e.retrievalUser=function(t){e.isSeach=!0,e.q="clickNode"==t?"":e.tableModel.restData.q,e.tableModel.restData.pageIndex=1;var o=$(".dd3-content.active").parent().data("uid");$('input[name="LockUser"]').hasClass("active")?e.tableModel.restData.locked=1:e.tableModel.restData.locked=-1;var n={urlParams:e.tableModel.restData,seatParams:{uid:o}};a.getTable(e.tableModel.restURL,n,function(t){0===t.errorCode&&(console.log(t.data.length),0==t.data.length?e.undefinedShow=!0:e.undefinedShow=!1,e.tableModel=a.table(e.tableModel,n,t))})},e.deleteUser=function(){if(0!=e.tableModel.selectNumber&&0!=$(".user-table tbody tr").length){var t=[],o=$('.user-table tbody input[checked="checked"]');o.each(function(e){t.push(o.eq(e).val())}),$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("user","user_prompt_delete_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){d(t)}}]})}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_prompt_delay_tip"),type:"errer",manualClose:!0})},e.moveGroup=function(){function t(){1==$("#moveUser").length&&($("#moveUser").remove(),$("#moveUserBox .slimScrollDiv").length>0&&$("#moveUserBox").find(".slimScrollDiv").remove(),$("#moveUserBox").append('<div id="moveUser"></div>')),$("#moveUser").nestable({iconOpen:"icon-organization-Open",iconClose:"icon-organization-Close",iconSeat:"icon-organization",userCount:"",isMove:!0,isOperate:!0,isRoot:!0,childUrl:Interface.getUrlById("logistics.treeChildUrl"),isSearch:!1,treeScrollHeight:$("#moveUserBox.user-prompt-box")})}0!=e.tableModel.selectNumber?$(document).promptBox({isHidden:!0,title:Lang.getValByKey("user","user_prompt_move_tip"),isNest:!0,loadData:function(){t()},content:{nest:$("#moveUserBox")},operation:[{type:"submit",description:Lang.getValByKey("common","common_prompt_confirm"),operationEvent:function(){m()}}]}):$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_prompt_delay_tip"),type:"errer",manualClose:!0})},e.resetPassword=function(){function o(){var o={urlParams:a};t.modifyPassword(o,function(t){if(0===t.errorCode){var o=$("#tree .dd3-content.active").parent().data("uid");$(document).promptBox("closePrompt"),r(o),1==e.isPageShow?i():l(),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})}else $(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})}var a=[],n=[],s=$('.user-table tbody input[checked="checked"]'),d=$(".user-table tbody tr");s.each(function(e){a.push(s.eq(e).val()),n.push(d.eq(e).find("td").eq(2).attr("title"))}),0!=e.tableModel.selectNumber?$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("user","user_prompt_reset_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_pagination_confirm"),operationEvent:function(){o()}}]}):$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_prompt_delay_tip"),type:"errer",manualClose:!0})},e.lockUser=function(){function o(){var o=[],a=$('.user-table tbody input[checked="checked"]');a.each(function(e){o.push(a.eq(e).val())});var n={urlParams:o};t.lockUser(n,function(t){if(0===t.errorCode){r($("#tree .dd3-content.active").parent().data("uid")),1==e.isPageShow?i():l(),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"}),$(document).promptBox("closePrompt")}else $(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})}0!=e.tableModel.selectNumber?$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("user","user_prompt_lock_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_pagination_confirm"),operationEvent:function(){o()}}]}):$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_prompt_delay_tip"),type:"errer",manualClose:!0})},e.unlockUser=function(){function o(){var o=[],a=$('.user-table tbody input[checked="checked"]');a.each(function(e){o.push(a.eq(e).val())});var n={urlParams:o};t.unlockUser(n,function(t){if(0===t.errorCode){r($("#tree .dd3-content.active").parent().data("uid")),1==e.isPageShow?i():l(),$(document).promptBox("closePrompt"),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})}else $(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})}0!=e.tableModel.selectNumber?$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("user","user_prompt_unlock_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_pagination_confirm"),operationEvent:function(){o()}}]}):$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_prompt_delay_tip"),type:"errer",manualClose:!0})},e.getLockUser=function(t){$(t.target).hasClass("active")?($(t.target).removeClass("active"),e.tableModel.restData.locked=-1):($(t.target).addClass("active"),e.tableModel.restData.locked=1);var o=$("#tree .dd3-content.active").parent().data("uid"),n={urlParams:e.tableModel.restData,seatParams:{uid:o}};a.getTable(e.tableModel.restURL,n,function(t){0===t.errorCode&&(e.tableModel=a.table(e.tableModel,n,t))})},e.getFile=function(){var o=t.uploadFileToUrl(e.avatarFile);if(!o)return!1;o.errorlocal?$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("user",o.errorlocal),type:"errer",manualClose:!0}):o.then(function(t){0===t.data.errorCode?(e.avatarPath=t.data.data.path,e.avatarId=t.data.data.id,$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("user","user_prompt_upload_tip"),type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:t.data.msg,type:"errer",manualClose:!0})}),e.$apply()},e.updateFile=function(){var o=t.uploadFileToUrl(e.avatarUpdateFile);if(!o)return!1;o.errorlocal?$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("user",o.errorlocal),type:"errer",manualClose:!0}):o.then(function(t){0===t.data.errorCode?(e.avatarPath=t.data.data.path,e.avatarId=t.data.data.id,$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("user","user_prompt_upload_tip"),type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:t.data.msg,type:"errer",manualClose:!0})}),e.$apply()},e.focusUserCode=function(){e.validateUserCodeError=!1},e.validateUserCode=function(){var o=e.codeInfo;if(o){var a={urlParams:{code:o}};t.validateUserCode(a,function(t){0!=t.errorCode?e.validateUserCodeError=!0:e.validateUserCodeError=!1})}},e.focusUserEmail=function(){e.validateEmailError=!1},e.validateUserEmail=function(){var o=e.emailInfo;if(o){var a;a=e.isSave?"":e.currentUserId;var n={urlParams:{email:o,userId:a}};t.validateUserEmail(n,function(t){0!=t.errorCode?e.validateEmailError=!0:e.validateEmailError=!1})}},e.textNumber=140,e.showTextNumber=function(){e.textNumber=140-e.descriptionInfo.length},e.visibleTextNumber=function(){e.textCountVisible=!0},e.hiddenTextNumber=function(){e.textCountVisible=!1}}])});