app.factory("contractsView",["tableService","contractsService",function(e,t){return{setScroll:function(){$(".table-container tbody").slimScroll({height:$(".content-main").height()-380})},initStateSelect:function(e){selectFactory({data:{data:[{code:"0",name:"全部"},{code:"1",name:"草稿"},{code:"2",name:"已生成"}]},id:"contractStatus",defaultText:null,attrTextModel:function(t,a,o){t?(e.contractStatus=o.name,e.contractStatusCode=o.code):e.contractStatus=null,e.$apply()}});var a=t.getContractType();a.data.splice(0,0,{code:0,message:"全部"}),selectFactory({data:a,showTextField:"message",id:"serviceType",defaultText:null,attrTextModel:function(t,a,o){t?(e.serviceType=o.message,e.serviceTypeCode=o.code):(e.serviceTypeCode=0,e.serviceType="全部"),e.$apply()}}),selectFactory({data:{data:[{code:"1",message:"物流"},{code:"2",message:"贸易"}]},showTextField:"message",id:"upLoadContractSerType",defaultText:null,attrTextModel:function(t,a,o){t?(e.upLoadContractSerType=o.message,e.upLoadContractSerTypeCode=o.code):(e.upLoadContractSerType=null,e.upLoadContractSerTypeCode=""),e.$apply()}})},initCalander:function(){Calander.init({ele:["#begin-time","#finish-time"]})},initTable:function(e){e.tableModel={tableHeader:[Lang.getValByKey("common","common_thead_number"),"业务类型","模板名称","合同标题","创建人","创建时间","合同状态","操作"],tableHeaderSize:["15%","10%","10%","10%","10%","20%","10%","10%"],tableBody:[],restURL:"logistics.getContracsList",restData:{sort:"createTime",q:"",pageIndex:1,pageSize:10,asc:!1},selectNumber:0,selectFlag:!1},e.loadData()},bindEvent:function(a){a.clearData=function(){a.serviceType="全部",a.serviceTypeCode=void 0,a.templateName=void 0,a.creater=void 0,a.templateTitle=void 0,a.contractStatusCode=0,a.contractStatus="全部",$("#begin-time").val(""),$("#finish-time").val(""),a.search()},a.search=function(){a.tableModel.restData.startTime=$("#begin-time").val(),a.tableModel.restData.endTime=$("#finish-time").val(),a.tableModel.restData.serviceType=a.serviceTypeCode,a.tableModel.restData.templateName=a.templateName,a.tableModel.restData.createUserName=a.creater,a.tableModel.restData.status=a.contractStatusCode,a.tableModel.restData.title=a.templateTitle,a.loadData()},a.createContract=function(){top.location.href="http://"+location.host+"#/contractDetail"},a.deleteContract=function(){if(0!=a.tableModel.selectNumber&&0!=$(".table-box tbody tr").length){var o=[],n=e.getSelectTable(a.tableModel.tableBody);if(!n.length)return accountView.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_code_noSelected"),type:"errer",manualClose:!0}),!1;angular.forEach(n,function(e){o.push(e.id)}),$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:"是否确认删除该合同？"},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){t.delContracts(o,function(e){0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),$(document).promptBox("closePrompt"),a.loadData()):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})}}]})}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_code_noSelected"),type:"errer",manualClose:!0})}}}}]);