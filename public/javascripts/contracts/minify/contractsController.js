easySpa.require(["widget/slimscroll","widget/select","widget/prompt","widget/slides","public/common/tableController.js","public/common/calander.js","public/common/pictureController.js"],function(){app.controller("contractsCtrl",["$scope","contractsService","contractsView","tableService","pictureService",function(e,t,a,o,r){function i(e){if(-1!=e.indexOf("150x150")){var t=e.lastIndexOf("."),a=e.substring(0,t),o=e.substring(t,e.length),r=a.lastIndexOf("_");e=e.substring(0,r)+o}return e}function n(){if(e.upLoadContractSerType||e.UploadContacter.upLoadContractSerType.$setDirty(),e.upLoadContractTitle||e.UploadContacter.upLoadContractTitle.$setDirty(),!e.upLoadData.name)return e.UploadContacter.upLoadContractFiles.$setDirty(),!1;for(var t=$(".errors"),a=0;a<t.length;a++)if(!$(t[a]).hasClass("ng-hide"))return!1;return!!e.UploadContacter.$valid}$.extend(e,{initSelect:function(){a.initStateSelect(e)},initCalander:function(){a.initCalander()},setScroll:function(){a.setScroll()},initTable:function(){a.initTable(e)},loadData:function(){var t=this,a={urlParams:e.tableModel.restData};o.getTable(e.tableModel.restURL,a,function(r){0===r.errorCode&&(angular.forEach(r.data,function(t){t.enableCheckbox=t.createUserId.toString()===e.userId}),e.tableModel=o.table(e.tableModel,a,r),setTimeout(function(){t.setScroll(),$(window).on("resize",t.setScroll),e.$apply(),$(".table-box").focus()},100))})},bindEvent:function(){a.bindEvent(e)}}),e.$watch("tableModel.tableBody",function(e,t,a){for(var o=0;o<e.length;o++)e[o].thumbnailPath=i(e[o].fileUrl)+"?filename="+e[o].fileName}),e.download=function(e){console.log(e),console.log(e.target.getAttribute("data-href"));var t=e.target.getAttribute("data-href");window.location.href=t},function(){e.userId=cookie.get("userId"),e.serviceType="全部",e.serviceTypeCode=void 0,e.contractStatus="全部",e.contractStatusCode=0,e.userId=cookie.get("userId"),e.upLoadData={}}(),e.upLoadContracts=function(){e.upLoadData.name="",e.showPrompt=!0,e.upLoadContractSerType="",e.upLoadContractSerTypeCode="",e.upLoadContractTitle="",e.UploadContacter.upLoadContractSerType.$setPristine(),e.UploadContacter.upLoadContractTitle.$setPristine(),e.UploadContacter.upLoadContractFiles.$setPristine()},e.closePrompt=function(){e.showPrompt=!1},e.savePrompt=function(){if(n()){var a={serviceType:e.upLoadContractSerTypeCode,serviceTypeName:e.upLoadContractSerType,title:e.upLoadContractTitle,fileId:e.upLoadData.id,status:2};t.uploadContract(a,function(t){0!=t.errorCode?$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0}):(e.showPrompt=!1,e.loadData(),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success",time:3e3}))})}},e.pictureModel={edit:!0,uploadShow:!0,picture:[],accept:"image/jpg,image/jpeg,image/png,image/bmp,image/tiff,application/pdf"},e.getFile=function(t){var a=(e[t.target.id].size,r.uploadFile(e.pictureModel,e[t.target.id]));if(!a)return!1;a.errorlocal?$(document).promptBox({isDelay:!0,contentDelay:a.errorlocal,type:"errer",manualClose:!0}):a.then(function(t){e.upLoadData=t.data.data,0===t.data.errorCode?($(document).promptBox({isDelay:!0,contentDelay:t.data.msg,type:"success"}),e.pictureModel=r.updateModel(e.pictureModel,t.data.data),e.fileUrl=t.data.data.path,e.$apply()):$(document).promptBox({isDelay:!0,contentDelay:t.data.msg,type:"errer",manualClose:!0})})},e.getPictureUrl=function(t){var a,o;e.pictureModel.picture=[],-1!=t.fileType.indexOf("image")?(a=!0,o=!1):-1!=t.fileType.indexOf("application")&&(a=!1,o=!0);var r={picUrlID:{id:t.fileId,name:t.fileName,path:t.fileUrl,type:t.fileType},picUrl:t.fileUrl,name:t.fileName,typeImage:a,typePdf:o,suffix:t.fileType.split("/")[1]};e.pictureModel.picture.push(r),$("#slides").picturePreview({pictureId:t.fileId},e.pictureModel.picture)},e.test=function(e){top.location.href="http://"+location.host+"/#/contractDetail?id="+e},e.initTable(),e.initSelect(),e.initCalander(),e.bindEvent()}])});