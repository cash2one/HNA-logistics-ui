function sdetail(e,o,r){function t(){var o=Object.keys(c),r=o.indexOf(e.data.orderStatus);e.statusList.forEach(function(e){o.indexOf(e.code)<=r?e.svg=c[e.code]+"-s":e.svg=c[e.code]}),e.status=e.data.orderStatus}function a(e){if(void 0===$.fn.media){var o=document.createElement("script");o.src="public/lib/jquery.media.js",o.onload=function(o){i(e)},document.body.append(o)}else i(e)}function i(t){$("a.media").remove();var a=document.createElement("a");a.className="media","OUT"===t?t=1:"IN"===t&&(t=2),o.exportPDF(e.orderNo,t).then(function(e){0==e.errorCode&&e.data?(a.href=m+e.data,document.body.append(a),$("a.media").media({width:800,height:600}),$(".closePDF").show().click(function(){$("div.media").remove(),$(".closePDF").hide(),$(this).remove()})):r.promptBox({msg:"尚未生成订单确认单!"})})}function d(){if(!e.data.orderConfirmUrl)return void r.promptBox({msg:"尚未生成订单确认单!"});var o=[location.protocol,"//",location.hostname,"/",location.port].join("");$("a.media").remove();var t=document.createElement("a");t.className="media",t.href=o+e.data.orderConfirmUrl,document.body.append(t),$("a.media").media({width:800,height:600}),$(".closePDF").show().click(function(){$("div.media").remove(),$(".closePDF").hide(),$(this).remove()})}function n(){if(!e.data.orderDeliverUrl)return void r.promptBox({msg:"尚未生成发货确认单!"});var o=[location.protocol,"//",location.hostname,"/",location.port].join("");$("a.media").remove();var t=document.createElement("a");t.className="media",t.href=o+e.data.orderDeliverUrl,document.body.append(t),$("a.media").media({width:800,height:600}),$(".closePDF").show().click(function(){$("div.media").remove(),$(".closePDF").hide(),$(this).remove()})}e.data={},e.button1Txt="查看订单确认单",e.button2Txt="查看收货确认单","SALE"===e.orderType?customerType=1:customerType=2,e.orderNo&&(o.getOrderStatusByOrderNo(e.orderNo,customerType).then(function(o){0==o.errorCode&&(e.data=o.data,e.statusList&&t())}),o.getOrderStatus().then(function(o){e.statusList=o,e.data.id&&t()}));var c={DRAFT:"icon-draft",CONFIRMING:"icon-examine",DELIVERY:"icon-solicitation",TRANSPORT:"icon-transport",SIGNED:"icon-receive"};e.loadSource=function(o){var r=e.status;"DRAFT"!==r&&("OUT"===o?"DELIVERY"===r?e.getDetail("simulate",e.orderNo):"TRANSPORT"!==r&&"SIGNED"!==r||a(o):"IN"===o&&("TRANSPORT"===r?e.getDetail("simulate",e.orderNo):"SIGNED"===r&&a(o)))},e.loadPDFJS=a;var m=[location.protocol,"//",location.hostname,":",location.port].join("");e.previewConfirmOrder=function(){if(void 0===$.fn.media){var e=document.createElement("script");e.src="public/lib/jquery.media.js",e.onload=function(e){d()},document.body.append(e)}else d()},e.previewDeliveryOrder=function(){if(void 0===$.fn.media){var e=document.createElement("script");e.src="public/lib/jquery.media.js",e.onload=function(e){n()},document.body.append(e)}else n()},e.checkConfirmOrderUrl=function(){e.data.orderConfirmUrl?$("#confirmOrder").attr("href",e.data.orderConfirmUrl):r.promptBox({msg:"尚未生成订单确认单!"})},e.checkDeliveryOrderUrl=function(){e.data.orderDeliverUrl?$("#deliveryOrder").attr("href",e.data.orderDeliverUrl):r.promptBox({msg:"尚未生成发货确认单!"})}}app.controller("sdetail",["$scope","tradeOrdersService","tradeOrdersView",sdetail]);