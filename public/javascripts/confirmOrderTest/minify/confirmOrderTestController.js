easySpa.require(["widget/select","widget/prompt"],function(){app.controller("confirmOrderTestCtrl",["$scope","confirmOrderTestService","confirmOrderTestView",function(e,r,o){function t(r,o){o(r,function(r){0!=r.errorCode?(console.log("error"),$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})):(e.InitSelectByorderNo(),$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"success",time:3e3}))})}function a(){var o=r.getCodeFormProvider();propertyElm=selectFactory({data:o,id:"code-Form-Provider",isSearch:!0,showTextField:"code",defaultText:Lang.getValByKey("common","common_select_tips"),attrTextModel:function(r,o,t){console.log(t),e.order.code=r||"",console.log(e.order.code),e.$apply()}})}function c(){var r={data:[{name:"该供应商对该子单的工作环节已经完成",status:1},{name:"该供应商对该子单的工作环节尚未完成",status:2}],errorCode:0,msg:""};selectFactory({data:r,id:"orderStatus",defaultText:Lang.getValByKey("common","common_select_tips"),attrTextModel:function(r,o,t){console.log(t),r?(e.order.statusName=r,e.order.status=t.status):(e.order.statusName="",e.order.status=""),console.log(e.order.status),e.$apply()}})}e.backToOrderPage=function(){$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("common","common_back_confirm")},cancelDescription:Lang.getValByKey("common","common_back_no"),operation:[{type:"submit",application:"delete",description:Lang.getValByKey("common","common_back_yes"),operationEvent:function(){$(document).promptBox("closePrompt"),window.location.href="#/orders"}}]})},e.orderAccept=function(){var o={seatParams:{orderNo:e.order.orderNo}};console.log(e.order.orderNo),t(o,r.SetOrderToAccept)},e.orderStateChangeSummit=function(){t({urlParams:{orderNo:e.order.orderNo,orderStatus:"COMMITED"}},r.ModifyOrderStatus)},e.InitSelectByorderNo=function(){e.InitServiceUidSelect()},e.InitSubOrderSelect=function(){var o={seatParams:{orderNo:e.order.orderNo}},t=r.getSubOrderByOrderSerial(o);selectFactory({data:t,id:"suborderNo",isSearch:!0,showTextField:"subOrderNo",defaultCount:100,defaultText:Lang.getValByKey("common","common_select_tips"),attrTextModel:function(r,o,t){e.order.suborderNo=r||"",console.log(e.order.suborderNo),e.$apply()}})},e.InitServiceUidSelect=function(){console.log("InitServiceUidSelect");var o={seatParams:{orderNo:e.order.orderNo}},t=r.getProviderByOrderSerial(o);e.suborderNo=r.getSubOrderByOrderSerial(o),selectFactory({data:t,id:"serviceUid",isSearch:!0,showTextField:"name",defaultText:Lang.getValByKey("common","common_select_tips"),attrTextModel:function(r,o,t){r?(e.order.servicename=r,e.order.serviceUid=t.serviceUid,e.order.supplierId=t.supplierId):(e.order.serviceUid="",e.order.supplierId="",e.order.servicename=""),console.log(e.order.serviceUid),console.log(e.order.supplierId),e.$apply()}})},e.summit=function(){var o,t=[];e.suborderNo.data.forEach(function(r,a){o={subOrderNo:r.subOrderNo,cargoNumber:e.subOrder.cargoNumber,length:e.subOrder.length,width:e.subOrder.width,height:e.subOrder.height,lwhUnit:e.subOrder.lwhUnit,weight:e.subOrder.weight,weightUnit:e.subOrder.weightUnit},t.push(o)});var a={urlParams:{code:e.order.code,type:2,status:e.order.status,waybillNo:e.order.orderNo,orderWeight:e.order.orderWeight,orderWeightUnit:e.order.orderWeightUnit,serviceUid:e.order.serviceUid,supplierId:e.order.supplierId,serviceOrderNo:e.order.serviceorderNo,trackMessage:e.order.trackMessage,messageTime:(new Date).getTime(),trackingSupSubOrders:t}};r.addOrder(a,function(e){0!=e.errorCode?$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0}):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3})})},e.calcOrderSales=function(){var o={seatParams:{orderNo:e.cash.orderNo}};r.calcOrderSales(o,function(r){e.cash.money=r.data.amount,e.cash.currencyCode=r.data.currencyCode,e.cash.custCurrencyCode=r.data.custCurrencyCode,e.cash.custcurrencyAmount=r.data.custCurrencyAmount,e.cash.exchangeRateSetting=r.data.exchangeRateSetting,e.cash.exchangeRate=r.data.exchangeRate,e.result=r.data.result,e.calcMsgs=r.data.calcMsgs,0!=r.errorCode?(console.log("error"),$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})):$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"success",time:3e3})})},e.calcOrderPurchases=function(){var o={seatParams:{orderNo:e.cash.orderNo}};r.calcOrderPurchases(o,function(r){e.cash.money=r.data.amount,e.cash.currencyCode="CNY",e.cash.custCurrencyCode=r.data.custCurrencyCode,e.cash.custcurrencyAmount="-",e.cash.exchangeRateSetting=!0,e.cash.exchangeRate="-",e.result=r.data.result,e.calcMsgs=r.data.calcMsgs,0!=r.errorCode?(console.log("error"),$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})):$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"success",time:3e3})})},e.calcPurchases=function(){var o={seatParams:{orderNo:e.cash.orderNo}};r.calcOrderPurchases(o,function(r){0!=r.errorCode?(console.log("error"),$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})):(e.cash.money=r.data.amount,$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"success",time:3e3}))})},e.calcOrderProcess=function(){var o={seatParams:{orderNo:e.cash.orderNo}};r.calcOrderProcess(o,function(r){var o="\r\n揽收服务:"+r.data.st001Uid+"-"+r.data.st001Name+"\r\n";o+="仓储服务:"+r.data.st002Uid+"-"+r.data.st002Name+"\r\n",o+="清关服务:"+r.data.st003Uid+"-"+r.data.st003Name+"\r\n",o+="干线服务:"+r.data.st004Uid+"-"+r.data.st004Name+"\r\n",o+="配送服务:"+r.data.st005Uid+"-"+r.data.st005Name+"\r\n",o+="综合服务:"+r.data.st006Uid+"-"+r.data.st006Name+"\r\n",e.result=o,e.calcMsgs=r.data.msgs,0!=r.errorCode?(console.log("error"),$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"errer",manualClose:!0})):$(document).promptBox({isDelay:!0,contentDelay:r.msg,type:"success",time:3e3})})},function(){e.order={},e.subOrder={},e.cash={},a(),c()}()}])});