easySpa.require(["widget/slimscroll","public/common/tableController.js","widget/prompt"],function(){app.controller("countryCtrl",["$scope","countryService","countryView","tableService",function(e,t,o,r){function a(e){t.delCountry(e,function(e){0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),$(document).promptBox("closePrompt"),i()):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})}function n(){$(".table-container tbody").slimScroll({height:$(".content-main").height()-250})}function i(){var t={urlParams:e.tableModel.restData};r.getTable(e.tableModel.restURL,t,function(o){e.q=e.tableModel.restData.q,0===o.errorCode&&(e.tableModel=r.table(e.tableModel,t,o),setTimeout(function(){n(),$(window).on("resize",n),e.$apply(),$(".table-box").focus()},100))})}e.searchCountry=function(){e.tableModel.restData.pageIndex=1,i()},e.promptTitle=Lang.getValByKey("country","country_create_title"),e.isCreateNewCountry=!0,e.delete=function(){if(0!=e.tableModel.selectNumber&&0!=$(".table-box tbody tr").length){var t=[],o=r.getSelectTable(e.tableModel.tableBody);if(!o.length)return accountView.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("country","country_prompt_delay_tip"),type:"errer",manualClose:!0}),!1;angular.forEach(o,function(e){t.push(e.id)}),$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("country","country_prompt_delete_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){a(t)}}]})}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("country","country_prompt_delay_tip"),type:"errer",manualClose:!0})},e.international=function(){window.location.href="#/international?q=country"},e.checkCountry=function(){},e.checkFigureCode=function(){e.fingerCode&&(e.fingerCode=e.fingerCode.toLocaleUpperCase(),2!=$.trim(e.fingerCode).length?(e.countryFrom.fingerCode.$setDirty(),e.countryFrom.fingerCode.errorTips=Lang.getValByKey("country","country_input_two_code_limit"),$("#figure-code-msg").removeClass("ng-hide")):e.fingerCode&&e.fingerCode!=e.id?t.checkFigureCode({figureCode:e.fingerCode},function(t){0!=t.errorCode?(e.countryFrom.fingerCode.$setDirty(),e.countryFrom.fingerCode.errorTips=t.msg,$("#figure-code-msg").removeClass("ng-hide"),angular.element($(".check-figure-code").addClass("ng-invalid"))):($("#figure-code-msg").addClass("ng-hide"),e.countryFrom.fingerCode.errorTips="")}):e.fingerCode==e.id&&($("#figure-code-msg").addClass("ng-hide"),e.countryFrom.fingerCode.errorTips=""))},e.checkTriadCode=function(){e.triadCode&&(e.triadCode=e.triadCode.toLocaleUpperCase(),3!=$.trim(e.triadCode).length?(e.countryFrom.triadCode.$setDirty(),e.countryFrom.triadCode.errorTips=Lang.getValByKey("country","country_input_three_code_limit"),$("#triad-code-msg").removeClass("ng-hide")):($("#triad-code-msg").addClass("ng-hide"),e.countryFrom.triadCode.errorTips=""))},e.checkArea=function(){},e.editCountry=function(o){$("#nest-countryFrom").css("display","table"),e.isCreateNewCountry=!1,e.promptTitle=Lang.getValByKey("country","country_detail_title"),e.nestCountryFrom=!0,e.countryName=o.name,e.fingerCode=o.figureCode,e.triadCode=o.triadCode,e.areaCode=o.areaCode,e.id=o.figureCode,e.AreaId=o.id,e.oldCountryName=o.name,e.oldTriadCode=o.triadCode,e.oldAreaCode=o.areaCode;var r=t.getSingleDataById(o.id);if(r.data&&r.data.i18n){var a=r.data.i18n;if(a.length>0)for(var n=0;n<a.length;n++)for(var i=a[n].language,l=0;l<e.langList.length;l++){var c=e.langList[l].code;if(i==c){e.langList[l].val=$.trim(a[n].localName),e.langList[l].refId=a[n].refId;break}}else for(var n=0;n<e.langList.length;n++)e.langList[n].val="",e.langList[n].refId=""}$(".input-text").removeClass("ng-dirty"),$(".errors").addClass("ng-hide"),loadBar(d),$('button[name="prompt-save"]').addClass("save").removeClass("edit")};var d=$("#nest-countryFrom .label-text");!function(){barClick(d)}(),e.add=function(){$("#nest-countryFrom").css("display","table"),e.isCreateNewCountry=!0,e.nestCountryFrom=!0,$("input[name=fingerCode]").removeAttr("disabled"),e.promptTitle=Lang.getValByKey("country","country_create_title"),e.countryName="",e.fingerCode="",e.triadCode="",e.areaCode="",e.id="",e.oldCountryName="",e.oldTriadCode="",e.oldAreaCode="",$(".input-text").removeClass("ng-dirty"),loadBar(d),$('button[name="prompt-save"]').addClass("save").removeClass("edit");for(var t=0;t<e.langList.length;t++)e.langList[t].val="",e.langList[t].refId=""},e.closePrompt=function(){e.nestCountryFrom=!1},e.savePrompt=function(){if(showErrorModel(d),e.checkFigureCode(),e.checkTriadCode(),e.countryName||e.countryFrom.countryName.$setDirty(),e.fingerCode||e.countryFrom.fingerCode.$setDirty(),e.triadCode||e.countryFrom.triadCode.$setDirty(),e.areaCode||e.countryFrom.areaCode.$setDirty(),e.countryFrom.$valid){for(var o=$(".errors"),r=0;r<o.length;r++)if(!$(o[r]).hasClass("ng-hide"))return;for(var a=[],r=0;r<e.langList.length;r++)$.trim(e.langList[r].val)||(e.langList[r].val=""),a.push({language:e.langList[r].code,localName:e.langList[r].val,refId:e.langList[r].refId});e.isCreateNewCountry?t.createCountry({name:e.countryName,figureCode:e.fingerCode,triadCode:e.triadCode,areaCode:e.areaCode,i18n:a},function(t){0!=t.errorCode?$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0}):(e.closePrompt(),$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("country","country_create_country_tips"),type:"success",time:3e3}),i())}):t.updateArea({urlParams:{name:e.countryName,figureCode:e.fingerCode,triadCode:e.triadCode,areaCode:e.areaCode,i18n:a},seatParams:{id:e.AreaId}},function(t){0!=t.errorCode?$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0}):(e.closePrompt(),$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("country","country_update_country_tips"),type:"success",time:3e3}),i())})}},function(){e.langList=t.getInternational().data}(),function(){e.tableModel={tableHeader:[Lang.getValByKey("country","country_id"),Lang.getValByKey("country","country_name"),Lang.getValByKey("country","country_tow_code"),Lang.getValByKey("country","country_three_code"),Lang.getValByKey("country","country_area_code")],tableHeaderSize:["5%","25%","21%","21%","23%"],tableBody:[],restURL:"logistics.countryList",restData:{q:"",pageIndex:1,pageSize:10,sort:"figureCode"},selectNumber:0,selectFlag:!1},i()}()}])});