easySpa.require(["widget/slimscroll","widget/prompt","public/common/tableController.js"],function(){app.controller("balanceManagementCtrl",["$scope","$route","balanceManagementService","balanceManagementView","tableService",function(a,e,n,t,o){function r(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-250})}a.isManageBalance=!1,a.confirmPrompt=!1,a.userType=1,a.visible=!0,a.transactionBalance="",a.paymentPassword="",a.tableModel={tableBody:[],restURL:"logistics.getLogisticAccountInfo",restData:{q:"",isAsc:!1,pageIndex:1,pageSize:10,userType:a.userType}},$(window).on("resize",r),a.loadListData=function(){var e={urlParams:a.tableModel.restData};o.getTable(a.tableModel.restURL,e,function(n){0===n.errorCode&&(a.tableModel=o.table(a.tableModel,e,n),setTimeout(function(){r(),a.$apply()},500))})},a.loadListData(),a.manageBalance=function(e){e.totalBalance=e.totalBalance?parseFloat(e.totalBalance).toFixed(2):"0.00",n.isNeedPassword(function(t){0!==t.errorCode||t.data?$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("balanceManagement","balance_set_password"),type:"errer",manualClose:!0}):(a.isManageBalance=!0,a.manageBalanceData=e,n.isLogisticAccountLocked(function(e){0!==e.errorCode&&(a.ErrorPayPwd=!0,angular.element($("#ErrorPayPwd")).html(e.msg),angular.element($("#transactionBalance, #paymentPassword, #confirmBalance")).attr("disabled","disabled"))}))})},a.calTransction=function(){if(a.balanceOperation){var e=1*a.manageBalanceData.totalBalance+1*a.transactionBalance;a.totalBalance=e.toFixed(2)}},a.ErrorPayPwd=!1,a.confirmBalance=function(){a.transactionBalance||a.balanceOperation.transactionBalance.$setDirty(),a.paymentPassword||a.balanceOperation.paymentPassword.$setDirty(),a.balanceOperation.$valid&&n.verifyPayPwd({urlParams:{oldPassword:a.paymentPassword}},function(e){0===e.errorCode?(a.transactionBalance=parseFloat(a.transactionBalance).toFixed(2),a.confirmPrompt=!0):(a.ErrorPayPwd=!0,angular.element($("#ErrorPayPwd")).html(e.msg),127319!==e.errorCode&&angular.element($("#transactionBalance, #paymentPassword, #confirmBalance")).attr("disabled","disabled"))})},a.saveBalance=function(){var e={urlParams:{id:a.manageBalanceData.id,password:a.paymentPassword,thirdId:a.manageBalanceData.thirdId,thirdType:a.manageBalanceData.thirdType,totalBalance:1*a.totalBalance,transactionBalance:1*a.transactionBalance,transactionType:0}};n.logisticAccountRecharge(e,function(e){a.confirmPrompt=!1,0===e.errorCode?a.rechargeSuccess=!0:(a.rechargeFailed=!0,a.failedMsg=e.msg)})},a.cancelBalance=function(){a.confirmPrompt=!1},a.goBack=function(){window.location.reload()},a.gotIt=function(){window.location.reload()},a.balanceSearch=function(){a.q=a.tableModel.restData.q,a.tableModel.restData.pageIndex=1,a.loadListData()}}])});