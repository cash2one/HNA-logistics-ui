easySpa.require(["public/javascripts/price/20161224/priceRoute.js","widget/slimscroll","public/common/tableController.js","widget/prompt","widget/select","widget/searchBox","widget/calander"],function(){app.controller("priceCtrl",["$scope","priceService","service","priceView","tableService",function(e,t,a,i,n){function o(e){return e.forEach(function(e){e.name+="("+e.code+")"}),e}e.viewButton={copyPrompt:!1,isTabList:!0,isVerifyOk:!1,isNoPassDraft:!1,isAdd:!0,isDelete:!0,isCopy:!0,isSubmitVerify:!0,isShowVerifyList:!0,isShowUseState:!1,isShowStartUse:!1,isShowStopUse:!1,isShowStatusTableCell:!0,isBelongToProduct:!1,isBelongToService:!0,isShowPriceType:!1,isShowStartState:Lang.getValByKey("price","price_status"),isShowCheckBox:!0,isShowOperAreaLine:!0,isShowWeightAndArea:!1},e.priceLevelList=["level1","level2","level3","level4","level5"],e.setScroll=function(){$(".table-container tbody").slimScroll({height:$(".content-main").height()-250})},e.closePrompt=function(){e.nestCostPriceFrom=!1},e.getTabType=function(){var e=-1,t=$(".tab-active");return"none"!=$(".tab-list").css("display")&&t.length>0&&(e=t.attr("data-type")),e},e.showCheckStream=function(t,a){var i=easySpa.queryUrlValByKey("module"),n=e.getTabType();self.location.href="#/checkStream?uid="+t+"&from="+i+"&name="+a+"&type="+n},e.showConfirmWindow=function(t,a){0!=e.tableModel.selectNumber&&0!=$(".table-box tbody tr").length?(a||(a=Lang.getValByKey("common","common_pagination_confirm")),$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"success",content:{tip:a},operation:[{type:"submit",description:Lang.getValByKey("common","common_pagination_confirm"),application:"confirm",operationEvent:function(){$(document).promptBox("closePrompt"),t()}}]})):$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0})},e.getProduct=function(){e.contentList=t.getProductAllData({urlParams:{isHot:!0}}),e.navItem=t.getProductNavItem();new SearchBox.init({inputId:"belong-product",searchData:[],defaultText:"请选择",tip:"请输入名称或编码",navItem:e.navItem.data,tabIndex:"热门",contentList:o(e.contentList.data),toggleTab:function(e,a){this.tabIndex=a;var i={urlParams:{isHot:!1,pageIndex:e||1,pageSize:10,capital:a}};"热门"==a&&(i.urlParams.isHot=!0,i.urlParams.capital=""),"其他"==a&&(i.urlParams.isHot=!1,i.urlParams.capital="_");var n=t.getProductAllData(i);return{data:o(n.data),pagination:n.pagination}},onSearchValueChange:function(e,a){var i={urlParams:{q:e,isHot:!1,pageIndex:a||1,pageSize:10,capital:""}},n=t.getProductAllData(i);return{data:o(n.data),pagination:n.pagination}},attrTextModel:function(t,a){e.belongProductUid=a.uid||"",e.belongProduct=t||"",e.$apply()}})},e.getProduct(),function(){var a=null,i="",n="",o=["start-time-canlander","end-time-canlander"];e.verifyState=Lang.getValByKey("price","price_draft"),e.verifyStateId=1;var r=function(e,a){e=e||"";var i={urlParams:{q:e,pageIndex:1,pageSize:100,async:!0}};t.getAccount(i,a)},c=function(a,i){a=a||"";var n={urlParams:{q:"",pageIndex:1,pageSize:10,type:e.iInputCostTypeValue,sort:"code",async:!0}};t.getCost(n,i)},d=function(e,a,i){a||(a=1),e=e||"";var n={urlParams:{q:e,pageIndex:a,pageSize:10,status:3,includeAllAudit:!0},seatParams:{serviceTypeId:-1}};t.getServices(n,i)},l=function(e){for(var t=0;t<o.length;t++)e!=o[t]&&$(".ui-datepicker").removeClass(o[t])},s=function(){e.isShowPriceLevelList=!0,e.$apply()},p=function(){for(var t=0;t<e.priceLevelList.length;t++)e[e.priceLevelList[t]]=!1;e.isShowPriceLevelList=!1,e.$apply()};selectFactory({data:{data:[{name:Lang.getValByKey("price","price_draft"),id:1},{name:Lang.getValByKey("price","price_wait_verify"),id:2},{name:Lang.getValByKey("price","price_verify_ok"),id:3},{name:Lang.getValByKey("price","price_start_used"),id:4},{name:Lang.getValByKey("price","price_stop_used"),id:5}]},id:"verify-state",defaultText:"全部",attrTextModel:function(t,a,i){e.verifyStateId=t?i.id:"",e.verifyState=t,e.$apply()}}),selectFactory({data:{data:[{name:"等级价",id:1},{name:"协议价",id:2}]},defaultText:"全部",id:"price-type",attrTextModel:function(t,a,i){e.priceTypeId=t?i.id:"",e.priceType=t,e.$apply(),1==e.priceTypeId?s():p()}}),selectFactory({data:{data:[{name:"全部",id:-2},{name:"已审核",id:3},{name:"已启用",id:4},{name:"已停用",id:5}]},id:"use-state",defaultText:"",attrTextModel:function(t,a,i){e.useStateId=t?i.id:-2,e.useState=t,e.$apply()}}),r("",function(t){t.data.forEach(function(e){e.name=e.name+"("+e.code+")"}),selectFactory({isSearch:!0,pagination:!0,searchPlaceHoder:"请输入名称或编码",data:t,id:"account-type",attrTextModel:function(t,a,i){e.accountType=t,void 0!==i.id?e.accountTypeId=i.id:e.accountTypeId="",e.$apply()},onSearchValueChange:function(t,a,i){r("",function(e){e.data.forEach(function(e){e.name=e.name+"("+e.code+")"}),t.setData(e)}),e.$apply()}})}),t.getCostType(function(t){selectFactory({data:t,id:"cost-type-start",attrTextField:{"ng-value":"id"},attrTextId:function(t){e.iInputCostTypeValue=t},attrTextModel:function(t,i,n){if(e.costTypeStartCode="",e.costTypeEndId="",!t)return void a.clearData();e.costTypeStartCode=n.code,c(t,function(i){i.data&&0==i.data.length?a.setData([]):a.setData(i),e.costTypeStart=t,e.$apply()})}})}),a=selectFactory({data:[],id:"cost-type-end",isSearch:!0,isUsePinyin:!0,attrTextModel:function(t,a,i){e.costTypeEndId=t?i.id:"",e.costTypeEnd=t,e.$apply()}}),t.getGoods(function(t){selectFactory({data:t,id:"goods-type",defaultText:"全部",attrTextModel:function(t,a,i){e.goodsTypeId=t?i.code:"",e.goodsType=t,e.$apply()}})}),t.getCurrencyList({q:"",pageSize:10,pageIndex:1},function(a){a.data.forEach(function(e){e.name=e.name+"("+e.code+")"}),selectFactory({data:a,id:"valuation-currency",isSearch:!0,pagination:!0,defaultText:"全部",searchPlaceHoder:Lang.getValByKey("price","price_search_valuation_currency"),attrTextModel:function(t,a,i){e.valuationCurrencyId=t?i.code:"",e.valuationCurrency=t,e.$apply()},onSearchValueChange:function(a,i,n){t.getCurrencyList({q:i,pageSize:10,pageIndex:n||1},function(e){e.data.forEach(function(e){e.name=e.name+"("+e.code+")"}),a.setData(e)}),e.$apply()}})}),d("",1,function(t){angular.forEach(t.data,function(e){e.name+="("+e.code+")"}),selectFactory({data:t,id:"belong-service",isSearch:!0,closeLocalSearch:!0,pagination:!0,searchPlaceHoder:Lang.getValByKey("common","common_select_search_tips"),onSearchValueChange:function(e,t,a){d(t,a,function(t){console.log(a),angular.forEach(t.data,function(e){e.name+="("+e.code+")"}),e.setData(t)})},attrTextModel:function(t,a,i){e.belongServiceId=t?i.uid:"",e.belongService=t,e.$apply()}})}),$("#start-time").datetimepicker({timeFormat:"HH:mm:ss",dateFormat:"yy-mm-dd",showSecond:!0,changeYear:!0,changeMonth:!0,beforeShow:function(){i=$("#start-time").val(),$("#start-time").datetimepicker("setDate",i),$("#end-time").val()&&($("#start-time").datetimepicker("option","maxDate",$("#end-time").val()),$("#start-time").val(i)),$(".ui-datepicker").css("visibility","visible"),$(".ui-datepicker").addClass("canlander2"),l("start-time-canlander"),$(".ui-datepicker").addClass("start-time-canlander")},onChangeMonthYear:function(){i=$("#start-time").val()},onSelect:function(e){var t=new Date(e).getTime(),a=new Date($("#end-time").val()).getTime();a<t?($("#start-time").val(new Date(a).format("yyyy-MM-dd hh:mm:ss")),$("#start-time").datetimepicker("refresh"),i=$("#start-time").val()):i=e},onClose:function(){if(!$.trim($("#start-time").val()))return void $("#start-time").val("");$("#start-time").datetimepicker("setDate",i),new Date(n).getTime()<new Date(i).getTime()?($("#start-time").datetimepicker("setDate",n),$("#start-time").val(n)):($("#start-time").datetimepicker("setDate",i),$("#start-time").val(i))}}),$("#end-time").datetimepicker({timeFormat:"HH:mm:ss",dateFormat:"yy-mm-dd",showSecond:!0,changeYear:!0,changeMonth:!0,maxDate:"2100-01-01 00:00:00",beforeShow:function(){n=$("#end-time").val(),$("#end-time").datetimepicker("option","defaultDate",n),$("#end-time").datetimepicker("setDate",n),$("#start-time").val()&&$("#end-time").datetimepicker("option","minDate",$("#start-time").val()),$(".ui-datepicker").css("visibility","visible"),$(".ui-datepicker").addClass("canlander2"),l("end-time-canlander"),$(".ui-datepicker").addClass("end-time-canlander")},onChangeMonthYear:function(){n=$("#end-time").val()},onSelect:function(e){var t=new Date($("#start-time").val()).getTime();new Date(e).getTime()<t?($("#end-time").val(new Date(t).format("yyyy-MM-dd hh:mm:ss")),$("#end-time").datetimepicker("refresh"),n=$("#end-time").val()):n=e},onClose:function(){if(!$.trim($("#end-time").val()))return void $("#end-time").val("");new Date(n).getTime()<new Date($("#start-time").val()).getTime()?($("#end-time").datetimepicker("setDate",$("#start-time").val()),$("#end-time").val($("#start-time").val())):($("#end-time").datetimepicker("setDate",n),$("#end-time").val(n))}})}(),controller.init(e,a,n),function(){var t=easySpa.queryUrlValByKey("type");t&&("1"==t?e.switchTab({target:$(".tab-list a")[0]},1):"2"==t&&e.switchTab({target:$(".tab-list a")[1]},2))}(),i.bindEvent()}])});