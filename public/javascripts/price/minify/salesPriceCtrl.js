easySpa.use(["public/javascripts/fragment/costPrice/promptCtr.js"]);var addSalesPriceUrl="#/priceDetail?module=salesPrice&q=price",controller={$scope:null,service:null,tableService:null,initViewButton:function(e){$.extend(!0,e.viewButton,{isTabList:!1,isCopy:!0,copyPrompt:!0,isBelongToProduct:!0,isBelongToService:!1,isShowPriceType:!0,isShowWeightAndArea:!0})},loadSalePriceData:function(){$scope=this.$scope;var e=this;$scope.pricePlanQ=$scope.pricePlan,$scope.belongServiceQ=$scope.belongServiceId,$scope.startAddressQ=$scope.startAddress,$scope.belongProductQ=$scope.belongProduct,$scope.tableModel.restData.status=$scope.verifyStateId;var t={urlParams:$scope.tableModel.restData};e.tableService.getTable($scope.tableModel.restURL,t,function(a){$scope.q=$scope.tableModel.restData.q,$scope.isShowIcon=!0,0===a.errorCode&&($scope.tableModel=e.tableService.table($scope.tableModel,t,a),setTimeout(function(){$scope.setScroll(),$(window).on("resize",$scope.setScroll),$scope.$apply(),$(".table-box").focus()},100))})},initPage:function(){function e(e,r){function o(a){e(a,function(e){0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),$(document).promptBox("closePrompt"),t.loadSalePriceData()):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})}if(0!==a.tableModel.selectNumber&&0!==$(".table-box tbody tr").length){var i=[],l=t.tableService.getSelectTable(a.tableModel.tableBody);if(!l.length)return accountView.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0}),!1;angular.forEach(l,function(e){i.push(e.uid)}),r?$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("price","price_prompt_delete_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){o(i)}}]}):o(i)}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0})}var t=this,a=this.$scope;a.isShowPriceLevelList=!1,a.tableModel={tableHeader:[Lang.getValByKey("price","price_id"),Lang.getValByKey("price","price_plan"),Lang.getValByKey("price","price_code"),Lang.getValByKey("price","price_belong_product"),Lang.getValByKey("price","price_type"),Lang.getValByKey("price","price_start_address"),Lang.getValByKey("price","price_goods_type"),Lang.getValByKey("price","price_valuation_currency"),Lang.getValByKey("price","price_account_type"),Lang.getValByKey("price","price_start_time"),Lang.getValByKey("price","price_end_time"),Lang.getValByKey("price","price_state")],tableHeaderSize:["5%","10%","5%","12%","6%","9%","6%","6%","6%","12%","12%","6%"],tableBody:[],restURL:"logistics.getCostPriceList",restData:{type:2,pageIndex:1,pageSize:10,orderby:"createtime",isAsc:!1},selectNumber:0,selectFlag:!1},this.loadSalePriceData(),a.resetData=function(){a.costTypeStartCode="",a.pricePlan="",a.verifyStateId=1,a.verifyState="草稿",a.useStateId="",a.useState="",a.accountType="",a.accountTypeId="",a.costTypeStart="",a.costTypeEnd="",a.costTypeEndId="",a.valuationCurrency="",a.valuationCurrencyId="",a.startAddress="",a.goodsType="",a.goodsTypeId="",$("#start-time").val(""),$("#end-time").val(""),a.belongProduct="",a.belongProductUid="",a.belongProductValue="",a.priceType="",a.priceTypeId="",a.q="";for(var e=0;e<a.priceLevelList.length;e++)a[a.priceLevelList[e]]=!1;a.isShowPriceLevelList=!1,a.isResetSearchCls=!1,a.search()},a.search=function(){for(var e="",r=0;r<a.priceLevelList.length;r++)a[a.priceLevelList[r]]&&(e+=r+1+",");e&&e.lastIndexOf(",")===e.length-1&&(e=e.substring(0,e.length-1)),a.tableModel.restData.feeTypeCode=a.costTypeStartCode,a.tableModel.restData.gradeType=a.priceTypeId,a.tableModel.restData.grades=e,a.tableModel.restData.biz=a.belongProductUid,a.tableModel.restData.q=a.pricePlan,a.tableModel.restData.pageIndex=1,a.tableModel.restData.currencyId=a.valuationCurrencyId,a.tableModel.restData.feeTypeId=a.costTypeEndId,a.tableModel.restData.settleMentId=a.accountTypeId,a.tableModel.restData.starts=a.startAddress,a.tableModel.restData.cargoTypeCode=a.goodsTypeId,a.tableModel.restData.startEffectTime=$("#start-time").val(),a.tableModel.restData.endEffectTime=$("#end-time").val(),a.tableModel.restData.status=a.verifyStateId,t.loadSalePriceData()},a.delete=function(){e(t.service.deleteSalePrice,!0)},a.submitVerify=function(){a.showConfirmWindow(function(){e(t.service.submitSalePrice)},Lang.getValByKey("price","price_confirm_submit_price_method"))},a.add=function(){location.href=addSalesPriceUrl},a.editCurrentPrice=function(e){location.href=addSalesPriceUrl+"&uid="+e},a.copy=function(){if(0!==a.tableModel.selectNumber&&0!==$(".table-box tbody tr").length){var e=t.tableService.getSelectTable(a.tableModel.tableBody);if(e.length>1)return void $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_limit_tip"),type:"errer",manualClose:!0});a.$broadcast("resetDataEvent",{service:t.service,uid:e[0].uid}),a.promptTitle=Lang.getValByKey("price","price_copy_cost_price_title"),a.nestCostPriceFrom=!0,$("#nest-costPriceFrom").css("display","table"),$(".input-text").removeClass("ng-dirty"),$(".errors").addClass("ng-hide"),$('button[name="prompt-save"]').addClass("save").removeClass("edit")}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0})}},init:function(e,t,a){this.initViewButton(e),this.$scope=e,this.service=t,this.tableService=a,this.initPage()}};