easySpa.use(["public/javascripts/fragment/costPrice/promptCtr.js"]);var addCostPriceUrl="#/priceDetail?module=costPrice&q=price",controller={$scope:null,service:null,tableService:null,initViewButton:function(e){$.extend(!0,e.viewButton,{copyPrompt:!0,isTabList:!1,isShowWeightAndArea:!0})},loadCostPriceData:function(){var e=this,t=this.$scope;t.pricePlanQ=t.pricePlan,t.belongServiceQ=t.belongServiceId,t.startAddressQ=t.startAddress,t.belongProductQ=t.belongProduct,t.tableModel.restData.status=t.verifyStateId;var a={urlParams:t.tableModel.restData};this.tableService.getTable(t.tableModel.restURL,a,function(r){t.q=t.tableModel.restData.q,t.isShowIcon=!0,0===r.errorCode&&(t.tableModel=e.tableService.table(t.tableModel,a,r),setTimeout(function(){t.setScroll(),$(window).on("resize",t.setScroll),t.$apply(),$(".table-box").focus()},100))})},initTable:function(){this.$scope.tableModel={tableHeader:[Lang.getValByKey("price","price_id"),Lang.getValByKey("price","price_plan"),Lang.getValByKey("price","price_code"),Lang.getValByKey("price","price_belong_service"),Lang.getValByKey("price","price_start_address"),Lang.getValByKey("price","price_goods_type"),Lang.getValByKey("price","price_valuation_currency"),Lang.getValByKey("price","price_account_type"),Lang.getValByKey("price","price_start_time"),Lang.getValByKey("price","price_end_time"),Lang.getValByKey("price","price_state")],tableHeaderSize:["5%","13%","5%","18%","6%","6%","6%","6%","12%","12%","6%"],tableBody:[],restURL:"logistics.getCostPriceList",restData:{pageIndex:1,pageSize:10,orderby:"createtime"},selectNumber:0,selectFlag:!1},this.loadCostPriceData()},registNgIfDomReadEvent:function(){},bindEvent:function(){function e(e){a.service.submitVerifyCostPrice(e,function(e){0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),$(document).promptBox("closePrompt"),a.loadCostPriceData()):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})}function t(e){a.service.deleteCostPrice(e,function(e){0===e.errorCode?($(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success",time:3e3}),$(document).promptBox("closePrompt"),a.loadCostPriceData()):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})}var a=this,r=this.$scope;$(window).resize(function(){var e=getCurrentInputEle();if(e&&e.length>0){$(".ui-datepicker").offset({left:e.offset().left})}}),r.submitVerify=function(){var t=a.$scope;if(0!=t.tableModel.selectNumber&&0!=$(".table-box tbody tr").length){var r=[],o=a.tableService.getSelectTable(t.tableModel.tableBody);if(!o.length)return accountView.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0}),!1;angular.forEach(o,function(e){r.push(e.uid)}),t.showConfirmWindow(function(){e(r)},Lang.getValByKey("price","price_confirm_submit_price_method"))}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0})},r.delete=function(){if(0!=r.tableModel.selectNumber&&0!=$(".table-box tbody tr").length){var e=[],o=a.tableService.getSelectTable(r.tableModel.tableBody);if(!o.length)return accountView.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0}),!1;angular.forEach(o,function(t){e.push(t.uid)}),$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("price","price_prompt_delete_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){t(e)}}]})}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0})},r.add=function(){location.href=addCostPriceUrl+"&action=new"},r.editCurrentPrice=function(e){location.href=addCostPriceUrl+"&uid="+e},r.copy=function(){if(0!=r.tableModel.selectNumber&&0!=$(".table-box tbody tr").length){var e=a.tableService.getSelectTable(r.tableModel.tableBody);if(e.length>1)return void $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_limit_tip"),type:"errer",manualClose:!0});r.$broadcast("resetDataEvent",{service:a.service,uid:e[0].uid}),r.promptTitle=Lang.getValByKey("price","price_copy_cost_price_title"),r.nestCostPriceFrom=!0,$("#nest-costPriceFrom").css("display","table"),$(".input-text").removeClass("ng-dirty"),$(".errors").addClass("ng-hide"),$('button[name="prompt-save"]').addClass("save").removeClass("edit")}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("price","price_prompt_delay_tip"),type:"errer",manualClose:!0})},r.search=function(){r.tableModel.restData.feeTypeCode=r.costTypeStartCode,r.tableModel.restData.biz=r.belongServiceId,r.tableModel.restData.q=r.pricePlan,r.tableModel.restData.pageIndex=1,r.tableModel.restData.currencyId=r.valuationCurrencyId,r.tableModel.restData.feeTypeId=r.costTypeEndId,r.tableModel.restData.settleMentId=r.accountTypeId,r.tableModel.restData.starts=r.startAddress,r.tableModel.restData.cargoTypeCode=r.goodsTypeId,r.tableModel.restData.startEffectTime=$("#start-time").val(),r.tableModel.restData.endEffectTime=$("#end-time").val(),r.tableModel.restData.status=r.verifyStateId,a.loadCostPriceData()},r.resetData=function(){r.costTypeStartCode="",r.pricePlan="",r.verifyState="草稿",r.verifyStateId=1,r.accountType="",r.accountTypeId="",r.costTypeStart="",r.costTypeEnd="",r.costTypeEndId="",r.valuationCurrency="",r.valuationCurrencyId="",r.startAddress="",r.goodsType="",r.goodsTypeId="",$("#start-time").val(""),$("#end-time").val(""),r.belongService="",r.belongServiceId="",r.q="",r.search()}},init:function(e,t,a){this.initViewButton(e),this.$scope=e,this.service=t,this.tableService=a,this.initTable(),this.bindEvent(),this.registNgIfDomReadEvent()}};