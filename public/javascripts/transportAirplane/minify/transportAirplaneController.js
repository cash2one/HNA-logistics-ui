easySpa.require(["widget/slimscroll","widget/prompt","public/common/tableController.js","public/common/pictureController.js","widget/slides"],function(){app.controller("transportAirplaneCtrl",["$scope","transportAirplaneService","transportAirplaneView","tableService","pictureService",function(e,t,a,r,o){function n(e){var t=e?e.length:0;$("#globalization").children("li").each(function(){$(this).children("input").removeClass("lang-invalid ng-invalid ng-dirty").next(".verification").children("span").html("");for(var a=$(this).children("input").val("").attr("data-code"),r=0;r<t;r++)e[r].language.toLowerCase()==a.toLowerCase()&&$(this).children("input").val(e[r].localName)})}function i(e){for(var t=e?e.length:0,a=[],r=0;r<t;r++)e[r].picUrlID="object"==typeof e[r].picUrlID?e[r].picUrlID.id:e[r].picUrlID,a.push(e[r].picUrlID);return a}function l(e){for(var t=e?e.length:0,a={},r=[],o=0;o<t;o++)a={picUrlID:e[o],delshow:!1},r.push(a);return r}e.transport={id:0},e.tableModel={tableHeader:[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("transportAirplane","transportAirplane_page_name"),Lang.getValByKey("transportAirplane","transportAirplane_page_iata"),Lang.getValByKey("transportAirplane","transportAirplane_page_icao"),Lang.getValByKey("transportAirplane","transportAirplane_code_maxPlayLoad"),Lang.getValByKey("common","common_page_remarks")],tableBody:[],restURL:"logistics.getTransportTable",restData:{q:"",pageIndex:1,pageSize:10,sort:"IATA"},selectNumber:0,selectFlag:!1},e.pictureModel={edit:!0,uploadShow:!0,picture:[],accept:"image/jpg,image/jpeg,image/png,image/bmp,image/tiff,image/JPG,image/JPEG,image/PNG,image/BMP,image/TIFF,application/pdf"},e.getFile=function(t){var a=t.length;if(a+e.pictureModel.picture.length>o.maxUpload)return $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("transportAirplane","transportAirplane_code_maxUploadTIps")+o.maxUpload+Lang.getValByKey("transportAirplane","transportAirplane_code_maxUploadLastTIps"),type:"errer",manualClose:!0}),!1;for(var r=0;r<a;r++){var n=o.uploadFile(e.pictureModel,t[r]);if(!n)return!1;n.errorlocal?$(document).promptBox({isDelay:!0,contentDelay:n.errorlocal,type:"errer",manualClose:!0}):n.then(function(t){0===t.data.errorCode?(e.pictureModel=o.updateModel(e.pictureModel,t.data.data),$(document).promptBox({isDelay:!0,contentDelay:t.data.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:t.data.msg,type:"errer",manualClose:!0})})}},e.getLanguage=function(){t.getLanguage(function(t){0===t.errorCode&&(e.language=t.data)})},e.getLanguage(),e.getTable=function(t){e.q=e.tableModel.restData.q,t&&(e.tableModel.restData.pageIndex=1);var a={urlParams:e.tableModel.restData};r.getTable(e.tableModel.restURL,a,function(t){if(0===t.errorCode){e.tableModel=r.table(e.tableModel,a,t);var o=$(".m-table-page").height()-255;setTimeout(function(){$(".table-container tbody").slimscroll({height:o}),$(window).resize(function(){o=$(".m-table-page").height()-255,$(".table-container tbody").slimscroll({height:o})})},10)}})},e.getTable();var p=$("#nest-TransportFrom .label-text");a.propmtCostEvent(p),e.add=function(){e.TransportForm.$setPristine(),e.TransportForm.$setUntouched(),e.nestTransportForm=!0,$("#nest-TransportFrom").attr("style","").find(".title").text(Lang.getValByKey("transportAirplane","transportAirplane_page_add")),$(".remote-invalid").removeClass("remote-invalid"),e.transportName="",e.transportIata="",e.transportIcao="",e.transportPayload="",e.remark="",e.textareaNumber=140,e.pictureModel.picture=[],e.pictureModel=o.init(e.pictureModel),$("#globalization").find(".input-text").each(function(){$(this).val("").removeClass("lang-invalid ng-invalid ng-dirty"),$(this).next(".verification").children("span").html("")}),a.loadBarEvent(p),$('button[name="prompt-save"]').addClass("save").removeClass("edit")},e.edit=function(r){e.transport.id=r,e.TransportForm.transportIata.errorTips="",$(".remote-invalid").removeClass("remote-invalid"),$("#nest-TransportFrom").attr("style","").find(".title").text(Lang.getValByKey("transportAirplane","transportAirplane_code_modelDetail")),e.nestTransportForm=!0,a.loadBarEvent(p),$('button[name="prompt-save"]').addClass("save").removeClass("edit"),t.getDetail({seatParams:{id:r}},function(t){t&&0===t.errorCode&&(e.transportName=t.data.name,e.transportIata=t.data.iata,e.transportIcao=t.data.icao,e.transportPayload=t.data.payload,e.remark=t.data.description,e.textareaNumber=140-(e.remark?e.remark.length:0),e.pictureModel.picture=l(t.data.files),e.pictureModel=o.init(e.pictureModel),n(t.data.i18n))})},e.showTextNumber=function(){e.textareaNumber=140-e.remark.length},e.cancel=function(){e.nestTransportForm=!1,e.transport.id&&(e.transport.id=0)},e.save=function(){if(e.transportName||e.TransportForm.transportName.$setDirty(),e.transportIata||e.TransportForm.transportIata.$setDirty(),e.transportIcao||e.TransportForm.transportIcao.$setDirty(),$("#code-msg").hasClass("remote-invalid")||!e.TransportForm.$valid)return scrollToErrorView($(".switch-list")),void a.displayErrorBox(p);e.transportPayload&&isNaN(e.transportPayload)&&(e.transportPayload="");var r=[];$("#globalization").children("li").each(function(){if($.trim($(this).children("input").val())){var e={};e.language=$(this).children("input").attr("data-code"),e.localName=$.trim($(this).children("input").val()),r.push(e)}});var o=[];o=i(e.pictureModel.picture);var n={urlParams:{name:e.transportName,iata:angular.uppercase(e.transportIata),icao:angular.uppercase(e.transportIcao),payload:e.transportPayload,description:e.remark,i18n:r,pictures:o}};e.transport.id?(n.seatParams={id:e.transport.id},t.saveEdit(n,function(t){t&&0===t.errorCode?(a.promptBox({isDelay:!0,contentDelay:t.msg,type:"success"}),e.nestTransportForm=!1,e.getTable(),e.transport.id&&(e.transport.id=0)):a.promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})):t.save(n,function(t){t&&0===t.errorCode?(a.promptBox({isDelay:!0,contentDelay:t.msg,type:"success"}),e.nestTransportForm=!1,e.getTable()):a.promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})},e.checkIata=function(){var a={urlParams:{iata:angular.uppercase(e.transportIata),id:e.transport.id}};e.transportIata&&t.checkIata(a,function(t){0!=t.errorCode?(e.TransportForm.transportIata.errorTips=t.msg,$("#code-msg").removeClass("ng-hide").addClass("remote-invalid"),$(".check-iata").addClass("ng-invalid")):($("#code-msg").addClass("ng-hide").removeClass("remote-invalid"),$(".check-iata").removeClass("ng-invalid"),e.TransportForm.transportIata.errorTips="")})},e.del=function(){var o={},n=[],i=r.getSelectTable(e.tableModel.tableBody);if(!i.length)return a.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_code_noSelected"),type:"errer",manualClose:!0}),!1;angular.forEach(i,function(e){n.push(e.id)}),o={urlParams:n};var l={title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("transportAirplane","transportAirplane_code_modelDelTips")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){t.del(o,function(t){a.promptBox("closePrompt"),0===t.errorCode?(a.promptBox({isDelay:!0,contentDelay:t.msg,type:"success"}),e.getTable(),e.$apply()):a.promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})})}}]};a.promptBox(l)},e.international=function(){window.location.href="#/international?q=transportAirplane"},e.getPictureUrl=function(t){$("#slides").picturePreview({pictureId:t},e.pictureModel.picture)}}])});