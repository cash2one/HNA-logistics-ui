app.factory("rateView",[function(){function e(e){for(var t=0;t<c.length;t++)e!=c[t]&&$(".ui-datepicker").removeClass(c[t])}function t(){for(var e=0;e<c.length;e++)if($(".ui-datepicker").hasClass(c[e]))return $(o[e]);return null}function i(e){e.isEdit&&new Date($("#start-time").val()).getTime()>new Date(standardEndTime).getTime()&&($("#start-time").val(new Date(standardEndTime).format("yyyy-MM-dd hh:mm:ss")),$("#start-time").datetimepicker("refresh"))}function a(e){e.isEdit&&new Date($("#end-time").val()).getTime()<new Date(standardStartTime).getTime()&&($("#end-time").val(new Date(standardStartTime).format("yyyy-MM-dd hh:mm:ss")),$("#end-time").datetimepicker("refresh"))}var n={},m="",r="",m="",d="",s="",c=["begin-time-canlander","finish-time-canlander","start-time-canlander","end-time-canlander"],o=["#begin-time","#finish-time","#start-time","#end-time"],l="2100-01-01 00:00:00";return n.initCalander=function(n){$("#start-time").datetimepicker({timeFormat:"HH:mm:ss",dateFormat:"yy-mm-dd",showSecond:!0,changeYear:!0,changeMonth:!0,maxDate:l,beforeShow:function(){r=$("#start-time").val(),$("#start-time").datetimepicker("setDate",r),$("#end-time").val()&&($("#start-time").datetimepicker("option","maxDate",$("#end-time").val()),$("#start-time").val(r)),n.isEdit?$("#start-time").datetimepicker("option","minDate",""):$("#start-time").datetimepicker("option","minDate",$("#start-time").val()),new Date($("#end-time").val()).getTime()>new Date(standardEndTime).getTime()?$("#start-time").datetimepicker("option","maxDate",standardEndTime):$("#start-time").datetimepicker("option","maxDate",$("#end-time").val()),i(n),$(".ui-datepicker").css("visibility","visible"),$(".ui-datepicker").removeClass("canlander"),$(".ui-datepicker").addClass("canlander2"),e("start-time-canlander"),$(".ui-datepicker").addClass("start-time-canlander")},onChangeMonthYear:function(){r=$("#start-time").val(),i(n)},onSelect:function(e){var t=new Date(e).getTime(),a=new Date($("#end-time").val()).getTime();if(!n.isEdit&&t<new Date(r).getTime())return $("#start-time").val(new Date(r).format("yyyy-MM-dd hh:mm:ss")),void $("#start-time").datetimepicker("refresh");a<t?($("#start-time").val(new Date(a).format("yyyy-MM-dd hh:mm:ss")),$("#start-time").datetimepicker("refresh"),r=$("#start-time").val()):r=e,i(n)},onClose:function(){$("#start-time").datetimepicker("setDate",r),m=$("#end-time").val(),new Date(m).getTime()<new Date(r).getTime()?($("#start-time").datetimepicker("setDate",m),$("#start-time").val(m)):($("#start-time").datetimepicker("setDate",r),$("#start-time").val(r)),i(n)}}),$("#end-time").datetimepicker({timeFormat:"HH:mm:ss",dateFormat:"yy-mm-dd",showSecond:!0,changeYear:!0,changeMonth:!0,maxDate:l,beforeShow:function(t){if(m=$("#end-time").val(),$("#end-time").datetimepicker("setDate",m),$("#start-time").val()&&$("#end-time").datetimepicker("option","minDate",$("#start-time").val()),new Date($("#start-time").val()).getTime()<new Date(standardStartTime).getTime()?$("#end-time").datetimepicker("option","minDate",standardStartTime):$("#end-time").datetimepicker("option","minDate",$("#start-time").val()),a(n),!n.isEdit)return $("#end-time").val(l),void $(".ui-datepicker").css("visibility","hidden");$("#end-time").val().indexOf(l.split(" ")[0])>-1?$(".ui-datepicker").css("visibility","hidden"):$(".ui-datepicker").css("visibility","visible"),$(".ui-datepicker").removeClass("canlander"),$(".ui-datepicker").addClass("canlander2"),e("end-time-canlander"),$(".ui-datepicker").addClass("end-time-canlander")},onChangeMonthYear:function(){m=$("#end-time").val(),new Date(m).getTime()>new Date(l).getTime()&&(m=l,$("#end-time").val(l),$("#end-time").datetimepicker("refresh")),a(n)},onSelect:function(e){var t=new Date($("#start-time").val()).getTime(),i=new Date(e).getTime();i<t?($("#end-time").val(new Date(t).format("yyyy-MM-dd hh:mm:ss")),$("#end-time").datetimepicker("refresh"),m=$("#end-time").val()):i>new Date(l).getTime()?($("#end-time").val(new Date(l).format("yyyy-MM-dd hh:mm:ss")),$("#end-time").datetimepicker("refresh"),m=$("#end-time").val(l)):m=e,a(n)},onClose:function(){new Date(m).getTime()<new Date($("#start-time").val()).getTime()?($("#end-time").datetimepicker("setDate",$("#start-time").val()),$("#end-time").val($("#start-time").val())):($("#end-time").datetimepicker("setDate",m),$("#end-time").val(m)),a(n)}}),$("#begin-time").on("keyup",function(){$.trim($("#begin-time").val())||(d="")}),$("#begin-time").datetimepicker({timeFormat:"HH:mm:ss",dateFormat:"yy-mm-dd",showSecond:!0,changeYear:!0,changeMonth:!0,maxDate:l,showOtherMonths:!0,beforeShow:function(){d=$("#begin-time").val(),$("#begin-time").datetimepicker("option","defaultDate",d),$("#begin-time").datetimepicker("setDate",d),$.trim($("#finish-time").val())?($("#begin-time").datetimepicker("option","maxDate",$("#finish-time").val()),$("#begin-time").val(d)):($("#begin-time").datetimepicker("option","maxDate",""),$("#begin-time").val(d)),$(".ui-datepicker").css("visibility","visible"),$(".ui-datepicker").removeClass("canlander2"),$(".ui-datepicker").addClass("canlander"),e("begin-time-canlander"),$(".ui-datepicker").addClass("begin-time-canlander")},onChangeMonthYear:function(){d=$("#begin-time").val()},onSelect:function(e){var t=new Date(e).getTime(),i=new Date($("#finish-time").val()).getTime();i<t&&$.trim($("#finish-time").val())?($("#begin-time").val(new Date(i).format("yyyy-MM-dd hh:mm:ss")),$("#begin-time").datetimepicker("refresh"),d=$("#begin-time").val()):d=e},onClose:function(){$("#begin-time").datetimepicker("setDate",d),$("#begin-time").val(d)}}),$("#finish-time").on("keyup",function(){$.trim($("#finish-time").val())||(s="")}),$("#finish-time").datetimepicker({timeFormat:"HH:mm:ss",dateFormat:"yy-mm-dd",showSecond:!0,changeYear:!0,changeMonth:!0,maxDate:l,beforeShow:function(){s=$("#finish-time").val(),$("#finish-time").datetimepicker("option","defaultDate",s),$("#finish-time").datetimepicker("setDate",s),$.trim($("#begin-time").val())?$("#finish-time").datetimepicker("option","minDate",$("#begin-time").val()):$("#finish-time").datetimepicker("option","minDate",""),$(".ui-datepicker").css("visibility","visible"),$(".ui-datepicker").removeClass("canlander2"),$(".ui-datepicker").addClass("canlander"),e("finish-time-canlander"),$(".ui-datepicker").addClass("finish-time-canlander")},onSelect:function(e){var t=new Date($("#begin-time").val()).getTime();new Date(e).getTime()<t&&$.trim($("#begin-time").val())?($("#finish-time").val(new Date(t).format("yyyy-MM-dd hh:mm:ss")),$("#finish-time").datetimepicker("refresh"),s=$("#finish-time").val()):s=e},onChangeMonthYear:function(){s=$("#finish-time").val()},onClose:function(){$("#finish-time").datetimepicker("setDate",s),$("#finish-time").val(s)}}),$(window).resize(function(){var e=t();if(e&&e.length>0){$(".ui-datepicker").offset({left:e.offset().left})}})},n}]);