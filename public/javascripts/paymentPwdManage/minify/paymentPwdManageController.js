easySpa.require(["widget/prompt"],function(){app.controller("paymentPwdManageCtrl",["$scope","$route","paymentPwdManageService","paymentPwdManageView",function(e,t,r,s){function n(){document.getElementById("strength_L").style.background="#eeeeee",document.getElementById("strength_M").style.background="#eeeeee",document.getElementById("strength_H").style.background="#eeeeee"}function d(e){for(var t=0,r=0;r<4;r++)1&e&&t++,e>>>=1;return t}function o(){document.getElementById("reset_strength_L").style.background="#eeeeee",document.getElementById("reset_strength_M").style.background="#eeeeee",document.getElementById("reset_strength_H").style.background="#eeeeee"}!function(){angular.element($(".tip-box")).remove(),e.setPwd="",e.setPwdConfirm="",e.resetPwdConfirm="",e.updatePayPwd="",e.updatePayPwdConfirm="",e.setPwdContainer=!0,e.ErrorPayPwd=!1,e.resetProgress=1,e.errorPasswordCount=0,e.setPasswordSuccess="重置成功",r.isNeedPassword(function(t){0===t.errorCode&&(t.data?e.setPassword=!0:(e.setPassword=!1,r.isLogisticAccountLocked(function(t){0!==t.errorCode&&(e.ErrorPayPwd=!0,angular.element($("#ErrorPayPwd")).html(t.msg),angular.element($("#resetPwdConfirm, .next-step")).attr("disabled","disabled"))})))})}(),e.checkPwdStrength=function(){var t,r,s,o=e.setPwd,a=0;if(e.ExistNoSupWord=!1,null==o||""==o||void 0==o)t=r=s="#eeeeee",a=0;else{for(var l=0;l<o.length;l++){var i,P=o.charAt(l),u=/[!@#&()_+,.\/\\^]+/,w=/[0-9]+/,c=/[a-z]+/,g=/[A-Z]+/;if(w.test(P))i=1;else if(g.test(P))i=2;else if(c.test(P))i=4;else{if(!u.test(P))return e.ExistNoSupWord=!0,void n();i=8}a|=i;var m=d(a)}0==m||o.length>18?(t=r=s="#eeeeee",e.passWordLevel="original"):o.length<6||m<=2?(t="#A7DFF4",r=s="#eeeeee",e.passWordLevel="low"):o.length>=6&&o.length<=9&&3==m||o.length>=6&&o.length<=7&&4==m?(t=s="#eeeeee",r="#6CC7E9",e.passWordLevel="normal"):o.length>=10&&o.length<=18&&3==m||o.length>=8&&o.length<=18&&4==m?(s="#3BAFDA",t=r="#eeeeee",e.passWordLevel="high"):(t=r=s="#eeeeee",e.passWordLevel="original")}document.getElementById("strength_L").style.background=t,document.getElementById("strength_M").style.background=r,document.getElementById("strength_H").style.background=s},e.checkPwd=function(){e.showPwLow="low"==e.passWordLevel},e.checkVerify=function(){(e.showDiffErr=e.setPwdConfirm||e.setPwdConfirm)?e.showDiffErr=!1:e.showDiffErr=!0},e.initPwd=function(){if(e.setPwd||e.setPwds.setPwd.$setDirty(),e.setPwdConfirm||e.setPwds.setPwdConfirm.$setDirty(),e.setPwds.$valid&&"low"!=e.passWordLevel&&"original"!=e.passWordLevel&&!e.ExistNoSupWord&&e.setPwd==e.setPwdConfirm){var t={urlParams:{newPassword:e.setPwd,repeatPassword:e.setPwdConfirm}};r.initPaymentPwd(t,function(t){e.setSuccessTxt=t.msg,e.setPwdContainer=!1,0===t.errorCode?e.setSuccess=!0:e.setSuccess=!1})}},e.goToReset=function(){window.location.reload()},e.checkPaymentPwd=function(){if(!e.resetPwdConfirm)return void e.resetPwd.resetPwdConfirm.$setDirty();r.verifyPayPwd({urlParams:{oldPassword:e.resetPwdConfirm}},function(t){0===t.errorCode?(e.ErrorPayPwd=!1,e.resetProgress=2):(e.ErrorPayPwd=!0,angular.element($("#ErrorPayPwd")).html(t.msg),127319!==t.errorCode&&angular.element($("#resetPwdConfirm, .next-step")).attr("disabled","disabled"))})},e.checkUpddateStrength=function(){var t,r,s,n=e.updatePayPwd,a=0;if(e.updateExistNoSupWord=!1,null==n||""==n||void 0==n)t=r=s="#eeeeee",a=0;else{for(var l=0;l<n.length;l++){var i,P=n.charAt(l),u=/[!@#&()_+,.\/\\^]+/,w=/[0-9]+/,c=/[a-z]+/,g=/[A-Z]+/;if(w.test(P))i=1;else if(g.test(P))i=2;else if(c.test(P))i=4;else{if(!u.test(P))return e.updateExistNoSupWord=!0,void o();i=8}a|=i;var m=d(a)}0==m||n.length>18?(t=r=s="#eeeeee",e.passWordLevel="original"):n.length<6||m<=2?(t="#A7DFF4",r=s="#eeeeee",e.passWordLevel="low"):n.length>=6&&n.length<=9&&3==m||n.length>=6&&n.length<=7&&4==m?(t=s="#eeeeee",r="#6CC7E9",e.passWordLevel="normal"):n.length>=10&&n.length<=18&&3==m||n.length>=8&&n.length<=18&&4==m?(s="#3BAFDA",t=r="#eeeeee",e.passWordLevel="high"):(t=r=s="#eeeeee",e.passWordLevel="original")}document.getElementById("reset_strength_L").style.background=t,document.getElementById("reset_strength_M").style.background=r,document.getElementById("reset_strength_H").style.background=s},e.checkUpdatePwd=function(){e.showUpdatePwLow="low"==e.passWordLevel},e.checkResetVerify=function(){e.updatePayPwd!==e.updatePayPwdConfirm&&e.updatePayPwdConfirm?e.showUpdateDiffErr=!0:e.showUpdateDiffErr=!1},e.updatePaymentPwd=function(){if(e.checkResetVerify(),e.updatePayPwd||e.updatePwd.updatePayPwd.$setDirty(),e.updatePayPwdConfirm||e.updatePwd.updatePayPwdConfirm.$setDirty(),e.updatePwd.$valid&&"low"!=e.passWordLevel&&"original"!=e.passWordLevel&&!e.updateExistNoSupWord&&e.updatePayPwd==e.updatePayPwdConfirm){var t={urlParams:{newPassword:e.updatePayPwd,repeatPassword:e.updatePayPwdConfirm}};r.updatePaymentPwd(t,function(t){0===t.errorCode?(e.resetProgress=3,e.resetSuccessTxt="财务密码已重置成功！",e.resetSuccess=!0):127311===t.errorCode?window.location.reload():(e.resetProgress=3,e.resetSuccessTxt=t.msg,e.setPasswordSuccess="重置失败",e.resetSuccess=!1)})}},e.forgetPwd=function(){$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("paymentPwdManage","contact_admin"),type:"errer",manualClose:!1})}}])});