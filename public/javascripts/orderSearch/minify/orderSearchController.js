easySpa.require(["widget/slimscroll","widget/prompt","public/common/tableController.js","widget/select","widget/searchBox","public/common/calander.js"],function(){app.controller("orderSearchCtrl",["$scope","orderSearchService","orderSearchView","tableService",function(e,r,t,a){function o(e,r){for(var t in r)delete e[t]}function n(e){return e.forEach(function(e){e.name+="("+e.code+")"}),e}e.from=easySpa.queryUrlValByKey("from"),$.extend(e,{orderSearch:{},initCalander:function(){t.initCalander(e)},initTable:function(){t.initTable(e)},bindEvent:function(){t.bindEvent(e)}}),e.showDetail=function(e,r){window.location.href="#/confirmOrder?orderNum="+e+"&orderStatus="+r+"&from=orderSearch"},e.showFlowProcess=function(e,r){window.location.href="#/ordersStatus?orderNum="+e+"&orderStatus="+r+"&from=orderSearch"},e.search=function(){e.orderProduct||(e.orderProductUid=""),e.tableModel.restData.productUid=e.orderProductUid;var r=angular.copy(e.tableModel.restData);o(r,e.orderSearch),$.extend(r,e.orderSearch);var t={urlParams:r};a.getTable(e.tableModel.restURL,t,function(r){if(0===r.errorCode){e.tableModel=a.table(e.tableModel,t,r);var o=$(".g-orders").height()-314;setTimeout(function(){$(".table-container tbody").slimscroll({height:o}),$(window).resize(function(){o=$(".g-orders").height()-314,$(".table-container tbody").slimscroll({height:o})})},10)}})},e.initCalander(),e.initTable(),e.bindEvent(),"ordersStatus"!==e.from&&"orderDetail"!==e.from||e.search(),e.clearCondition=function(){e.tableModel.restData={pageIndex:1,pageSize:10,sort:"createTime",productUid:"",asc:!1};for(var r in e.orderSearch)e.orderSearch[r]=void 0;e.orderCustomerName="",e.orderProduct="",e.orderProductUid="",e.initCalander(),$("#select-orders-status").val(""),e.search()},e.getProduct=function(){e.contentList=r.getProductAllData({urlParams:{isHot:!0}}),e.navItem=r.getProductNavItem();new SearchBox.init({inputId:"select-product",searchData:[],defaultText:"请选择",tip:"请输入名称或编码",navItem:e.navItem.data,tabIndex:"热门",contentList:n(e.contentList.data),toggleTab:function(e,t){this.tabIndex=t;var a={urlParams:{isHot:!1,pageIndex:e||1,pageSize:10,capital:t}};"热门"==t&&(a.urlParams.isHot=!0,a.urlParams.capital=""),"其他"==t&&(a.urlParams.isHot=!1,a.urlParams.capital="_");var o=r.getProductAllData(a);return{data:n(o.data),pagination:o.pagination}},onSearchValueChange:function(e,t){var a={urlParams:{q:e,isHot:!1,pageIndex:t||1,pageSize:10,capital:""}},o=r.getProductAllData(a);return{data:n(o.data),pagination:o.pagination}},attrTextModel:function(r,t){e.orderProduct=r||"",e.orderProductUid=t.uid||"",e.$apply()}})},e.getProduct()}])});