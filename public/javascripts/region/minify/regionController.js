easySpa.require(["widget/slimscroll","widget/nestable","widget/prompt","widget/tab","public/common/tableController.js"],function(){app.controller("regionCtrl",["$scope","regionService","regionView","tableService",function(e,t,o,n){e.tableModel={tableHeader:[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("region","region_table_region_name"),Lang.getValByKey("region","region_table_region_code"),Lang.getValByKey("region","region_table_region_creator"),Lang.getValByKey("region","region_table_region_created_time"),Lang.getValByKey("region","region_table_region"),Lang.getValByKey("region","region_table_remark")],tableBody:[],restURL:"logistics.getRegionList",restData:{q:"",type:1,pageIndex:1,pageSize:10,sort:"createTime",asc:!1},selectNumber:0,selectFlag:!1},e.tableDeliveryModel={tableHeader:[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("region","region_table_region_name"),Lang.getValByKey("region","region_table_region_code"),Lang.getValByKey("region","region_table_region_creator"),Lang.getValByKey("region","region_table_region_created_time"),Lang.getValByKey("region","region_table_region"),Lang.getValByKey("region","region_table_remark")],tableBody:[],restURL:"logistics.getRegionList",restData:{q:"",type:1,pageIndex:1,pageSize:10,sort:"createTime",asc:!1},selectNumber:0,selectFlag:!1},e.$on("$viewContentLoaded",function(){e.loadListData(),e.type=1;var t=window.location.href.split("=")[1];t&&(1==t?(e.tab.selected(1),e.tableDeliveryModel.restData.type=2,e.tableModel.restData.q="",e.type=2,e.loadDeliveryListData(),window.resizeTable()):(e.tab.selected(0),e.tableModel.restData.type=1,e.tableDeliveryModel.restData.q="",e.type=1,e.loadListData(),window.resizeTable()))}),e.loadListData=function(){function t(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-300})}var o={urlParams:e.tableModel.restData};n.getTable(e.tableModel.restURL,o,function(t){0===t.errorCode&&(e.tableModel=n.table(e.tableModel,o,t))}),t(),$(window).on("resize",t)},e.loadDeliveryListData=function(){function t(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-300})}var o={urlParams:e.tableDeliveryModel.restData};n.getTable(e.tableDeliveryModel.restURL,o,function(t){0===t.errorCode&&(e.tableDeliveryModel=n.table(e.tableDeliveryModel,o,t))}),t(),$(window).on("resize",t)},e.swichEvent=function(t){$(".prompt-content").length&&($(".content").append($("#nest-chargingRegionDetail .prompt-content").hide()),$(document).promptBox("closeAllPrompt")),e.q="";var o=window.location.href;0==t&&(e.tableModel.restData.type=1,e.tableDeliveryModel.restData.q="",e.type=1,e.loadListData(),window.resizeTable(),e.$apply(),-1!=o.indexOf("=")?window.location.href=o.split("=")[0]+"=0":window.location.href=o.split("=")[0]+"?index=0"),1==t&&(e.tableDeliveryModel.restData.type=2,e.tableModel.restData.q="",e.type=2,e.loadDeliveryListData(),window.resizeTable(),e.$apply(),-1!=o.indexOf("=")?window.location.href=o.split("=")[0]+"=1":window.location.href=o.split("=")[0]+"?index=1")},e.getChargingRegionDetail=function(e,t,o){$(document).promptBox("closeAllPrompt"),window.location.href="#/regionDetail?schemaId="+e+"&name="+t+"&index=0&q=region"},e.getDeliveryRegionDetail=function(e,t,o){$(document).promptBox("closeAllPrompt"),window.location.href="#/regionDetail?schemaId="+e+"&name="+t+"&index=1&q=region"},e.addChargingRegion=function(){e.chargingRegionForm.$setPristine(),e.chargingRegionForm.$setUntouched(),e.validateCodeError=!1,e.isDetailCheck=!1,e.nameInfo="",e.codeInfo="",e.descriptionInfo="",$(document).promptBox({title:Lang.getValByKey("region","region_add_charging"),loadTitle:function(){return Lang.getValByKey("region","region_add_charging")},isMiddle:!0,isNest:!0,content:{nest:$("#chargingRegionDetail")},loadData:function(){$('#nest-chargingRegionDetail .other-btn button[name="prompt-operation"]').addClass("save").removeClass("edit")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_save"),operationEvent:function(){e.saveChargingRegion(),e.$apply()}}]})},e.saveChargingRegion=function(o){e.nameInfo||e.chargingRegionForm.nameInfo.$setDirty(),e.codeInfo||e.chargingRegionForm.codeInfo.$setDirty(),o=void 0==o?e.chargingRegionId:o;var n;n=$('#nest-chargingRegionDetail button[name="prompt-operation"]').hasClass("save")?{urlParams:{type:1,name:e.nameInfo,code:e.codeInfo,description:e.descriptionInfo}}:{seatParams:{id:o},urlParams:{type:1,name:e.nameInfo,code:e.codeInfo,description:e.descriptionInfo}},1==e.validateCodeError&&(e.chargingRegionForm.$valid=!1),e.chargingRegionForm.$valid&&($('#nest-chargingRegionDetail button[name="prompt-operation"]').hasClass("save")?t.addChargingRegion(n,function(t){0==t.errorCode?(1==e.isHref?($(document).promptBox("closeAllPrompt"),window.location.href="#/regionDetail?schemaId="+t.data+"&name="+e.nameInfo+"&index=0&q=region"):($(".content").append($("#nest-chargingRegionDetail .prompt-content").hide()),$(document).promptBox("closeAllPrompt"),e.tableModel.restData.type=1,e.loadListData()),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})}):t.editChargingRegion(n,function(t){0==t.errorCode?($(".content").append($("#nest-chargingRegionDetail .prompt-content").hide()),$(document).promptBox("closeAllPrompt"),e.tableModel.restData.type=1,e.loadListData(),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})}))},e.editChargingRegionDetail=function(o){e.validateCodeError=!1,e.chargingRegionId=o,e.isDetailCheck=!0,e.chargingRegionForm.$setPristine(),e.chargingRegionForm.$setUntouched();var n={seatParams:{id:o}};$(document).promptBox({title:Lang.getValByKey("region","region_detail_charging"),loadTitle:function(){return Lang.getValByKey("region","region_detail_charging")},isMiddle:!0,isNest:!0,content:{nest:$("#chargingRegionDetail")},loadData:function(){$('#nest-chargingRegionDetail .other-btn button[name="prompt-operation"]').addClass("edit").removeClass("save"),t.getChargingRegionDetail(n,function(t){if(0==t.errorCode){var o=t.data;e.isDetailCheck=!0,e.nameInfo=o.name,e.codeInfo=o.code,e.createName=o.creator+" "+o.creatorCode,e.createTime=o.createTime,e.descriptionInfo=o.description}})},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_save"),operationEvent:function(){e.saveChargingRegion(e.chargingRegionId),e.$apply()}}]})},e.validateCode=function(){if(e.codeInfo){var o;$('#nest-chargingRegionDetail button[name="prompt-operation"]').hasClass("save")?o="":(console.log(e.type),o=1==e.type?e.chargingRegionId:e.deliveryRegionId);var n={urlParams:{code:e.codeInfo,id:o}};t.validateChargingCode(n,function(t){0==t.errorCode?(e.validateCodeError=!1,angular.element(".validate-codes").removeClass("ng-invalid")):(e.validateCodeError=!0,angular.element(".validate-codes").addClass("ng-invalid"))})}},e.removeValidateCode=function(){e.validateCodeError=!1},e.deleteChargingRegion=function(){var t=n.getSelectTable(e.tableModel.tableBody);t.length?$(document).promptBox({title:Lang.getValByKey("region","region_delete_charging"),type:"warning",content:{tip:Lang.getValByKey("region","region_delete_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){e.submitDeleteRegions(t)}}]}):$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("region","region_select_charging_regions"),type:"errer",manualClose:!0})},e.submitDeleteRegions=function(o){var n=[];for(var a in o)n.push(o[a].id);var i={seatParams:{sid:e.chargingRegionId},urlParams:n};t.deleteChargingRegion(i,function(t){0==t.errorCode?($(document).promptBox("closePrompt"),e.tableModel.restData.type=1,e.loadListData(),e.$apply(),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})):($(document).promptBox("closePrompt"),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0}))}),e.$apply()},e.retrievalChargingRegion=function(){e.tableModel.restData.type=1,e.q=e.tableModel.restData.q,e.tableModel.restData.pageIndex=1,e.loadListData()},e.addDeliveryRegion=function(){e.chargingRegionForm.$setPristine(),e.chargingRegionForm.$setUntouched(),e.validateCodeError=!1,e.isDetailCheck=!1,e.nameInfo="",e.codeInfo="",e.descriptionInfo="",$(document).promptBox({title:Lang.getValByKey("region","region_add_delivery"),loadTitle:function(){return Lang.getValByKey("region","region_add_delivery")},isMiddle:!0,isNest:!0,content:{nest:$("#chargingRegionDetail")},loadData:function(){$('#nest-chargingRegionDetail .other-btn button[name="prompt-operation"]').addClass("save").removeClass("edit")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_save"),operationEvent:function(){e.saveDeliveryRegion(),e.$apply()}}]})},e.saveDeliveryRegion=function(o){e.nameInfo||e.chargingRegionForm.nameInfo.$setDirty(),e.codeInfo||e.chargingRegionForm.codeInfo.$setDirty(),o=void 0==o?e.deliveryRegionId:o;var n;n=$('#nest-chargingRegionDetail button[name="prompt-operation"]').hasClass("save")?{urlParams:{type:2,name:e.nameInfo,code:e.codeInfo,description:e.descriptionInfo}}:{seatParams:{id:o||e.deliveryRegionId},urlParams:{type:2,name:e.nameInfo,code:e.codeInfo,description:e.descriptionInfo}},1==e.validateCodeError&&(e.chargingRegionForm.$valid=!1),e.chargingRegionForm.$valid&&($('#nest-chargingRegionDetail button[name="prompt-operation"]').hasClass("save")?t.addChargingRegion(n,function(t){0==t.errorCode?(1==e.isHref?($(document).promptBox("closeAllPrompt"),window.location.href="#/regionDetail?schemaId="+t.data+"&name="+e.nameInfo+"&index=1&q=region"):($(".content").append($("#nest-chargingRegionDetail .prompt-content").hide()),$(document).promptBox("closeAllPrompt"),e.tableDeliveryModel.restData.type=2,e.loadDeliveryListData()),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})}):t.editChargingRegion(n,function(t){0==t.errorCode?($(".content").append($("#nest-chargingRegionDetail .prompt-content").hide()),$(document).promptBox("closeAllPrompt"),e.tableDeliveryModel.restData.type=2,e.loadDeliveryListData(),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})}))},e.editDeliveryRegionDetail=function(o){e.validateCodeError=!1,e.deliveryRegionId=o,e.isDetailCheck=!0,e.chargingRegionForm.$setPristine(),e.chargingRegionForm.$setUntouched();var n={seatParams:{id:o}};$(document).promptBox({title:Lang.getValByKey("region","region_detail_delivery"),loadTitle:function(){return Lang.getValByKey("region","region_detail_delivery")},isMiddle:!0,isNest:!0,content:{nest:$("#chargingRegionDetail")},loadData:function(){$('#nest-chargingRegionDetail .other-btn button[name="prompt-operation"]').addClass("edit").removeClass("save"),t.getChargingRegionDetail(n,function(t){if(0==t.errorCode){var o=t.data;e.isDetailCheck=!0,e.nameInfo=o.name,e.codeInfo=o.code,e.createName=o.creator+" "+o.creatorCode,e.createTime=o.createTime,e.descriptionInfo=o.description}})},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_save"),operationEvent:function(){e.saveDeliveryRegion(e.deliveryRegionId),e.$apply()}}]})},e.deleteDeliveryRegion=function(){var t=n.getSelectTable(e.tableDeliveryModel.tableBody);t.length?$(document).promptBox({title:Lang.getValByKey("region","region_delete_delivery"),type:"warning",content:{tip:Lang.getValByKey("region","region_delete_tip")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){e.submitDeleteDeliveryRegions(t)}}]}):($(document).promptBox("closePrompt"),$(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("region","region_select_delivery_regions"),type:"errer",manualClose:!0}))},e.submitDeleteDeliveryRegions=function(o){var n=[];for(var a in o)n.push(o[a].id);var i={seatParams:{sid:e.chargingRegionId},urlParams:n};t.deleteChargingRegion(i,function(t){0==t.errorCode?($(document).promptBox("closePrompt"),e.tableDeliveryModel.restData.type=2,e.loadDeliveryListData(),e.$apply(),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})):($(document).promptBox("closePrompt"),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0}))}),e.$apply()},e.retrievalDeliveryRegion=function(){e.tableDeliveryModel.restData.type=2,e.q=e.tableDeliveryModel.restData.q,e.tableDeliveryModel.restData.pageIndex=1,e.loadDeliveryListData()},e.isHrefDetail=function(){e.isHref=!e.isHref},e.tab=o.tab("#m-tab",e.swichEvent)}])});