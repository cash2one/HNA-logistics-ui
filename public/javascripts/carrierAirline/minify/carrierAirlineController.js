easySpa.require(["widget/slimscroll","widget/nestable","widget/prompt","widget/tab","public/common/tableController.js","widget/tab","widget/select"],function(){app.controller("carrierAirlineCtrl",["$scope","carrierAirlineService","carrierAirlineView","tableService",function(e,t,a,r){function o(){var t={};t=e.getCountryData(),d(t.data),selectFactory({data:t,id:"countrySearch",isSearch:!0,pagination:!0,searchPlaceHoder:"请输入国家名称或二字码",onSearchValueChange:function(t,a,r){var o=e.getCountryData(a,r);d(o.data),t.setData(o)},attrTextModel:function(t,a,r){e.countrySearchId=r.figureCode,e.countrySearch=t,e.$apply()}})}function n(){function t(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-270})}var a={urlParams:e.tableModel.restData};r.getTable(e.tableModel.restURL,a,function(t){0===t.errorCode&&(e.tableModel=r.table(e.tableModel,a,t))}),t(),$(window).on("resize",t)}function i(e){var t=e.next;if(null!=t)return t.clearData(),t.id=null,i(t)}function l(e,t){for(var t=t.data,a=0;a<t.length;a++)if(t[a].name==e)return t[a]}function d(e){if(e)for(var t=0;t<e.length;t++)e[t].name=e[t].name+"("+e[t].code+")"}function c(a){for(var r=[],o=0,i=a.length;o<i;o++)r.push(a[o].id);var l={urlParams:r};t.deleteCompanyById(l,function(e){0==e.errorCode?($(document).promptBox("closePrompt"),n(),$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})}),e.$apply()}e.tableModel={more:!1,userWord:"",tableHeader:[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("carrierAirline","company_table_name"),Lang.getValByKey("carrierAirline","company_table_country"),Lang.getValByKey("carrierAirline","company_table_triadCode"),Lang.getValByKey("carrierAirline","company_table_tetradCode"),Lang.getValByKey("carrierAirline","company_table_remark")],tableBody:[],restURL:"logistics.getCompanys",restData:{q:"",locked:-1,pageIndex:1,pageSize:10,sort:"figureCode",asc:!0,countryId:void 0},seatData:{uid:""},selectNumber:0,selectFlag:!1},e.getLanguage=function(){t.getLanguage(function(t){0===t.errorCode&&(e.language=t.data)})},e.getLanguage(),e.$on("$viewContentLoaded",function(){n(),o()}),e.clearData=function(){e.tableModel.restData.q="",e.q="",e.tableModel.restData.countryId=void 0,e.countrySearchId="",e.countrySearch="",n()};var s=$("#nest-AirportFrom .label-text");!function(){barClick(s)}(),e.addAirport=function(){$(".select-list-box").empty(),e.textNumber=140,$("#nest-AirportFrom").css("display","table"),e.title=Lang.getValByKey("carrierAirline","company_prompt_new"),e.nestAirportFrom=!0,e.isEditCity=!0,e.showTriadCode=!1,e.airportName="",e.countryName="",e.countryId="",e.triadCode="",e.tetradCode="",e.remark="";var t=$(".language-international input");t.each(function(e){t.eq(e).val("")}),loadBar(s),$('button[name="prompt-save"]').addClass("save").removeClass("edit")},e.closePrompt=function(){e.nestAirportFrom=!1,e.AirportFrom.$setPristine(),e.AirportFrom.$setUntouched()},e.getCountryData=function(e,a){a||(a=1),e=e||"";var r={urlParams:{q:e,pageIndex:a,pageSize:10}};return t.getCountry(r)},e.initSelectList=function(){var t,a;t=e.getCountryData(),d(t.data),a=selectFactory({data:t,id:"country",isSearch:!0,pagination:!0,searchPlaceHoder:"请输入国家名称或二字码",defaultText:Lang.getValByKey("common","common_select_tips"),onSearchValueChange:function(t,a,r){var o=e.getCountryData(a,r);d(o.data),t.setData(o)},attrTextModel:function(t,r){var o;o=t?l(t,r):{},e.countryId=o.figureCode,e.countryName=o.name,e.$apply(),i(a)}})},e.savePrompt=function(){e.airportName||e.AirportFrom.airportName.$setDirty(),e.countryName||e.AirportFrom.countryName.$setDirty(),e.triadCode||e.AirportFrom.triadCode.$setDirty(),e.tetradCode||e.AirportFrom.tetradCode.$setDirty();var a=$(".language-international input"),o=[],i=[];a.each(function(e){i[e]={},i[e].language=a.eq(e).data("code"),i[e].localName=a.eq(e).val(),i[e].refId=a.eq(e).data("id"),o.push(i[e])});var l="";if(void 0!==e.triadCode)for(var d=0;d<e.triadCode.length;d++)l+=e.triadCode[d].toLocaleUpperCase();var c="";if(void 0!==e.tetradCode)for(var d=0;d<e.tetradCode.length;d++)c+=e.tetradCode[d].toLocaleUpperCase();var m={urlParams:{name:e.airportName,countryId:e.countryId,figureCode:l.toUpperCase(),triadCode:c.toUpperCase(),description:e.remark,i18n:o}};if(showErrorModel(s),1==e.showTriadCode&&(e.AirportFrom.$valid=!1),!e.AirportFrom.$valid)return void scrollToErrorView($(".switch-list"));$('button[name="prompt-save"]').hasClass("save")?t.saveCompany(m,function(a){if(0==a.errorCode){var o=[],n={seatParams:{id:a.data}};t.getCompanyById(n,function(e){if(0==e.errorCode){var t=e.data;o.push(t)}});var i={urlParams:e.tableModel.restData};r.getTable(e.tableModel.restURL,i,function(t){0===t.errorCode&&(e.tableModel=r.table(e.tableModel,i,t))}),e.nestAirportFrom=!1,e.AirportFrom.$setPristine(),e.AirportFrom.$setUntouched(),$(document).promptBox({isDelay:!0,contentDelay:a.msg,type:"success"})}else $(document).promptBox({isDelay:!0,contentDelay:a.msg,type:"errer",manualClose:!0})}):(m=$.extend({},{seatParams:{id:e.clickTrId}},m),t.editCompany(m,function(t){0==t.errorCode?(n(),e.nestAirportFrom=!1,e.AirportFrom.$setPristine(),e.AirportFrom.$setUntouched(),$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:t.msg,type:"errer",manualClose:!0})}))},e.editAirportInfo=function(a){$(".select-list-box").empty(),$("#nest-AirportFrom").css("display","table"),loadBar(s),e.title=Lang.getValByKey("carrierAirline","company_prompt_edit"),e.nestAirportFrom=!0,e.showTriadCode=!1;var r="SPAN"==$(a.target)[0].nodeName?$(a.target).parent():$(a.target);e.clickTrId=r.parent().parent().data("id");var o={seatParams:{id:e.clickTrId}};t.getCompanyById(o,function(t){if(0==t.errorCode){var a=t.data;e.airportName=a.name,e.countryId=a.countryId,null==a.countryName?$('input[name="countryName"]').val(""):e.countryName=a.countryName+"("+a.countryId+")",e.triadCode=a.figureCode,e.tetradCode=a.triadCode,e.remark=a.description,e.AirportFrom.$valid=!0;var r=$(".language-international input");r.each(function(e){for(var t=0,o=a.i18n.length;t<o;t++)r.eq(e).data("code")==a.i18n[t].language&&(r.eq(e).data("id",a.i18n[t].refId),r.eq(e).data("code",a.i18n[t].language),r.eq(e).val($.trim(a.i18n[t].localName)))}),e.textNumber=140-e.remark.length}}),$('button[name="prompt-save"]').removeClass("save").addClass("edit")},e.deleteAirport=function(){if(0!=e.tableModel.selectNumber&&0!=$(".user-table tbody tr").length){var t=r.getSelectTable(e.tableModel.tableBody);$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("carrierAirline","company_prompt_delete")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){c(t)}}]})}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("carrierAirline","company_prompt_delay_tip"),type:"errer",manualClose:!0})},e.retrievalAirport=function(){e.q=e.tableModel.restData.q,e.tableModel.restData.pageIndex=1,e.tableModel.restData.countryId=e.countrySearchId,n()},e.internationalization=function(){window.location.href="#/international?q=carrierAirline"},e.validateTriadCode=function(){if(e.triadCode){if($('button[name="prompt-save"]').hasClass("save"))var a={urlParams:{figureCode:e.triadCode}};else var a={urlParams:{figureCode:e.triadCode,id:e.clickTrId}};t.validateCompanyFigureCode(a,function(t){0==t.errorCode?e.showTriadCode=!1:(e.showTriadCode=!0,angular.element($(".validate-triad-code").addClass("ng-invalid")))})}},e.removeValidateTriadCode=function(){e.showTriadCode=!1},e.textNumber=140,e.showTextNumber=function(){e.textNumber=140-e.remark.length},e.valueTolocaleUpperCase=function(e,t){var a=$.trim($(e.target).val());a.length>t&&($(e.target).val(a.substr(0,t)),a=a.substr(0,t)),$(e.target).val($.trim(a.toLocaleUpperCase()))}}])});