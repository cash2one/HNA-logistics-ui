easySpa.require(["widget/slimscroll","widget/prompt","widget/parseUrl","public/javascripts/billCreation/20161224/taskList.js","public/javascripts/billCreation/20161224/billList.js","public/javascripts/billCreation/20161224/dateTime.js","public/common/calander.js"],function(){function e(e,t,a,l){var o=location.hash.indexOf("from=billCreation");e.parameter=window.parseUrl.getParams(),e.module=e.parameter.module?e.parameter.module:"logistics",e.submodule=e.parameter.submodule,e.interType="trade"==e.module?"trd":"","trade"==e.module&&(e.subInterType=e.submodule),"logistics"==e.module&&(e.subInterType="pay"==e.submodule?"1":"2"),e.userType="trade"==e.module?2:1,o=-1===o?"taskList":"billList",t.bill=$("#bill"),e.switchTab=function(a,o){t.nowScope&&(t.nowScope.unwatcher.forEach(function(e){e()}),t.nowScope.$destroy()),e.cname=o,t.getTpl(o).then(function(a){t.bill.html(l(a)(e.$new()))}),e.platform="",e.customerName="","taskList"==o?(e.platformValue=[],e.customerValue=[]):(e.platformValue="",e.customerValue="")},e.count=0,e.lang=Lang.dataPool.billCreation,e.switchTab(null,o),e.clear=function(){e.platform=e.platformValue="",e.customerIds=e.customerName=e.customerValue="",$(".customerName").val("")};var r;"billList"==e.cname?e.platformValue="":e.platformValue=[],e.getPlatform=function(){Select.sharePool["select-platform"]=null,e.platformData=t.getPlatformData();var a={data:e.platformData,defaultText:"全部",id:"select-platform",multipleSign:",",showTextField:"name",attrTextField:{"ng-value":"id"},attrTextModel:function(t){e.platform=t,e.$apply()}};"billList"==e.cname?a.attrTextId=function(t){e.platformValue=t?e.platformValue?e.platformValue+","+t:t:"",e.$apply()}:a.attrTextId=function(t){t?e.platformValue.push(t):e.platformValue=[],e.$apply()},r=selectFactory(a),r.open(),$("#select-platform").val(e.platform)},e.$watch("platformValue",function(t,a){t!==a&&("billList"==e.cname?t||(e.platformValue=""):t.length||(e.platformValue=[]))},!0),"billList"==e.cname?e.customerValue="":e.customerValue=[],e.getSupplierListData=function(a,l){a=a||"";var o={urlParams:{q:a,pageIndex:l,pageSize:10},seatParams:{intertype:e.module}},r=t.getSupplierList(o);return angular.forEach(r.data,function(e,t){e.name+="("+e.code+")"}),r},e.getSupplier=function(){Select.sharePool["select-supplier"]=null;var t={data:[],isSearch:!0,isUsePinyin:!0,multipleSign:",",searchPlaceHoder:"请输入供应商名称或编码",defaultText:Lang.getValByKey("common","common_select_tips"),id:"select-supplier",showTextField:"name",pagination:!0,attrTextField:{"ng-value":"id"},closeLocalSearch:!0,onSearchValueChange:function(t,a,l){e.supplierData=e.getSupplierListData(a,l),t.setData(e.supplierData),e.$apply()},attrTextId:function(t){e.customerValue=e.customerValue?e.customerValue+","+t:t,e.$apply()},attrTextModel:function(t){e.customerName=t,e.$apply()}};"billList"==e.cname?t.attrTextId=function(t){e.customerValue=t?e.customerValue?e.customerValue+","+t:t:"",e.$apply()}:t.attrTextId=function(t){t?e.customerValue.push(t):e.customerValue=[],e.$apply()},selectFactory(t).open()},e.$watch("customerName",function(t,a){t!==a&&("billList"==e.cname?t||(e.customerValue=""):t.length||(e.customerValue=[]))},!0)}app.controller("billCreationCtrl",["$scope","billCreationService","billCreationView","$compile",e])});