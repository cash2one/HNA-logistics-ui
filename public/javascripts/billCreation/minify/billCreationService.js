app.factory("billCreationService",["$http","$templateCache","$timeout","easyHttp",function(t,e,n,i){function r(){return"?a="+Math.random()}function a(t){return t<10&&(t="0"+t),t}var o={};o.getTpl=function(n){return t.get("/tpl/fragment/billCreation/"+n+".html"+r()).then(function(t){if(t.data)return e.put(n+".html",t.data),t.data})},o.getTaskStatus=function(t,e){return i.get("logistics.getTaskStatus",t,e)},o.billingStatus=function(t,e){return i.get("logistics.getBillingStatus",t,e)},o.getCurrentUserVisibleUserList=function(t,e){return e||(e={urlParams:""}),i.get("logistics.getPrimaryaccountlist",e,t)},o.generateBills=function(t,e){return i.post("logistics.generateBills",t,e)},o.deleteTask=function(t,e){return i.post("logistics.deleteTask",t,e)},o.repeatGenerateBills=function(t,e){return i.post("logistics.repeatGenerateBills",t,e)},o.getAllBillList=function(t){return i.get("logistics.getAllBillList",t)},o.getBillTaskDetail=function(t,e){return i.get("logistics.getBillTaskDetail",t,e)},o.deleteBillByNumber=function(t,e){return i.post("logistics.deleteBillByNumber",t,e)},o.submitBillInBilllist=function(t,e){return i.post("logistics.submitBillInBilllist",t,e)},o.getPlatformData=function(t){return i.get("logistics.getEnterpriseNameTradePlatform",t)},o.getSupplierList=function(t){return i.get("logistics.retrievalSupplierList",t)},o.setScroll=function(t,e){var i=this.bill.find(".bills"),r=i.offset().top,a=i.height();n(function(){$(t).slimScroll({height:a-$(t).offset().top+r-60+"px"}),e.showTable=!0},100)},o.createSelect=function(t,e,n,i,r){var a={data:e,id:t,offset:-300,attrTextModel:n};if(i?(a.isSearch=!0,a.multipleSign=",",a.defaultText="请选择",a.isSaveInputVal=!0,a.isUsePinyin=!0,a.closeLocalSearch=!0):a.defaultText="全部",r&&(a.onSearchValueChange=r),o[t])return o[t].setData(e),void o[t].open();r?(a.pagination=!0,a.searchPlaceHoder=Lang.getValByKey("common","common_select_search_account_tips"),o[t]=selectFactory(a)):selectFactory(a)};var l=$(document);return o.promptBox=function(t){var e={isDelay:!0,contentDelay:t.msg,time:3e3};0==t.errorCode?e.type="success":(e.manualClose=!0,e.type="errer"),l.promptBox(e),!e.time||l.promptBox("closePrompt")},o.checkData=function(t){if(0===t.length)return this.promptBox({msg:"请先选择数据！"}),!0},o.promptMidBox=function(t,e,n,i){l.promptBox({title:t||"提示信息",type:"success",width:"400px",content:{tip:e.msg},operation:[{type:"submit",description:n||Lang.getValByKey("common","common_pagination_confirm"),operationEvent:function(){return i(),$(document).promptBox("closePrompt"),!1}}]})},o.getSearchData=function(t){var e={};for(var n in t.search)t.search[n]&&(e[n]=t.search[n]);return e},o.clearSearch=function(t){var e=t.search,n=t.tableModel.restData;for(var i in e)n[i]&&delete n[i],delete e[i];delete t.taskStatusName},o.getDate=function(){var t=new Date;return[t.getFullYear(),t.getMonth()+1,t.getDate()].map(function(t){return a(t)}).join("-")+" "+[t.getHours(),t.getMinutes(),t.getSeconds()].map(function(t){return a(t)}).join(":")},o.getLastMonth=function(){var t,e,n=o.getDate().split(" ")[0].split("-");return 1==n[1]?(n[0]=n[0]-1,n[1]=12):n[1]=n[1]-1,n[2]=1,n[1]=a(n[1]),n[2]=a(n[2]),t=n.join("-"),n[2]=new Date(n[0],n[1],0).getDate(),e=n.join("-"),{start:t+[" 00","00","00"].join(":"),end:e+[" 23","59","59"].join(":")}},o.initTaskListTime=function(){function t(t,e){return(""+t).length<e?(new Array(e+1).join("0")+t).slice(-e):""+t}var e=new Date,n=new Date(e-5184e5);return{start:n.getFullYear()+"-"+t(n.getMonth()+1,2)+"-"+t(n.getDate(),2)+" 00:00:00",end:new Date(new Date(e.toLocaleDateString()).getTime()+864e5-1).format("yyyy-MM-dd hh:mm:ss")}},o.getPayWayData=function(t){return i.get("logistics.getAccountTable",t)},o}]);