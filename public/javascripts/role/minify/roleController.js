easySpa.require(["widget/slimscroll","widget/prompt","widget/nestable","widget/htree","widget/tab","widget/select","public/common/tableController.js"],function(){app.controller("roleCtrl",["$scope","roleService","roleView","tableService",function(e,o,l,r){function t(o){2==o&&e.roleModel.getRoleUser()}function a(o){0==o?e.roleModel.candidateData=e.roleModel.orgCandidateData:1==o?e.roleModel.candidateData=e.roleModel.groupCandidateData:2==o&&(e.roleModel.candidateData=e.roleModel.userCandidateData),e.roleModel.searchCandidate="",e.roleModel.candidateFlag=!1;for(var l=e.roleModel.candidateData,r=l.length?l.length:0,t=0;t<r;t++)l[t].checkbox=e.roleModel.candidateFlag;e.roleModel.candidateData=l,e.roleModel.deleteCandidate(),e.$apply()}function d(o){var l="";return angular.forEach(e.roleModel.seniorTypeData,function(e){e.id==o&&(l=e.name)}),l}e.roleModel={q:"",pageIndex:1,pageSize:1e4,id:0,name:"",newRole:!1,domainId:1,candidateFlag:!0,candidateData:[],selectedFlag:!1,selectedData:[],userSeniorFlag:!1,senior:Lang.getValByKey("common","common_page_advancedFilter"),ordinary:Lang.getValByKey("common","common_page_ordinaryFilter"),seniorTypeData:[{id:"0",name:"全部"},{id:"2",name:"组织"},{id:"3",name:"用户组"},{id:"1",name:"用户"}],seniorText:Lang.getValByKey("common","common_page_advancedFilter"),seniorFlag:!1,htree:{},resourceFlag:!1,searchCandidate:"",searchSelected:"",orgCandidateData:[],groupCandidateData:[],userCandidateData:[],system:[{domainId:1,name:Lang.getValByKey("role","role_code_operationSys")},{domainId:2,name:Lang.getValByKey("role","role_code_supplierSys")},{domainId:3,name:Lang.getValByKey("role","role_code_clientSys")}],domainId:1,domainName:Lang.getValByKey("role","role_code_operationSys"),tableRole:{tableHeader:[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("common","common_thead_type"),Lang.getValByKey("common","common_thead_name"),Lang.getValByKey("common","common_thead_code"),Lang.getValByKey("common","common_thead_department"),Lang.getValByKey("common","common_thead_role")],tableBody:[],restURL:"logistics.getRoleUser",restData:{q:"",roleType:0,roleId:0,pageIndex:1,pageSize:10},selectNumber:0,selectFlag:!1}},e.roleModel.tabOne=l.tab("#m-tab",t),e.roleModel.tabTwo=l.tab("#m-tab-propmt",a),e.initSelect=function(){var o={data:e.roleModel.system};selectFactory({data:o,defaultText:"",id:"select-sys-input",showTextField:"name",attrTextField:{"ng-value":"domainId"},attrTextId:function(o){e.roleModel.domainId!=o&&e.roleModel.change(o),e.roleModel.domainId=o,e.$apply()},attrTextModel:function(o){e.roleModel.domainName=o,e.$apply()}})},e.initSelect(),e.roleModel.getRoleList=function(o,l,r,t){e.roleModel.roleName=e.roleModel.roleCode=e.roleModel.description="",e.roleModel.isEdit=!1,e.roleModel.tabOne.exdisable(0),$("#editRole").hide(),$("#wrap-tree").html("").html('<div id="tree" class="m-tree-layer"></div>'),$("#tree").nestable({isRoot:!1,name:"name",orgShortName:"name",id:"id",parameter:"?q="+o+"&pageIndex="+l+"&pageSize="+r+"&domainId="+t,isTree:!1,isSearch:!1,searchInput:void 0,treeScrollHeight:$("#wrap-tree"),childUrl:Interface.getUrlById("logistics.getRoleList"),clickNode:function(o){e.$apply(e.roleModel.roleListClick(o))},loadFirstNode:function(o){1==e.roleModel.domainId&&e.roleModel.tabOne.enableAll(),$("#editRole").show(),e.$apply(e.roleModel.roleListClick(o))},deleteNodes:function(o){e.$apply(e.roleModel.delRole(o))}}).on("change",function(){var o=0==$(".moving").prev().length?0:$(".moving").prev().data("uid"),l=$(".moving").data("uid");l&&e.roleModel.order(l,o)})},e.roleModel.getRoleList(e.roleModel.q,e.roleModel.pageIndex,e.roleModel.pageSize,e.roleModel.domainId),e.roleModel.change=function(o){e.roleModel.domainId=o,e.roleModel.q="",e.roleModel.getRoleList(e.roleModel.q,e.roleModel.pageIndex,e.roleModel.pageSize,o)},e.roleModel.order=function(r,t){var a={targetpreid:t,domainId:e.roleModel.domainId};o.orderRole(r,a,function(e){0===e.errorCode?l.promptBox({isDelay:!0,contentDelay:e.msg,type:"success"}):l.promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})},e.roleModel.search=function(){e.roleModel.getRoleList(e.roleModel.q,e.roleModel.pageIndex,e.roleModel.pageSize,e.roleModel.domainId)},e.roleModel.roleListClick=function(o){e.roleModel.id=o,e.q=e.roleModel.tableRole.restData.q="",e.roleModel.tableRole.restData.pageIndex=1,e.typeValue=e.roleModel.tableRole.restData.roleType=0,e.roleModel.userSeniorFlag=!1,e.types=d(e.typeValue),e.roleModel.isEdit=!1,e.roleModel.resourceFlag=!1,e.roleModel.newRole=!1,$(".seat-node").length&&$(".seat-node").remove(),(1==e.roleModel.domainId&&5!==o||6!==o)&&e.roleModel.tabOne.enableAll(),5===o||6===o?(e.isSystemEdit=!1,e.roleModel.tabOne.disable(1),e.roleModel.tabOne.selected(0)):e.isSystemEdit=!0,e.roleModel.getRoleDetail(o),e.roleModel.getResources(o),e.roleModel.resourceFlag=e.roleModel.seniorFlag=!1,e.roleModel.getRoleUser(o)},e.roleModel.getRoleDetail=function(l){o.getRoleDetail(l,function(o){0===o.errorCode&&(e.roleModel.name=o.data.name,e.roleModel.roleName=e.roleModel.roleInputName=o.data.name,e.roleModel.roleCode=e.roleModel.roleInputCode=o.data.code,e.roleModel.description=e.roleModel.roleInputdescription=o.data.description)})},e.roleModel.addRole=function(){e.roleModel.form.roleInputCode.errorTips="",e.roleModel.tabOne.exdisable(0),$(".remote-invalid").removeClass("remote-invalid"),e.roleModel.form.$setPristine(),e.roleModel.form.$setUntouched(),e.roleModel.newRole=!0,e.roleModel.isEdit=!0,e.roleModel.roleInputName="",e.roleModel.roleInputCode="",e.roleModel.roleInputdescription="",e.textareaNumber=140,$(".seat-node").length&&$(".seat-node").remove(),$("#tree .dd3-content").removeClass("active"),$("#tree").children("ol").prepend('<li class="seat-node new-nodes dd-item dd3-item"><div class="dd3-content active">'+Lang.getValByKey("role","role_code_addRole")+"</div></li>"),o.getRoleCode(e.roleModel.domainId,function(o){0===o.errorCode&&""==e.roleModel.roleInputCode&&(e.roleModel.roleInputCode=o.data.code)})},e.roleModel.editRole=function(){e.roleModel.isEdit=!0,e.roleModel.form.roleInputName.errorTips="",e.roleModel.form.roleInputCode.errorTips="",$(".remote-invalid").removeClass("remote-invalid"),e.roleModel.roleInputName=e.roleModel.roleName,e.roleModel.roleInputCode=e.roleModel.roleCode,e.roleModel.roleInputdescription=e.roleModel.description,e.textareaNumber=140-(e.roleModel.roleInputdescription?e.roleModel.roleInputdescription.length:0)},e.showTextNumber=function(){e.textareaNumber=140-e.roleModel.roleInputdescription.length},e.roleModel.cancelRole=function(o){if($(".seat-node").length){$(".seat-node").remove();var l=e.roleModel.id;$("#tree").children("ol").children("li").each(function(){$(this).attr("data-uid")==l&&$(this).children(".dd3-content").addClass("active")})}e.roleModel.isEdit=e.roleModel.newRole=!1,$("#tree").children("ol").children("li").length&&1==e.roleModel.domainId&&e.roleModel.tabOne.enableAll(),void 0==o||e.$apply()},e.roleModel.saveRole=function(){if(e.roleModel.roleInputName||e.roleModel.form.roleInputName.$setDirty(),e.roleModel.roleInputCode||e.roleModel.form.roleInputCode.$setDirty(),!$("#name-msg").hasClass("remote-invalid")&&!$("#code-msg").hasClass("remote-invalid")&&e.roleModel.form.$valid){var r=e.roleModel.id;e.roleModel.roleInputdescription=$.trim(e.roleModel.roleInputdescription);var t={name:e.roleModel.roleInputName,code:e.roleModel.roleInputCode,description:e.roleModel.roleInputdescription,domainId:e.roleModel.domainId};e.roleModel.newRole?o.saveAddRole(t,function(o){0===o.errorCode?(e.roleModel.isEdit=e.roleModel.newRole=!1,e.roleModel.getRoleList(e.roleModel.q,e.roleModel.pageIndex,e.roleModel.pageSize,e.roleModel.domainId),l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"})):l.promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})}):o.saveEditRole(r,t,function(o){0===o.errorCode?(e.roleModel.isEdit=!1,e.roleModel.roleName=t.name,e.roleModel.roleCode=t.code,e.roleModel.description=t.description,$("#tree .active").attr({"data-name":t.name,"data-orgname":t.name}).html(t.name),l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"})):l.promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})}},e.roleModel.delRole=function(r){e.roleModel.roleListClick(r);var t=$("#tree").find('li[data-uid="'+r+'"]').children("div").attr("data-name");e.roleModel.isEdit=e.roleModel.newRole=!1,1==e.roleModel.domainId&&e.roleModel.tabOne.enableAll();var a={title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("common","common_page_delete")+"“"+t+"”"+Lang.getValByKey("role","role_code_delRole")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){o.deleteRole(r,function(o){0===o.errorCode?(l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"}),l.promptBox("closePrompt"),e.roleModel.getRoleList(e.roleModel.q,e.roleModel.pageIndex,e.roleModel.pageSize,e.roleModel.domainId),e.$apply()):l.promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})}}]};l.promptBox(a)},e.checkName=function(){var l=1==e.roleModel.newRole?"":e.roleModel.id,r={urlParams:{name:e.roleModel.roleInputName,domainId:e.roleModel.domainId,id:l}};e.roleModel.roleInputName&&o.checkName(r,function(o){0!=o.errorCode?(e.roleModel.form.roleInputName.errorTips=o.msg,$("#name-msg").removeClass("ng-hide").addClass("remote-invalid")):($("#name-msg").addClass("ng-hide").removeClass("remote-invalid"),e.roleModel.form.roleInputName.errorTips="")})},e.checkCode=function(){var l=1==e.roleModel.newRole?"":e.roleModel.id,r={urlParams:{code:e.roleModel.roleInputCode,domainId:e.roleModel.domainId,id:l}};e.roleModel.roleInputCode&&o.checkCode(r,function(o){0!=o.errorCode?(e.roleModel.form.roleInputCode.errorTips=o.msg,$("#code-msg").removeClass("ng-hide").addClass("remote-invalid")):($("#code-msg").addClass("ng-hide").removeClass("remote-invalid"),e.roleModel.form.roleInputCode.errorTips="")})},e.roleModel.getResources=function(r){l.getResourcesView(),o.getRoleResources(r,function(o){try{var o=o.data.children;if(e.roleModel.htree=$("#resources").htree(o,{}),e.roleModel.htree.upcheked(),e.roleModel.seniorFlag)var r=l.height("getSeniorResources");else var r=l.height("getResources");setTimeout(function(){l.slimscroll("#resources",r),$(window).resize(function(){if(e.roleModel.seniorFlag)var o=l.height("getSeniorResources");else var o=l.height("getResources");l.slimscroll("#resources",o)})},10)}catch(e){}})},e.roleModel.saveResources=function(){var r=e.roleModel.id,t=e.roleModel.htree.getLeafsChecked();o.saveRoleResources(r,t,function(o){0===o.errorCode?(l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"}),e.roleModel.getResources(r),e.roleModel.resourceFlag=!1,e.roleModel.resKey=""):l.promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})},e.roleModel.toggleChecked=function(){var o=e.roleModel.resKey?e.roleModel.resKey:"";e.roleModel.resourceFlag?e.roleModel.htree.setParam({key:o,checkedFlag:!0}):e.roleModel.htree.setParam({key:o,checkedFlag:!1}),e.roleModel.htree.treeParam()},e.roleModel.searchResources=function(){var o=e.roleModel.resourceFlag,l=e.roleModel.resKey;e.roleModel.htree.setParam({key:l,checkedFlag:o}),e.roleModel.htree.treeParam()},e.roleModel.seniorSeach=function(){if(1==e.roleModel.seniorFlag?(e.roleModel.resourceFlag=!1,e.roleModel.searchResources(),e.roleModel.seniorText=Lang.getValByKey("common","common_page_advancedFilter")):e.roleModel.seniorText=Lang.getValByKey("common","common_page_ordinaryFilter"),e.roleModel.seniorFlag=!e.roleModel.seniorFlag,e.roleModel.seniorFlag)var o=l.height("getSeniorResources");else var o=l.height("getResources");setTimeout(function(){l.slimscroll("#resources",o)},10)},e.roleModel.shrinkResources=function(){e.roleModel.htree.shrinkAll()},e.roleModel.getRoleUser=function(o){e.roleModel.tableRole.restData.roleId=o||e.roleModel.tableRole.restData.roleId;var t={urlParams:e.roleModel.tableRole.restData};r.getTable(e.roleModel.tableRole.restURL,t,function(o){if(0===o.errorCode){if(e.roleModel.tableRole=r.table(e.roleModel.tableRole,t,o),e.$apply(),e.roleModel.userSeniorFlag)var a=l.height("getSeniorRoleUser");else var a=l.height("getRoleUser");setTimeout(function(){l.slimscroll(".table-container tbody",a),$(window).resize(function(){if(e.roleModel.userSeniorFlag)var o=l.height("getSeniorRoleUser");else var o=l.height("getRoleUser");l.slimscroll(".table-container tbody",o)})},10)}})},e.roleModel.searchUser=function(){e.q=e.roleModel.tableRole.restData.q,e.roleModel.tableRole.restData.pageIndex=1,e.roleModel.getRoleUser()},e.roleModel.userSenior=function(){if(e.roleModel.userSeniorFlag=!e.roleModel.userSeniorFlag,e.roleModel.userSeniorFlag)var o=l.height("getSeniorRoleUser");else{var o=l.height("getRoleUser");e.typeValue=e.roleModel.tableRole.restData.roleType=0,e.types=d(e.typeValue),e.roleModel.getRoleUser()}setTimeout(function(){l.slimscroll(".table-container tbody",o)},10)},e.getType=function(){selectFactory({data:{data:e.roleModel.seniorTypeData},maxHeight:340,minHeight:34,offset:4,id:"type-select-input",showTextField:"name",attrTextField:{"ng-value":"id"},defaultText:"",attrTextId:function(o){e.typeValue=e.roleModel.tableRole.restData.roleType=o},attrTextModel:function(o){e.types=o,e.roleModel.getRoleUser(),e.$apply()}}).build()},e.roleModel.delUserRole=function(r,t,a){var d={title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("role","role_code_delUserRole")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){0==a?o.delUserRole(r,t,function(o){l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"}),l.promptBox("closePrompt"),e.roleModel.getRoleUser()}):1==a?o.delOrgRole(r,t,function(o){l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"}),l.promptBox("closePrompt"),e.roleModel.getRoleUser()}):2==a&&o.delGroupRole(r,t,function(o){l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"}),l.promptBox("closePrompt"),e.roleModel.getRoleUser()})}}]};l.promptBox(d)},e.roleModel.getSelectedUser=function(){e.roleModel.selectedData=[],e.roleModel.selectedFlag=!1;var r=l.height("getGroupCandidate"),t={q:"",roleId:e.roleModel.id,roleType:0,pageIndex:1,pageSize:1e4};o.getRoleMember(t,function(o){if(0===o.errorCode){var t=o.data,a=t.length?t.length:0,d={};e.roleModel.selectedData=[];for(var n=0;n<a;n++)d={id:t[n].id,type:t[n].type,name:t[n].shortName,checkbox:e.roleModel.selectedFlag,delete:!1,isShow:!0},e.roleModel.selectedData.push(d);l.slimscroll(".selected-user",r),e.roleModel.deleteCandidate()}})},e.roleModel.loadData=function(){$("#wrap-orgTree").html("").html('<div id="orgTree"></div>'),$("#wrap-groupTree").html("").html('<div id="groupTree" style="margin-left:-1px;"></div>'),$("#wrap-userTree").html("").html('<div id="userTree"></div>'),$("#orgTree").nestable({iconOpen:"icon-organization-Open",iconClose:"icon-organization-Close",iconSeat:"icon-organization",userCount:"undefined",isMove:!0,isOperate:!0,isRoot:!0,childUrl:Interface.getUrlById("logistics.treeChildUrl"),searchUrl:Interface.getUrlById("logistics.searchTreeUrl"),searchInput:$("input[name=orgSearch]"),searchKeyNodes:function(o){e.roleModel.getOrgCandidate(o)},clickNode:function(o){e.roleModel.getOrgCandidate(o)},loadFirstNode:function(o){e.roleModel.getOrgCandidate(o)},treeScrollHeight:$(".select-tree-box")}),$("#userTree").nestable({iconOpen:"icon-organization-Open",iconClose:"icon-organization-Close",iconSeat:"icon-organization",userCount:"undefined",isMove:!0,isOperate:!0,isRoot:!0,childUrl:Interface.getUrlById("logistics.treeChildUrl"),searchUrl:Interface.getUrlById("logistics.searchTreeUrl"),searchInput:$("input[name=userSearch]"),searchKeyNodes:function(o){e.roleModel.getUserCandidate(o)},clickNode:function(o){e.roleModel.getUserCandidate(o)},loadFirstNode:function(o){e.roleModel.getUserCandidate(o,!0)},treeScrollHeight:$(".select-tree-box")}),$("#groupTree").nestable({iconOpen:"icon-usergroup-Open",iconClose:"icon-usergroup-Close",iconSeat:"icon-usergroup",userCount:"undefined",isRoot:!1,isMove:!0,isOperate:!0,childUrl:Interface.getUrlById("logistics.userTreeChildUrl"),searchUrl:Interface.getUrlById("logistics.userSearchTreeUrl"),searchInput:$("input[name=groupSearch]"),searchKeyNodes:function(o){e.roleModel.getGroupCandidate(o)},clickNode:function(o){e.roleModel.getGroupCandidate(o)},loadFirstNode:function(o){e.roleModel.getGroupCandidate(o,!0)},treeScrollHeight:$(".select-tree-box")}),e.roleModel.getSelectedUser()},e.roleModel.addUser=function(){e.roleModel.tabTwo.selected(0),e.roleModel.candidateFlag=e.roleModel.selectedFlag=!1,e.roleModel.candidateData=e.roleModel.selectedData=[],$("#orgTreeSearch, #groupTreeSearch, #userTreeSearch").val("");var r=(e.roleModel.id,e.roleModel.name),t={title:Lang.getValByKey("role","role_code_addRoleUser")+'<span class="u-blue">'+r+"</span>"+Lang.getValByKey("common","common_thead_role"),isHidden:!0,boxWidth:!0,isNest:!0,loadData:function(){e.roleModel.loadData()},loadTitle:function(){return r},content:{nest:$("#userRole")},operation:[{type:"submit",description:Lang.getValByKey("common","common_prompt_confirm"),operationEvent:function(){var r={orgIds:[],userGroupIds:[],userIds:[]};angular.forEach(e.roleModel.selectedData,function(e){0==e.type?r.userIds.push(e.id):1==e.type?r.orgIds.push(e.id):2==e.type&&r.userGroupIds.push(e.id)}),o.addRoleMember(e.roleModel.id,r,function(o){0===o.errorCode?(l.promptBox("closeFormPrompt"),e.roleModel.getRoleUser(),l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"})):l.promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})}}]};l.promptBox(t)},e.roleModel.toggleSelectedAll=function(){var o=e.roleModel.selectedData,l=o.length?o.length:0;if(e.roleModel.selectedFlag){for(var r=0;r<l;r++)o[r].checkbox=!0;e.roleModel.selectedData=o}else{for(var r=0;r<l;r++)o[r].checkbox=!1;e.roleModel.selectedData=o}},e.roleModel.toggleSelectedOne=function(o,l){for(var r=e.roleModel.selectedData,t=r.length?r.length:0,a=0,d=0;d<t;d++)r[d].id===o&&r[d].type==l&&(r[d].checkbox=!r[d].checkbox),r[d].checkbox||++a;e.roleModel.selectedData=r,e.roleModel.selectedFlag=!a},e.roleModel.toggleCandidateAll=function(){var o=e.roleModel.candidateData,l=o.length?o.length:0;if(e.roleModel.candidateFlag){for(var r=0;r<l;r++)o[r].delete||(o[r].checkbox=!0);e.roleModel.candidateData=o}else{for(var r=0;r<l;r++)o[r].delete||(o[r].checkbox=!1);e.roleModel.candidateData=o}},e.roleModel.toggleCandidateOne=function(o,l){for(var r=e.roleModel.candidateData,t=r.length?r.length:0,a=0,d=0;d<t;d++)r[d].id===o&&r[d].type==l&&(r[d].checkbox=!r[d].checkbox),r[d].checkbox||++a;e.roleModel.candidateData=r,e.roleModel.candidateFlag=!a},e.roleModel.getOrgCandidate=function(l){e.roleModel.candidateFlag=!1,o.getOrgDetail(l,function(o){0===o.errorCode&&(e.roleModel.searchCandidate="",e.roleModel.orgCandidateData=e.roleModel.candidateData=[{id:o.data.id,type:1,name:o.data.shortName,checkbox:e.roleModel.candidateFlag,delete:!1,isShow:!0}],e.roleModel.deleteCandidate(),e.$apply())})},e.roleModel.getGroupCandidate=function(r,t){var a=l.height("getGroupCandidate");e.roleModel.candidateFlag=!1,o.getGroupDetail(r,function(o){0===o.errorCode&&(e.roleModel.searchCandidate="",e.roleModel.groupCandidateData=[{id:o.data.id,type:2,name:o.data.shortName,checkbox:e.roleModel.candidateFlag,delete:!1,isShow:!0}],t||(e.roleModel.candidateData=e.roleModel.groupCandidateData),e.roleModel.deleteCandidate(),e.$apply(),l.slimscroll(".selected-user",a))})},e.roleModel.getUserCandidate=function(l,r){e.roleModel.candidateFlag=!1;var t={q:"",locked:-1,pageIndex:1,pageSize:1e4};o.getOgrUserList(l,t,function(o){if(0===o.errorCode){e.roleModel.searchCandidate="";var o=o.data,l=o.length?o.length:0,t={};e.roleModel.userCandidateData=[];for(var a=0;a<l;a++){var d=o[a].userCode?o[a].userCode:"";t={id:o[a].userId,type:0,name:o[a].fullName,userCode:d,checkbox:e.roleModel.candidateFlag,delete:!1,isShow:!0},e.roleModel.userCandidateData.push(t)}r||(e.roleModel.candidateData=e.roleModel.userCandidateData),e.roleModel.deleteCandidate(),e.$apply()}})},e.roleModel.addSelectedData=function(){for(var o=e.roleModel.candidateData,l=e.roleModel.selectedData,r=o.length,t=0;t<r;t++)o[t].checkbox&&!o[t].delete&&o[t].isShow&&(l.unshift({id:o[t].id,name:o[t].name,delete:!0,type:o[t].type,checkbox:e.roleModel.selectedFlag,isShow:!0}),o[t].delete=!0);e.roleModel.candidateData=o,e.roleModel.selectedData=l},e.roleModel.removeSelectedData=function(){for(var o=e.roleModel.candidateData,l=e.roleModel.selectedData,r=[],t=o.length,a=l.length,d=0;d<a;d++)if(l[d].checkbox&&l[d].isShow)for(var n=0;n<t;n++)l[d].id==o[n].id&&l[d].type==o[n].type&&o[n].delete&&(o[n].delete=!1,o[n].checkbox=e.roleModel.candidateFlag);else r.push({id:l[d].id,name:l[d].name,type:l[d].type,checkbox:l[d].checkbox,delete:l[d].delete,isShow:l[d].isShow});e.roleModel.candidateData=o,e.roleModel.selectedData=r},e.roleModel.deleteCandidate=function(){if(e.roleModel.candidateData.length&&e.roleModel.selectedData.length){for(var o=e.roleModel.candidateData,l=e.roleModel.selectedData,r=o.length,t=l.length,a=0;a<r;a++)for(var d=0;d<t;d++)l[d].id==o[a].id&&l[d].type==o[a].type&&(o[a].delete=!0,o[a].checkbox=!0);e.roleModel.candidateData=o}},e.roleModel.searchCandidateData=function(){for(var o=e.roleModel.searchCandidate.toLowerCase(),l=e.roleModel.candidateData,r=l.length,t=[],a=!0,d=0;d<r;d++){var n=l[d].userCode?l[d].userCode:"";t.push({id:l[d].id,name:l[d].name,type:l[d].type,userCode:n,checkbox:l[d].checkbox,delete:l[d].delete,isShow:!0}),a=l[d].userCode&&l[d].name?-1!=l[d].name.toLowerCase().indexOf(o)||-1!=l[d].userCode.toLowerCase().indexOf(o):!(!l[d].name||-1==l[d].name.toLowerCase().indexOf(o)),t[d].isShow=a}e.roleModel.candidateData=t},e.roleModel.searchSelectedData=function(){for(var o=e.roleModel.searchSelected.toLowerCase(),l=e.roleModel.selectedData,r=l.length,t=[],a=0;a<r;a++)t.push({id:l[a].id,name:l[a].name,type:l[a].type,checkbox:l[a].checkbox,delete:l[a].delete,isShow:!0}),l[a].name&&-1!=l[a].name.toLowerCase().indexOf(o)?t[a].isShow=!0:t[a].isShow=!1;e.roleModel.selectedData=t},e.roleModel.removeUser=function(){var t=e.roleModel.id,a={orgIds:[],userGroupIds:[],userIds:[]},d=r.getSelectTable(e.roleModel.tableRole.tableBody);if(!d.length)return l.promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_code_noSelected"),type:"errer",manualClose:!0}),!1;angular.forEach(d,function(e){0==e.type?a.userIds.push(e.id):1==e.type?a.orgIds.push(e.id):2==e.type&&a.userGroupIds.push(e.id)});var n={title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("role","role_code_removeRoleUser")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_remove"),application:"delete",operationEvent:function(){o.removeUser(t,a,function(o){0===o.errorCode?(l.promptBox({isDelay:!0,contentDelay:o.msg,type:"success"}),l.promptBox("closePrompt"),e.roleModel.getRoleUser(t)):l.promptBox({isDelay:!0,contentDelay:o.msg,type:"errer",manualClose:!0})})}}]};l.promptBox(n)}}])});