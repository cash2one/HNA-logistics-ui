easySpa.require(["widget/slimscroll","widget/prompt","widget/tab","widget/select","public/common/tableController.js"],function(){app.controller("internationalCtrl",["$scope","internationalService","internationalView","tableService",function(e,n,a,t){function o(){e.isHide?1==e.showSenior?$(".table-container tbody").slimscroll({height:$(".content-main").height()-364}):$(".table-container tbody").slimscroll({height:$(".content-main").height()-315}):$(".table-container tbody").slimscroll({height:$(".content-main").height()-234})}function i(){e.lang=e.localCode,e.internationalModel.restData.sort=c;var n={seatParams:{language:e.lang},urlParams:e.internationalModel.restData};t.getTable(e.internationalModel.restURL,n,function(a){if(0===a.errorCode){var i=a.data,l=[];for(var r in i)l[r]={},l[r].id=i[r][s.id],l[r].name=i[r][s.name],l[r].localName=$.trim(i[r][s.localName]),l[r].code=i[r][s.code];a.data=l,e.internationalModel=t.table(e.internationalModel,n,a),o(),0===a.data.length&&$(".table-container tbody").slimscroll({height:0})}}),e.showSenior,$(".user-table tbody").append($(".validate-text"))}function l(e,n){for(var n=n.data,a=0;a<n.length;a++)if(n[a].localName==e)return n[a]}var r=null,c="";e.isHide=!0;var d,m,y=(window.location.href,easySpa.queryUrlValByKey("q")),s=[];"stationAirport"==y?(e.title=Lang.getValByKey("international","international_code_airport"),e.placeholder=Lang.getValByKey("international","international_code_placenamethree"),d="logistics.getAirportsInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_airportName"),Lang.getValByKey("international","international_code_threeCode")],s={id:"refId",name:"name",code:"triadCode",localName:"localName"},c="triadCode"):"stationPort"==y?(e.title=Lang.getValByKey("international","international_code_port"),e.placeholder=Lang.getValByKey("international","international_code_placeport"),d="logistics.getPortsInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_portName"),Lang.getValByKey("international","international_code_portcode")],s={id:"id",name:"name",code:"code",localName:"localName"},c="code"):"country"==y?(e.title=Lang.getValByKey("international","international_code_country"),e.placeholder=Lang.getValByKey("international","international_code_placenametwo"),d="logistics.countryInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_countryName"),Lang.getValByKey("international","international_code_twoCode")],s={id:"refId",name:"name",code:"figureCode",localName:"localName"},c="figureCode"):"carrierAirline"==y?(e.title=Lang.getValByKey("international","international_code_airline"),e.placeholder=Lang.getValByKey("international","international_code_placenametwo"),d="logistics.companyInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_airlineName"),Lang.getValByKey("international","international_code_twoCode")],s={id:"refId",name:"name",code:"figureCode",localName:"localName"},c="figureCode"):"cost"==y?(e.title=Lang.getValByKey("international","international_code_cost"),e.placeholder=Lang.getValByKey("international","international_code_placenamecode"),d="logistics.getCostInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_costName"),Lang.getValByKey("common","common_code_code")],s={id:"refId",name:"name",code:"code",localName:"localName"},c="code"):"account"==y?(e.title=Lang.getValByKey("international","international_code_account"),e.placeholder=Lang.getValByKey("international","international_code_placenamecode"),d="logistics.getAccountInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_accountName"),Lang.getValByKey("common","common_code_code")],s={id:"refId",name:"name",code:"code",localName:"localName"},c="code"):"currency"==y?(e.title=Lang.getValByKey("international","international_code_currency"),e.placeholder=Lang.getValByKey("international","international_code_placenamethree"),d="logistics.currencyInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_currency_name"),Lang.getValByKey("international","international_code_threeCode")],s={id:"refId",name:"name",code:"code",localName:"localName"},c="code"):"transportAirplane"==y?(e.title=Lang.getValByKey("international","international_code_modelInter"),e.placeholder=Lang.getValByKey("international","international_code_placenamethree"),d="logistics.getTransportAirplaneInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_modelName"),Lang.getValByKey("international","international_code_threeCode")],s={id:"id",name:"name",code:"iata",localName:"localName"},c="iata"):"transportShip"==y?(e.title=Lang.getValByKey("international","international_code_shipInter"),e.placeholder=Lang.getValByKey("international","international_code_ship_placeport"),d="logistics.getShipInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_shipName"),Lang.getValByKey("international","international_code_shipNameEn")],s={id:"id",name:"name",code:"nameEn",localName:"localName"},c="nameEn"):"carrierMaritime"==y&&(e.title=Lang.getValByKey("international","international_code_carrierMaritimeCompany"),e.placeholder=Lang.getValByKey("international","international_code_carrierMaritimePlacehold"),d="logistics.getShippingCompanyInternational",m=[Lang.getValByKey("common","common_thead_number"),Lang.getValByKey("international","international_code_carrierMaritimeName"),Lang.getValByKey("international","international_code_carrierMaritimeCode")],s={id:"id",name:"name",code:"code",localName:"localName"},c="code"),e.internationalModel={more:!1,userWord:"",tableHeader:m,tableBody:[],restURL:d,restData:{q:"",unfilled:!1,locked:-1,pageIndex:1,pageSize:10},seatData:{uid:""},selectNumber:0,selectFlag:!1},e.localName="繁體中文",e.localCode="zh-hk",e.seniorText=Lang.getValByKey("common","common_page_advancedFilter"),e.$on("$viewContentLoaded",function(){i()}),$(window).on("resize",o),e.showLanguage=function(){n.getInternational(function(n){0==n.errorCode&&(r=selectFactory({data:n,maxHeight:240,minHeight:34,offset:4,id:"language",defaultText:"",showTextField:"localName",attrTextModel:function(n,a){var t=l(n,a);t&&(e.localName=t.localName,e.localCode=t.code),i(),e.$apply()}}),r.build(),r.updateData(n))})},e.goBack=function(){e.showEditInternational?$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("common","common_back_confirm")},cancelDescription:Lang.getValByKey("common","common_back_no"),operation:[{type:"submit",application:"delete",description:Lang.getValByKey("common","common_back_yes"),operationEvent:function(){$(document).promptBox("closePrompt"),window.location.href="#/"+y}}]}):window.location.href="#/"+y},e.editInternational=function(){if(!e.internationalModel.pagination.isVisiblePage)return void $(document).promptBox({isDelay:!0,contentDelay:"无结果，不可编辑！",type:"errer",manualClose:!0});e.isHide=!1,e.showEditInternational=!0,i()},e.languageInfo=function(e){$(e.target).data("name",$(e.target).val())},e.save=function(){if(!e.validateInput){var a,t=$(".edit-international input"),o=[],l=[];t.each(function(n){l[n]={},l[n].language=e.localCode,l[n].localName=t.eq(n).data("name"),l[n].refId=t.eq(n).data("ref"),o.push(l[n])}),a={urlParams:o,async:!1},e.isHide=!0,"stationAirport"==y?n.saveInternational(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"stationPort"==y?n.savePortInternational(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"country"==y?n.saveCountryInternational(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"currency"==y?n.saveCurrencyInternational(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"carrierAirline"==y?n.saveCompanyInternational(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"cost"==y?n.saveCostInternational(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"account"==y?n.saveAccountInternational(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"transportAirplane"==y?n.saveTransportAirplaneInternational(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"transportShip"==y?n.saveInternationalShip(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})}):"carrierMaritime"==y&&n.saveInternationalCarrierMaritime(a,function(n){0==n.errorCode?(e.showEditInternational=!1,i(),$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:n.msg,type:"errer",manualClose:!0})})}},e.cancel=function(){e.validateInput=!1,e.showEditInternational=!1,e.isHide=!0,i()},e.retrievalInternational=function(){e.isSeach=!0,e.internationalModel.restData.pageIndex=1,e.q=e.internationalModel.restData.q,i()},e.seniorFilter=function(){1==e.showSenior?(e.seniorText=Lang.getValByKey("common","common_page_advancedFilter"),e.seniorChecked&&e.checkSenior()):e.seniorText=Lang.getValByKey("common","common_page_ordinaryFilter"),e.showSenior=!e.showSenior,o()},e.checkSenior=function(){e.seniorChecked=!e.seniorChecked,1==e.seniorChecked?e.internationalModel.restData.unfilled=!0:e.internationalModel.restData.unfilled=!1,i()},e.$watch("internationalModel.tableBody",function(n,a,t){if("country"==y)for(var o=0;o<n.length;o++)n[o].figureCode&&(e.internationalModel.tableBody[o].code=n[o].figureCode);if("stationAirport"==y)for(var o=0;o<n.length;o++)n[o].triadCode&&(e.internationalModel.tableBody[o].code=n[o].triadCode);if("carrierAirline"==y)for(var o=0;o<n.length;o++)n[o].figureCode&&(e.internationalModel.tableBody[o].code=n[o].figureCode);if("transportAirplane"==y)for(var o=0;o<n.length;o++)n[o].iata&&(e.internationalModel.tableBody[o].code=n[o].iata);if("transportShip"==y)for(var o=0;o<n.length;o++)n[o].nameEn&&(e.internationalModel.tableBody[o].code=n[o].nameEn);if("carrierMaritime"==y)for(var o=0;o<n.length;o++)n[o].code&&(e.internationalModel.tableBody[o].code=n[o].code)})}])});