easySpa.require(["widget/slimscroll","widget/nestable","widget/prompt","widget/tab","public/common/tableController.js","widget/tab","widget/select"],function(){app.controller("stationPortCtrl",["$scope","stationPortService","stationPortView","tableService",function(t,e,o,r){function a(){return t.portName||t.PortFrom.portName.$setDirty(),t.portNameEn||t.PortFrom.portNameEn.$setDirty(),t.countryName||t.PortFrom.countryName.$setDirty(),t.cityName||t.PortFrom.cityName.$setDirty(),t.portAddr||t.PortFrom.portAddr.$setDirty(),t.showCodeExist||t.PortFrom.code.$setDirty(),1==t.showCodeExist&&(t.PortFrom.$valid=!1),showErrorModel(c),!!t.PortFrom.$valid||(scrollToErrorView($(".switch-list")),!1)}function n(o){var r=[];for(var a in o)r.push(o[a].id);var n={urlParams:r};e.delPort(n,function(e){0==e.errorCode?($(document).promptBox("closePrompt"),t.refreshTableData(),$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})}),t.$apply()}function i(o){var r={urlParams:{countryCode:t.countrySearchId,parentId:t.countrySearchId,q:o?o.trim():""},isAsync:!0};return e.getCity(r)}$.extend(t,{refreshTableData:function(){function e(){$(".table-container tbody").slimscroll({height:$(".content-main").height()-270})}var o={urlParams:t.tableModel.restData};r.getTable(t.tableModel.restURL,o,function(a){t.q=t.tableModel.restData.q,0===a.errorCode&&(t.tableModel=r.table(t.tableModel,o,a),setTimeout(function(){e(),$(window).on("resize",e),t.$apply(),$(".table-box").focus()},100))})},retrievalPort:function(){t.q=t.tableModel.restData.q,t.tableModel.restData.pageIndex=1,t.tableModel.restData.countryId=t.countrySearchId,t.tableModel.restData.cityId=t.citySearchId,t.refreshTableData()},clearData:function(){t.countrySearch="",t.countrySearchId="",t.citySearch="",t.citySearchId="",t.tableModel.restData.q="",t.q="",t.retrievalPort()},resetCitySearchData:function(){},getLanguage:function(){e.getLanguage(function(e){0===e.errorCode&&(t.language=e.data)})},resetCityData:function(){},checkPortCode:function(){if(t.code){if($('button[name="prompt-save"]').hasClass("save"))var o={urlParams:{code:t.code}};else var o={urlParams:{code:t.code,id:t.id}};e.checkPortCode(o,function(e){0!=e.errorCode?t.showCodeExist=!0:t.showCodeExist=!1})}},addPort:function(){t.getLanguage(),t.showCodeExist=!1,$(".select-list-box").empty(),t.textNumber=140,t.addrNumber=140,$("#nest-PortFrom").css("display","table"),t.title=Lang.getValByKey("stationPort","stationPort_prompt_new"),t.nestPortFrom=!0,t.isEditCity=!0,t.portName="",t.portNameEn="",t.countryName="",t.cityName="",t.portAddr="",t.portType="sea_port",t.code="",t.remark="";var e=$(".language-international input");e.each(function(t){e.eq(t).val("")}),loadBar(c),$('button[name="prompt-save"]').addClass("save").removeClass("edit")},closePrompt:function(){t.nestPortFrom=!1,t.PortFrom.$setPristine(),t.PortFrom.$setUntouched()}}),t.savePrompt=function(){if(1!=a())return!1;var o=$(".language-international input"),r=[],n=[];o.each(function(t){n[t]={},n[t].language=o.eq(t).data("code"),n[t].localName=o.eq(t).val(),n[t].refId=o.eq(t).data("id"),r.push(n[t])});var i={urlParams:{name:t.portName,englishName:t.portNameEn,countryName:t.countryName,countryId:t.countryId,cityName:t.cityName,cityId:t.cityId,address:t.portAddr,type:t.portType,typeName:t.portType,code:t.code,remark:t.remark,i18n:r}};$('button[name="prompt-save"]').hasClass("save")?e.savePort(i,function(e){0==e.errorCode?(t.nestPortFrom=!1,t.PortFrom.$setPristine(),t.PortFrom.$setUntouched(),$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})}):(i=$.extend({},{seatParams:{id:t.id}},i),e.modifyPort(i,function(e){0==e.errorCode?(t.nestPortFrom=!1,t.PortFrom.$setPristine(),t.PortFrom.$setUntouched(),$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"success"})):$(document).promptBox({isDelay:!0,contentDelay:e.msg,type:"errer",manualClose:!0})})),t.refreshTableData()},t.editPortInfo=function(o){t.showCodeExist=!1,$(".select-list-box").empty(),$("#nest-PortFrom").css("display","table"),t.isEditCity=!1,loadBar(c),t.title=Lang.getValByKey("stationPort","port_prompt_edit"),t.nestPortFrom=!0,t.portName=o.name,t.portNameEn=o.englishName,t.countryName=o.countryName+"("+o.countryId+")",t.countryId=o.countryId,t.cityName=o.cityName,t.cityId=o.cityId,t.portAddr=o.address,t.portType=o.type,t.code=o.code,t.remark=$.trim(o.remark),t.textNumber=140-t.remark.length,t.id=o.id;var r={seatParams:{id:t.id}};e.getPortById(r,function(e){if(0==e.errorCode){o=e.data,t.portType=o.type,console.log(o.i18n);var r=$(".language-international input");Array.isArray(o.i18n)&&0==o.i18n.length?r.each(function(t){r.eq(t).val("")}):r.each(function(t){for(var e in o.i18n)r.eq(t).data("code")==o.i18n[e].language&&(r.eq(t).data("id",o.i18n[e].refId),r.eq(t).data("code",o.i18n[e].language),r.eq(t).val($.trim(o.i18n[e].localName)))})}}),$('button[name="prompt-save"]').removeClass("save").addClass("edit")},t.deletePort=function(){if(0!=t.tableModel.selectNumber&&0!=$(".user-table tbody tr").length){var e=r.getSelectTable(t.tableModel.tableBody);$(document).promptBox({title:Lang.getValByKey("common","common_prompt_title"),type:"warning",content:{tip:Lang.getValByKey("stationPort","port_prompt_delete")},operation:[{type:"submit",description:Lang.getValByKey("common","common_page_delete"),application:"delete",operationEvent:function(){n(e)}}]})}else $(document).promptBox({isDelay:!0,contentDelay:Lang.getValByKey("common","common_table_delTips"),type:"errer",manualClose:!0})},function(){t.getLanguage()}(),t.internationalization=function(){window.location.href="#/international?q=stationPort"};var c=$("#nest-PortFrom .label-text");!function(){barClick(c)}();var s={},l={},d={},m={};o.initSelect(t,s,l),o.initTable(t),o.initPromptSelect(t,d,m),t.getCityList=function(o,r){r||(r=1);var a={urlParams:{countryCode:t.countryId,parentId:t.countryId,q:o?o.trim():"",pageIndex:r,pageSize:10}};return e.getCity(a)},t.resetCitySearchData=function(){Select.sharePool.citySearch&&(t.countrySearchId?Select.sharePool.citySearch.setData(i()):Select.sharePool.citySearch.setData({}))},t.resetCityData=function(){Select.sharePool.city&&(t.countryId?Select.sharePool.city.setData(t.getCityList()):Select.sharePool.city.setData({}))},t.textNumber=140,t.showTextNumber=function(){t.textNumber=140-t.remark.length},t.addrNumber=140,t.showAddrNumber=function(){t.portAddr?t.addrNumber=140-t.portAddr.length:t.addrNumber=140},t.clearCodeExistTip=function(){t.showCodeExist=!1}}])});